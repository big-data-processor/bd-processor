!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n,r,i,a,s){try{var c=e[a](s),o=c.value}catch(u){return void n(u)}c.done?t(o):Promise.resolve(o).then(r,i)}function s(e){return new u(e)}function c(e){return function(){return new o(e.apply(this,arguments))}}function o(e){var t,n;function r(t,n){try{var a=e[t](n),s=a.value,c=s instanceof u;Promise.resolve(c?s.wrapped:s).then(function(e){c?r("return"===t?"return":"next",e):i(a.done?"return":"normal",e)},function(e){r("throw",e)})}catch(o){i("throw",o)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise(function(a,s){var c={key:e,arg:i,resolve:a,reject:s,next:null};n?n=n.next=c:(t=n=c,r(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}function u(e){this.wrapped=e}"function"==typeof Symbol&&Symbol.asyncIterator&&(o.prototype[Symbol.asyncIterator]=function(){return this}),o.prototype.next=function(e){return this._invoke("next",e)},o.prototype.throw=function(e){return this._invoke("throw",e)},o.prototype.return=function(e){return this._invoke("return",e)},(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{ow3J:function(t,r,o){"use strict";o.r(r),o.d(r,"PageModule",function(){return Et});var u,l,d=o("ofXK"),g=o("3Pt+"),f=o("bTqV"),b=o("7EHt"),h=o("qFsG"),p=o("wZkO"),v=o("Wp6s"),y=o("bSwM"),m=o("0IaG"),k=o("f0Cb"),P=o("kmnG"),T=o("Xa2L"),x=o("+0xr"),C=o("MutI"),I=o("4wla"),w=o("QLJ7"),F=o("mrSG"),S=o("ODXS"),j=o("vSFt"),D=o("2Vo4"),U=o("XNiG"),R=o("vkgz"),L=o("NJ9Y"),A=o("JIr8"),M=o("LRne"),O=function(e,t){return t.some(function(t){return e instanceof t})},B=new WeakMap,V=new WeakMap,z=new WeakMap,J=new WeakMap,N=new WeakMap,E={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return V.get(e);if("objectStoreNames"===t)return e.objectStoreNames||z.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _(e[t])},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function K(e){E=e(E)}function _(e){if(e instanceof IDBRequest)return t=e,(n=new Promise(function(e,n){var r=function(){t.removeEventListener("success",i),t.removeEventListener("error",a)},i=function(){e(_(t.result)),r()},a=function(){n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",a)})).then(function(e){e instanceof IDBCursor&&B.set(e,t)}).catch(function(){}),N.set(n,t),n;var t,n;if(J.has(e))return J.get(e);var r=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(l||(l=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(q(this),n),_(B.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return _(t.apply(q(this),n))}:function(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var s=(n=t).call.apply(n,[q(this),e].concat(i));return z.set(s,e.sort?e.sort():[e]),_(s)}:(e instanceof IDBTransaction&&function(e){if(!V.has(e)){var t=new Promise(function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});V.set(e,t)}}(e),O(e,u||(u=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,E):e);var t}(e);return r!==e&&(J.set(e,r),N.set(r,e)),r}var q=function(e){return N.get(e)},G=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],W=new Map;function Y(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(W.get(t))return W.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=H.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||G.includes(n))){var s=function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var a,s,c,o,u,l,d,g=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),c=s.store,o=g.length,u=new Array(o>1?o-1:0),l=1;l<o;l++)u[l-1]=g[l];if(r&&(c=c.index(u.shift())),d=(a=c)[n].apply(a,u),e.t0=i,!e.t0){e.next=9;break}return e.next=9,s.done;case 9:return e.abrupt("return",d);case 10:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function c(e){a(s,r,i,c,o,"next",e)}function o(e){a(s,r,i,c,o,"throw",e)}c(void 0)})});return function(e){return t.apply(this,arguments)}}();return W.set(t,s),s}}}K(function(e){return{get:function(t,n,r){return Y(t,n)||e.get(t,n,r)},has:function(t,n){return!!Y(t,n)||e.has(t,n)}}});var Q=["continue","continuePrimaryKey","advance"],X={},Z=new WeakMap,ee=new WeakMap,te={get:function(e,t){if(!Q.includes(t))return e[t];var n=X[t];return n||(n=X[t]=function(){var e;Z.set(this,(e=ee.get(this))[t].apply(e,arguments))}),n}};function ne(){return re.apply(this,arguments)}function re(){return(re=c(regeneratorRuntime.mark(function e(){var t,n,r,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,e.t0=n instanceof IDBCursor,e.t0){e.next=6;break}return e.next=5,s((t=n).openCursor.apply(t,i));case 5:n=e.sent;case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:n=n,r=new Proxy(n,te),ee.set(r,n),N.set(r,q(n));case 11:if(!n){e.next=20;break}return e.next=14,r;case 14:return e.next=16,s(Z.get(r)||n.continue());case 16:n=e.sent,Z.delete(r);case 18:e.next=11;break;case 20:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function ie(e,t){return t===Symbol.asyncIterator&&O(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&O(e,[IDBIndex,IDBObjectStore])}K(function(e){return{get:function(t,n,r){return ie(t,n)?ne:e.get(t,n,r)},has:function(t,n){return ie(t,n)||e.has(t,n)}}});var ae,se,ce=o("h2Ed"),oe=o("tk/3"),ue=o("fXoL"),le=o("EnSQ"),de=o("c3AT"),ge=o("2uAV"),fe=o("i6c7"),be=o("flj8"),he=o("YiK1"),pe=o("tyNb"),ve=((se=function(){function e(t,r,i,a,s,c,o,u){var l=this;n(this,e),this.dataService=t,this.projectService=r,this.infoService=i,this.taskService=a,this.accountService=s,this.systemService=c,this.http=o,this.router=u,this.client$=new D.a(null),this.currentProject$=new D.a(null),this.currentResult$=new D.a(null),this.currentDataFile$=new D.a(null),this.currentPackages$=new D.a([]),this.currentPackageID="",this.currentUser$=new D.a(null),this.currentIndexedDB$=new D.a(null),this.entryType$=new D.a(null),this.currentPageKey$=new D.a(null),this.requestNavigation$=new U.a,this.isFullPage$=new D.a(!1),this.showRightMenu$=new D.a(!0),this.pageMode$=new D.a("page"),this.refresh$=new U.a,this.logItems=[],this.currentPageKey$.subscribe(function(e){if(e&&e.split){var t=e.split(":");Array.isArray(t)&&2===t.length&&(l.currentPackageID=t[0])}})}return i(e,[{key:"_logItem",value:function(e){var t={};t[e.type]=e,this.logItems.push(t)}},{key:"_sleep",value:function(e){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){return setTimeout(t,e)}));case 1:case"end":return t.stop()}},t)}))}},{key:"sendToClient",value:function(e){e.type=e.type||"received",this._logItem(e);try{this.client$.getValue().nativeElement.contentWindow.postMessage(e,"*")}catch(t){try{this.client$.getValue().nativeElement.contentWindow.postMessage(JSON.parse(JSON.stringify(e)),"*")}catch(n){console.log(n)}}}},{key:"_requestIDB",value:function(e,t,n,r){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=t||1,console.log("open database: ".concat(e)),i.next=4,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,s=indexedDB.open(e,t),c=_(s);return i&&s.addEventListener("upgradeneeded",function(e){i(_(s.result),e.oldVersion,e.newVersion,_(s.transaction))}),r&&s.addEventListener("blocked",function(){return r()}),a&&c.then(function(e){return e.addEventListener("versionchange",a)}).catch(function(){}),c}(e,t,{upgrade:function(e){for(var t=0,i=Object.keys(n);t<i.length;t++){var a=i[t],s=e.createObjectStore(a,n[a]);if(r&&r[a]){var c=r[a];s.createIndex(c.indexName,c.keyPath,c.objectParameters)}}}});case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},i)}))}},{key:"_changeMode",value:function(e){var t=this.pageMode$.getValue();void 0===e&&(e="list"===t?"page":"list"),this.pageMode$.next("list"===e?"list":"page")}},{key:"_toggleFullPage",value:function(e){var t=!this.isFullPage$.getValue();this.isFullPage$.next(void 0===e?t:e)}},{key:"isValidAPI",value:function(e){return!(["constructor","_logItem","sendToClient","_sleep","_changeMode","_toggleFullPage"].indexOf(e)>=0)&&0!==e.indexOf("_")&&void 0!==this[e]&&"function"==typeof this[e]}},{key:"historyBack",value:function(){window.history.go(-1)}},{key:"historyForward",value:function(){window.history.go(1)}},{key:"log",value:function(e,t){this.logItems.push({log:JSON.parse(JSON.stringify(t))})}},{key:"handshake",value:function(e,t){this.sendToClient({id:e,call:"handshake"})}},{key:"createProject",value:function(e,t){var n=this,r=this.projectService.createProject(t.projectName,t.projectDesc,t.packages,t.isPublic).subscribe(function(t){return r.unsubscribe(),t.isError?(n.sendToClient({id:e,call:"createProject",type:"error",value:JSON.stringify(t.errors)}),n.sendToClient({cell:"createProject",id:e,value:null})):t.success&&t.success.getModel?n.sendToClient({cell:"createProject",id:e,type:"recieved",value:t.success.getModel()}):(n.sendToClient({id:e,call:"createProject",type:"error",value:"Failed to get the newly created project."}),void n.sendToClient({cell:"createProject",id:e,value:null}))})}},{key:"importFilesToProject",value:function(e,t){var n=this,r=this.projectService.importFilesToProject(t.projectID,t.fileIDs,!!t.copy,!0).subscribe(function(t){r.unsubscribe(),t.isError?(n.sendToClient({id:e,call:"importFilesToProject",type:"error",value:JSON.stringify(t.errors)}),n.sendToClient({id:e,call:"importFilesToProject",value:[]})):n.sendToClient({id:e,call:"importFilesToProject",value:t.success.map(function(e){return e&&e.getModel?e.getModel():e})})})}},{key:"getAuthToken",value:function(e){var t=this,n=this.accountService.getAuthToken().subscribe(function(r){return n.unsubscribe(),t.sendToClient(r.isError?{call:"getAuthToken",id:e,value:null}:{call:"getAuthToken",id:e,value:r.success})})}},{key:"listProjects",value:function(e,t){var n=this,r=t.type,i=this.projectService["shared"===r?"getSharedProjects":"public"===r?"getPublicProjects":"getProjects"](t.pageIndex,t.pageSize).subscribe(function(r){if(i.unsubscribe(),r.isError)return n.sendToClient({id:e,call:"listProjects",type:"error",value:JSON.stringify(r.errors)}),n.sendToClient({id:e,call:"listProjects",value:{recors:[],totalPage:0,pageIndex:t.pageIndex,totalCount:0,pageSize:t.pageSize}});var a=r.success;console.log(a),n.sendToClient({id:e,call:"listProjects",value:{records:Array.isArray(a.records)?a.records.map(function(e){return e.getModel()}):[],totalPage:a.totalPage,pageIndex:a.pageIndex,totalCount:a.totalCount,pageSize:a.pageSize}})})}},{key:"listFiles",value:function(e){var t=this.currentProject$.getValue();this.sendToClient({call:"listFiles",id:e,value:t&&Array.isArray(t.dataFiles)?t.dataFiles.map(function(e){return e.getModel()}):[]})}},{key:"listResults",value:function(e){var t=this.currentProject$.getValue();this.sendToClient({call:"listResults",id:e,value:t&&Array.isArray(t.results)?t.results.map(function(e){return e.getModel(t.dataFiles)}):[]})}},{key:"listTasks",value:function(e,t){var n=this,r=this.taskService.getTasks(t.packageID||this.currentPackageID,t.only).subscribe(function(t){r.unsubscribe(),n.sendToClient({id:e,call:"listTasks",type:"received",value:Array.isArray(t.success)?t.success.map(function(e){return e.getModel()}):[]})})}},{key:"listPackages",value:function(e){var t=this,n=this.projectService.getRelatedPackages().subscribe(function(r){n.unsubscribe(),t.sendToClient({id:e,call:"listPackages",type:"received",value:Array.isArray(r.success)?r.success.map(function(e){return e.getModel()}):[]})})}},{key:"listAllTasks",value:function(e){var t=this,n=this.currentProject$.getValue().packages;if(Array.isArray(n))var r=this.taskService.getTasks(n.map(function(e){return e.id}).join(",")).subscribe(function(n){r.unsubscribe(),t.sendToClient({id:e,call:"listAllTasks",type:"received",value:Array.isArray(n.success)?n.success.map(function(e){return e.getModel()}):[]})})}},{key:"getCurrentUserInfo",value:function(e){var t=this.currentUser$.getValue();this.sendToClient({id:e,call:"getCurrentUserInfo",type:"received",value:t&&t.getModel?t.getModel():{}})}},{key:"getCurrentFileInfo",value:function(e){var t=this.currentDataFile$.getValue();this.sendToClient({id:e,call:"getCurrentFileInfo",type:"received",value:t?t.getModel():null})}},{key:"getCurrentResultInfo",value:function(e){var t=this.currentResult$.getValue();if(!t)return this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:null});var n=this.currentProject$.getValue(),r=t.getModel(n.dataFiles);if("workflow"!==t.type)this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:r});else{for(var i=n.results.map(function(e){return e.id}),a=[],s=t.children,c=0;c<s.length;c++)if(a[c]=[],Array.isArray(s[c]))for(var o=0;o<s[c].length;o++){var u=i.indexOf(s[c][o]);a[c][o]=u>=0&&n.results[u]&&n.results[u].parent===t.id?n.results[u].getModel(n.dataFiles):{}}r.children=a,this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:r})}}},{key:"getCurrentPackageInfo",value:function(e){var t=this.currentPackages$.getValue(),n=this.currentPackageID,r=t.filter(function(e){return e.id===n});this.sendToClient({id:e,call:"getCurrentPackageInfo",type:"received",value:r.length>0?r[0].getModel():{}})}},{key:"getCurrentProjectInfo",value:function(e){var t=this.currentProject$.getValue();this.sendToClient({id:e,call:"getCurrentProjectInfo",type:"received",value:t?t.getModel():{}})}},{key:"getProjectInfo",value:function(e,t){var n=this,r=this.projectService.loadProjectInfo(t.projectID).subscribe(function(t){return r.unsubscribe(),t.isError?(n.sendToClient({id:e,call:"getProjectInfo",type:"error",value:JSON.stringify(t.isError)}),n.sendToClient({id:e,call:"getProjectInfo",value:null})):n.sendToClient({id:e,call:"getProjectInfo",value:t.success.getModel()})})}},{key:"getTaskArguments",value:function(e,t){var n=this,r=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(function(i){if(r.unsubscribe(),i.isError)return n.sendToClient({id:e,call:"getTaskArguments",type:"error",value:JSON.stringify(i.errors)});var a=t.identifier,s=i.success.filter(function(e){return e.id===a||e.key===a})[0];if(!s)return n.sendToClient({id:e,call:"getTaskArguments",type:"error",value:"There is no such task with the id/key: ".concat(a)}),n.sendToClient({id:e,call:"getTaskArguments",type:"received",value:[]});n.sendToClient({id:e,call:"getTaskArguments",type:"received",value:s.arguments.map(function(e){return e.getModel()})})})}},{key:"getTaskInfo",value:function(e,t){var n=this,r=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(function(i){if(r.unsubscribe(),i.isError)return n.sendToClient({id:e,call:"getTaskInfo",type:"error",value:JSON.stringify(i.errors)});var a=t.identifier,s=i.success.filter(function(e){return e.id===a||e.key===a})[0];if(!s)return n.sendToClient({id:e,call:"getTaskInfo",type:"error",value:"There is no such task with the id/key: ".concat(a)}),n.sendToClient({id:e,call:"getTaskInfo",type:"received",value:{}});n.sendToClient({id:e,call:"getTaskInfo",type:"received",value:s.getModel()})})}},{key:"getTaskInputGuide",value:function(e,t){var n=this,r=t.identifier,i=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(function(t){if(i.unsubscribe(),t.isError)return n.sendToClient({id:e,call:"getTaskInputGuide",type:"error",value:JSON.stringify(t.errors)});var a=t.success,s=n.currentProject$.getValue(),c=a.filter(function(e){return e.id===r||e.key===r})[0];if(!c)return n.sendToClient({id:e,call:"getTaskInputGuide",type:"error",value:"There is no such task with the id/key: ".concat(r)}),n.sendToClient({id:e,call:"getTaskInputGuide",type:"received",value:[]});var o=n.taskService.taskValidInputs$.subscribe(function(t){o.unsubscribe();var r=c.arguments.map(function(e){return"outFile"===e.type?null:e.getModel()});t.forEach(function(e){var t=e.index;r[t]&&"inFile"===r[t].type&&(r[t].candidates=e.models.map(function(e){return e.getModel()}))});var i=c.arguments.filter(function(e){return"outFile"===e.type}).map(function(e){return e.getModel()});n.sendToClient({id:e,call:"getTaskInputGuide",type:"received",value:{inputs:r,outputs:i}})});n.taskService.getValidInputFile(c.id,s.id)})}},{key:"executeTask",value:function(e,t){var n=this,r=t.identifier,i=t.resultInfo,a=t.inputs,s=t.outputs,c=[],o=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(function(t){o.unsubscribe();var u=t.success,l=n.currentProject$.getValue(),d=u.filter(function(e){return e.id===r||e.key===r})[0];if(!d)return n.sendToClient({id:e,call:"executeTask",type:"error",value:"There is no such task with the id/key: ".concat(r)}),n.sendToClient({id:e,call:"executeTask",type:"received",value:{}});if(a.length!==d.arguments.length)return n.sendToClient({id:e,call:"executeTask",type:"error",value:"The length of inputs does not match the length of the task arguments."}),n.sendToClient({id:e,call:"executeTask",type:"received",value:{}});if(d.arguments.forEach(function(e,t){switch(e.type){case"static":a[t]=e.default[0];break;case"value":a[t]=String(null==a[t]?e.default[0]||"":a[t]||"");break;case"list":Array.isArray(a[t])||(a[t]=[a[t]]),a[t]=a[t].filter(function(t){return e.list.indexOf(t)>=0}),e.multiple||(a[t]=[a[t][0]]),0===a[t].filter(function(e){return null!=e}).length&&c.push({index:t,error:"No valid items to select"});break;case"inFile":var n=l.dataFiles.filter(function(e){return e.id===a[t]})[0];if(n){var r=e.isValidFile(n);r.result||c.push({index:t,error:r.reason})}else e.optional||c.push({index:t,error:"No valid file selected"});break;case"outFile":a[t]=null}}),c.length>0)return n.sendToClient({id:e,call:"executeTask",type:"error",value:c}),n.sendToClient({id:e,call:"executeTask",type:"received",value:null});i.prefix=String(i.prefix||""),i.suffix=String(i.suffix||""),d.arguments.filter(function(e){return"outFile"===e.type}).forEach(function(e,t){s[t]?(s[t].name=void 0!==s[t].name?String(s[t].name||""):e.name,s[t].desc=void 0!==s[t].desc?String(s[t].desc||""):"",s[t].prefix=void 0!==s[t].prefix?String(s[t].prefix):i.prefix,s[t].suffix=void 0!==s[t].suffix?String(s[t].suffix):i.suffix):s[t]={name:e.name,desc:"",prefix:i.prefix,suffix:i.suffix}}),i.name=i&&void 0!==i.name?String(i.name):"Result from ".concat(d.name),i.desc=i&&void 0!==i.desc?String(i.desc):"",i.name=i.name.slice(0,160),i.desc=i.desc.slice(0,500),i.prefix=i.prefix.slice(0,160),i.suffix=i.suffix.slice(0,160);var g=n.projectService.createResult(d.id,{run:!0,projectID:l.id,inputs:a,outputs:s,name:i.name,desc:i.desc,prefix:i.prefix||"",suffix:i.suffix||""}).subscribe(function(t){return g.unsubscribe(),t.isError?(t.errors.forEach(function(t){return n.sendToClient({id:e,call:"executeTask",type:"error",value:t})}),n.sendToClient({id:e,call:"executeTask",type:"received",value:{}})):(l=n.currentProject$.getValue(),n.sendToClient({id:e,call:"executeTask",type:"received",value:t.success.getModel(l.dataFiles)}))})})}},{key:"updateResultInfo",value:function(e,t){var n=this,r=this.currentProject$.getValue();if(!r)return this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:"No project to update the Result information."});var i=t.resultID,a=t.newInfo,s=r.results.filter(function(e){return e.id===i})[0];if(!s)return this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:"Cannot find any Result with this Result ID (".concat(i,") to update its information.")});var c=new S.a({id:i,name:a.name||s.name,prefix:a.prefix||s.prefix||"",suffix:a.suffix||s.suffix||"",desc:a.desc||s.desc}),o=this.projectService.updateResultInfo(c).subscribe(function(t){return o.unsubscribe(),t.isError?t.errors.forEach(function(t){return n.sendToClient({id:e,call:"updateResultInfo",type:"error",value:t})}):n.sendToClient({id:e,call:"updateResultInfo",type:"received",value:t.success&&t.success.getModel?t.success.getModel(r.dataFiles):{}})})}},{key:"stopResult",value:function(e,t){var n=this,r=this.currentProject$.getValue(),i=this.projectService.stopResult(new S.a({id:t.resultID})).subscribe(function(t){return i.unsubscribe(),t.isError?t.errors.forEach(function(t){return n.sendToClient({id:e,call:"stopResult",type:"error",value:t})}):n.sendToClient({id:e,call:"stopResult",type:"received",value:t.success&&t.success.getModel?t.success.getModel(r.dataFiles):{}})})}},{key:"deleteResult",value:function(e,t){var n=this,r=this.currentProject$.getValue(),i=this.projectService.deleteResult(new S.a({id:t.resultID})).subscribe(function(t){return i.unsubscribe(),t.isError?t.errors.forEach(function(t){return n.sendToClient({id:e,call:"deleteResult",type:"error",value:t})}):n.sendToClient({id:e,call:"deleteResult",type:"received",value:t.success&&t.success.getModel?t.success.getModel(r.dataFiles):{}})})}},{key:"getFileBlob",value:function(e,t){var n=this,r=t.fileID,i=t.subPath||void 0,a=this.currentProject$.getValue().dataFiles.filter(function(e){return e.id===r})[0];i&&"Folder"!==a.format&&(i=void 0);var s=this.dataService.downloadAsFileBlob(r,i).pipe(Object(R.a)(function(t){return n.sendToClient({id:e,call:"getFileBlob",type:"event",value:t})}),Object(L.a)(),Object(A.a)(function(t){return console.log(t),n._logItem({id:e,call:"getFileBlob",type:"log",value:t.toString()}),Object(M.a)({body:void 0})})).subscribe(function(t){s.unsubscribe(),n.sendToClient({id:e,call:"getFileBlob",type:"received",value:t.body})})}},{key:"getDownloadLink",value:function(e,t){var n=t.fileID,r=t.subPath,i=t.authToken,a=this.currentProject$.getValue().dataFiles.filter(function(e){return e.id===n})[0];if(!a)return this._logItem({id:e,call:"getDownloadLink",type:"error",value:"This DataFile ID: ".concat(n," is invalid.")}),this.sendToClient({id:e,call:"getDownloadLink",type:"received",value:null});if(i){if("Folder"===a.format&&r){var s=r.split("/").map(encodeURIComponent).join("/");return this.sendToClient({call:"getDownloadLink",id:e,value:"/data/static/".concat(n,"/").concat(s,"?authToken=").concat(i)})}return this.sendToClient({call:"getDownloadLink",id:e,value:"/data/api/dataFile/".concat(n,"/download?authToken=").concat(i)})}return this._logItem({id:e,call:"getDownloadLink",type:"error",value:"The authToken is unset. You have to call getAuthToken() to get the authToken."}),this.sendToClient({call:"getDownloadLink",id:e,value:null})}},{key:"globFilesInFolder",value:function(e,t){var n=this,r=t.fileID,i=this.currentProject$.getValue(),a=t.globbyExprs,s=!1;if(i.dataFiles.filter(function(e){return e.id===r&&"Folder"===e.format}).length>0||(this._logItem({id:e,call:"globFilesInFolder",type:"error",value:"This DataFile ID: ".concat(r," is not a folder")}),s=!0),Array.isArray(a)||(this._logItem({id:e,call:"globFilesInFolder",type:"error",value:"The globbyExprs is not an array."}),s=!0),s)return this.sendToClient({id:e,call:"globFilesInFolder",type:"received",value:null});var c=this.dataService.globbyFilesInFolder(r,a).subscribe(function(t){c.unsubscribe(),n.sendToClient({id:e,call:"globFilesInFolder",type:"received",value:t.success})})}},{key:"importFileFromPath",value:function(e,t){var n=this,r=this.currentProject$.getValue(),i=t.options,a=Array.isArray(i.tags)?i.tags:[],s=this.projectService.importFromPath(t.path,r.id,t.makeSymbolicLink,i.name,i.desc,i.prefix,i.suffix,a,i.folder,i.keepFileName).subscribe(function(t){return s.unsubscribe(),t.isError?t.errors.forEach(function(t){return n.sendToClient({id:e,call:"importFileFromPath",type:"error",value:t})}):n.sendToClient({id:e,call:"importFileFromPath",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})})}},{key:"uploadFiles",value:function(e,t,n){var r=this,i=this.currentPackages$.getValue(),a=this.currentProject$.getValue(),s=t.options,c=[];Array.from(t.files).forEach(function(t,a){if(!(t instanceof File||t instanceof Blob)){var o=String(1+a);switch(o){case"1":o+="st";break;case"2":o+="nd";break;case"3":o+="rd";break;default:o+="th"}return r.sendToClient({id:e,call:n||"uploadFiles",type:"error",value:"The "+o+" file has wrong type. Should be File or Blob type."})}var u;t instanceof File&&(u=i.map(function(e){return e.checkAllowedFormat(t.name)})),!u&&t instanceof Blob&&(u=i.map(function(e){return e.checkAllowedFormat(s.name+"."+s.format)}));var l=[].concat.apply([],i.map(function(e){return e.allowedFormats}));if(0===(u=u.filter(function(e){return!!e})).length)return r.sendToClient({id:e,call:n||"uploadFiles",type:"error",value:"The "+(a+1)+" file has wrong file extension. The allowed formats are: "+l.join(", ")});c.push(t)});var o=Array.isArray(s.tags)?s.tags.map(function(e){return e.toLowerCase&&e.toLowerCase().replace(/[^a-zA-Z0-9\.\-\_]/g,"").trim()}):[],u=s.folderID,l=s.keepFileName;if(1!==a.dataFiles.filter(function(e){return e.id===u&&"Folder"===e.format}).length&&(l=void 0,u=void 0),0===c.length)return this.sendToClient({id:e,call:n||"uploadFiles",type:"error",value:"No File item to upload"});var d=this.dataService.uploadFiles(a.id,c,{name:s.name,prefix:s.prefix||"",suffix:s.suffix||"",folder:u,keepFileName:l,desc:s.desc||"",format:s.format,tags:o}).pipe(Object(R.a)(function(t){r.sendToClient({id:e,call:n||"uploadFiles",type:"event",value:t})}),Object(L.a)(),Object(A.a)(function(t){return r._logItem({id:e,call:n||"uploadFiles",type:"log",value:t.toString()}),Object(M.a)({body:void 0})})).subscribe(function(t){if(d.unsubscribe(),t.body){var i=new ce.a(t.body);i.isError&&(r.infoService.addMessages(i.errors),i.errors.forEach(function(t){return r.sendToClient({id:e,call:n||"uploadFiles",type:"error",value:t})})),r.sendToClient({id:e,call:n||"uploadFiles",type:"received",value:i.success.map(function(e){return new j.a(e).getModel()})})}})}},{key:"uploadFileBlob",value:function(e,t){this.uploadFiles(e,{files:[t.fileBlob],options:{name:t.name,prefix:t.prefix,suffix:t.suffix,desc:t.desc,tags:t.tags,folderID:t.folderID,format:t.format||"",keepFileName:!!t.keepFileName}},"uploadFileBlob")}},{key:"createFolder",value:function(e,t){var n=this,r=this.currentProject$.getValue();if(!r)return this.sendToClient({id:e,call:"createFolder",type:"error",value:"No project to create the folder."});var i=t.name||"a folder",a=t.desc||"",s=t.prefix||"",c=t.suffix||"",o=Array.isArray(t.tags)?t.tags:[],u=this.projectService.createFolder(r.id,i,a,s,c,o,t.folderId,t.keepFileName).subscribe(function(t){return u.unsubscribe(),!t.isError&&n.sendToClient({id:e,call:"createFolder",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})})}},{key:"updateFileInfo",value:function(e,t){var n=this,r=this.currentProject$.getValue();if(!r)return this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:"No project to update the DataFile record."});var i=t.fileID,a=t.newInfo,s=r.dataFiles.filter(function(e){return e.id===i})[0];if(!s)return this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:"Cannot find any DataFile with this file ID (".concat(i,") to update the information.")});if(Array.isArray(a.tags)){a.tags=a.tags.map(function(e){return"Folder"===e?e:e.toLowerCase().replace(/[^a-zA-Z0-9\.\-\_]/g,"")}).filter(function(e){return!!e});var c=a.tags.indexOf("Folder"),o=s.tags.indexOf("Folder");o>=0&&-1===c?a.tags.unshift("Folder"):-1===o&&c>=0&&a.tags.splice(c,1)}else a.tags=s.tags.slice();var u=new j.a({id:i,name:a.name||s.name,prefix:a.prefix||s.prefix,suffix:a.suffix||s.suffix,desc:a.desc||s.desc,tags:a.tags}),l=this.projectService.updateDataFileInfo(u).subscribe(function(t){return l.unsubscribe(),t.isError?t.errors.forEach(function(t){return n.sendToClient({id:e,call:"updataFileInfo",type:"error",value:t})}):n.sendToClient({id:e,call:"updataFileInfo",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})})}},{key:"deleteFile",value:function(e,t){var n=this,r=this.projectService.deleteDataFile(new j.a({id:t.fileID})).subscribe(function(t){return r.unsubscribe(),t.isError?t.errors.forEach(function(t){return n.sendToClient({id:e,call:"deleteFile",type:"error",value:t})}):n.sendToClient({id:e,call:"deleteFile",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})})}},{key:"_navigatePage",value:function(e,t,n,r){n=n||null,r=r||this.currentPackageID||null;var i=this.currentProject$.getValue();!r&&Array.isArray(i.packages)&&i.packages[0]&&i.packages[0].id&&(r=r||i.packages[0].id),(n=n&&r?r+":"+n:null)&&this.requestNavigation$.next({itemID:e,type:t,pageKey:n})}},{key:"navigateToProjectList",value:function(e,t){t||(t={listType:"myProjects",pageSize:30,pageIndex:0}),this.router.navigate(["/project/list"],{queryParams:{listType:t.listType||"myProjects",pageSize:t.pageSize||30,pageIndex:t.pageIndex||0}})}},{key:"navigateToProjectPage",value:function(e,t){this._navigatePage(this.currentProject$.getValue().id,"project",t.pageKey||null,t.packageID||null)}},{key:"navigateToFilePage",value:function(e,t){this._navigatePage(t.fileID,"datafile",t.pageKey||null,t.packageID||null)}},{key:"navigateToResultPage",value:function(e,t){this._navigatePage(t.resultID,"result",t.pageKey||null,t.packageID||null)}},{key:"navigateToBdpDataFile",value:function(e,t){this.router.navigate(["/dataFile",t.fileID,"info"])}},{key:"navigateToBdpResult",value:function(e,t){this.router.navigate(["/result",t.resultID,"info"])}},{key:"navigateToBdpProject",value:function(e,t){this.router.navigate(["/project",t.projectID,"info"])}},{key:"openFileLink",value:function(e,t){return window.open("/dataFile/"+t.fileID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openFileLink",type:"received",value:t.fileID})}},{key:"openResultLink",value:function(e,t){return window.open("/result/"+t.resultID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openResultLink",type:"received",value:t.resultID})}},{key:"openProjectLink",value:function(e,t){return window.open("/project/"+t.projectID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openProjectLink",type:"received",value:t.projectID})}},{key:"openStaticLink",value:function(e,t){if(this.currentProject$.getValue().dataFiles.filter(function(e){return e.status<=2&&"Folder"===e.format&&e.id===t.fileID})[0]){var n=t.subPath||"/";0!==n.indexOf("/")&&(n="/"+n),window.open("/data/static/".concat(t.fileID).concat(n),"","width=1024,height=768"),this.sendToClient({id:e,call:"openResultLink",type:"received",value:t.fileID})}else this.sendToClient({id:e,call:"openStaticLink",type:"error",value:"The DataFile id is invalid: ".concat(t.fileID,". The file must be a folder.")})}},{key:"requestHttp",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,i,a,s,c,o,u,l,d,g,f,b,h=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.path.match(/^\//)){n.next=2;break}return n.abrupt("return",this.sendToClient({id:e,call:"requestHttp",type:"error",value:"Invalid path to request server. You are supposed to request paths which begins with '/'."}));case 2:if(r=t.method.toUpperCase(),i=t.httpOptions.queryParams||null,a=t.httpOptions.headers||null,s=new oe.e,c=new oe.d,i)for(o=Object.keys(i),u=0;u<o.length;u++)l=o[u],s=s.set(l,i[l]);if(a)for(d=Object.keys(a),g=0;g<d.length;g++)f=d[g],c=c.set(f,a[f]);b=this.http.request(r,t.path,{body:t.httpOptions.requestBody||null,headers:c,observe:t.httpOptions.observe,params:s,withCredentials:!0,reportProgress:!!t.httpOptions.reportProgress,responseType:t.httpOptions.responseType}).pipe(Object(R.a)(function(t){return h.sendToClient({id:e,call:"requestHttp",type:"event",value:t})}),Object(L.a)(),Object(A.a)(function(t){return h.sendToClient({id:e,call:"requestHttp",type:"error",value:"".concat(JSON.stringify(t))}),Object(M.a)(null)})).subscribe(function(t){b.unsubscribe(),h.sendToClient({id:e,call:"requestHttp",type:"received",value:t})});case 7:case"end":return n.stop()}},n,this)}))}},{key:"requestDatabase",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,i,a,s,c,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.entryType$.getValue(),i=this.currentPageKey$.getValue(),a=this.currentUser$.getValue(),s="filePages"===r?this.currentDataFile$.getValue().id:"resultPages"===r?this.currentResult$.getValue().id:this.currentProject$.getValue().id,c="".concat(a.id,"-").concat(r,"-").concat(s,"-").concat(i),n.prev=1,n.next=4,this._requestIDB(c,t.version,t.objectStoreSettings,t.creatingIndexes);case 4:o=n.sent,this.currentIndexedDB$.next(o),this.sendToClient({id:e,call:"requestDatabase",type:"received",value:"ok"}),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),this.sendToClient({id:e,call:"requestDatabase",type:"error",value:"Failed to create DB: ".concat(c,"; \nerrors: ").concat(JSON.parse(JSON.stringify(n.t0)))});case 11:case"end":return n.stop()}},n,this,[[1,8]])}))}},{key:"requestDatabaseRemove",value:function(e){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,i,a,s,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.currentIndexedDB$.getValue(),r=this.currentUser$.getValue(),i=this.entryType$.getValue(),a=this.currentPageKey$.getValue(),n){t.next=3;break}return t.abrupt("return");case 3:if(s="filePages"===i?this.currentDataFile$.getValue().id:"resultPages"===i?this.currentResult$.getValue().id:this.currentProject$.getValue().id,c="".concat(r.id,"-").concat(i,"-").concat(s,"-").concat(a),t.t0=n&&n.close,!t.t0){t.next=9;break}return n.close(),t.next=9,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,r=indexedDB.deleteDatabase(e);return n&&r.addEventListener("blocked",function(){return n()}),_(r).then(function(){})}(c);case 9:this.sendToClient({id:e,call:"requestDatabaseRemove",type:"received",value:"ok"});case 10:case"end":return t.stop()}},t,this)}))}},{key:"setDataStore",value:function(){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))}},{key:"dataStoreCount",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.currentIndexedDB$.getValue()){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,r.count(t.storeName,t.queryKeyRange);case 5:return i=n.sent,n.abrupt("return",this.sendToClient({id:e,call:"dataStoreCount",type:"received",value:i}));case 7:case"end":return n.stop()}},n,this)}))}},{key:"dataStoreAdd",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,i,a,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.currentIndexedDB$.getValue()){n.next=3;break}return n.abrupt("return");case 3:if(i=t.dataItems,a=t.dataKeys||void 0,!Array.isArray(i)){n.next=16;break}return n.prev=5,s=r.transaction(t.storeName,"readwrite"),i.forEach(function(e,t){return a&&a[t]?s.store.add(e,a[t]):s.store.add(e)}),n.next=10,s.done;case 10:this.sendToClient({id:e,call:"dataStoreAdd",type:"received",value:"ok"}),n.next=16;break;case 13:n.prev=13,n.t0=n.catch(5),this.sendToClient({id:e,call:"dataStoreAdd",type:"error",value:"There are errors when adding data to the objectStore."});case 16:case"end":return n.stop()}},n,this,[[5,13]])}))}},{key:"dataStorePut",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,i,a,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.currentIndexedDB$.getValue()){n.next=3;break}return n.abrupt("return");case 3:if(i=t.dataItems,a=t.dataKeys||void 0,!Array.isArray(i)){n.next=10;break}return s=r.transaction(t.storeName,"readwrite"),i.forEach(function(e,t){return a&&a[t]?s.store.put(e,a[t]):s.store.put(e)}),n.next=9,s.done;case 9:return n.abrupt("return",this.sendToClient({id:e,call:"dataStorePut",type:"received",value:"ok"}));case 10:case"end":return n.stop()}},n,this)}))}},{key:"dataStoreQuery",value:function(e,t){var n,r;return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var a,s,c,o,u,l;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=this.currentIndexedDB$.getValue()){i.next=3;break}return i.abrupt("return");case 3:if(s=a.transaction(t.storeName),null==t.indexName){i.next=32;break}c=s.store.index(t.indexName),i.prev=6,u=Object(F.a)(c.iterate(t.query));case 8:return i.next=10,u.next();case 10:if((o=i.sent).done){i.next=14;break}this.sendToClient({id:e,call:"dataStoreQuery",type:"event",value:o.value.value});case 12:i.next=8;break;case 14:i.next=19;break;case 16:i.prev=16,i.t0=i.catch(6),n={error:i.t0};case 19:if(i.prev=19,i.prev=20,i.t1=o&&!o.done&&(r=u.return),!i.t1){i.next=25;break}return i.next=25,r.call(u);case 25:if(i.prev=25,!n){i.next=28;break}throw n.error;case 28:return i.finish(25);case 29:return i.finish(19);case 30:i.next=42;break;case 32:return i.next=34,s.store.openCursor(t.query);case 34:l=i.sent;case 35:if(!l){i.next=42;break}return this.sendToClient({id:e,call:"dataStoreQuery",type:"event",value:l.value}),i.next=39,l.continue();case 39:l=i.sent;case 40:i.next=35;break;case 42:this.sendToClient({id:e,call:"dataStoreQuery",type:"received",value:"ok"});case 43:case"end":return i.stop()}},i,this,[[6,16,19,30],[20,,25,29]])}))}},{key:"dataStoreGet",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,i,a,s,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.currentIndexedDB$.getValue()){n.next=3;break}return n.abrupt("return");case 3:if(i=t.indexName,a=t.storeName,s=t.key,null!=i){n.next=17;break}if(null!=s){n.next=11;break}return n.next=8,r.getAll(a);case 8:n.t1=n.sent,n.next=14;break;case 11:return n.next=13,r.get(a,s);case 13:n.t1=n.sent;case 14:n.t0=n.t1,n.next=27;break;case 17:if(null!=s){n.next=23;break}return n.next=20,r.getAllFromIndex(a,i);case 20:n.t2=n.sent,n.next=26;break;case 23:return n.next=25,r.getFromIndex(a,i,s);case 25:n.t2=n.sent;case 26:n.t0=n.t2;case 27:c=n.t0,this.sendToClient({id:e,call:"dataStoreGet",type:"received",value:c});case 29:case"end":return n.stop()}},n,this)}))}},{key:"dataStoreGetAllKey",value:function(){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))}},{key:"dataStoreClear",value:function(e,t){return Object(F.b)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.currentIndexedDB$.getValue())try{r.clear(t.storeName),this.sendToClient({id:e,call:"dataStoreClear",type:"received",value:"ok"})}catch(i){this.sendToClient({id:e,call:"dataStoreClear",type:"error",value:"".concat(JSON.parse(JSON.stringify(i)))})}case 2:case"end":return n.stop()}},n,this)}))}},{key:"refreshPage",value:function(e){this.refresh$.next(!0),this.sendToClient({id:e,call:"refreshPage",type:"received",value:"ok"})}},{key:"toggleFullPage",value:function(e,t){var n=this;this._toggleFullPage(t.isFullPage),setTimeout(function(){return n.sendToClient({id:e,call:"toggleFullPage",type:"received",value:t.isFullPage})},200)}},{key:"isFullPage",value:function(e){this.sendToClient({id:e,call:"isFullPage",type:"received",value:this.isFullPage$.getValue()})}},{key:"toggleRightSideMenu",value:function(e,t){var n=this;this.showRightMenu$.next(!!t.isShown),setTimeout(function(){return n.sendToClient({id:e,call:"toggleRightSideMenu",type:"received",value:t.isShown})},200)}},{key:"isShownRightSideMemu",value:function(e){this.sendToClient({id:e,call:"isShownRightSideMemu",type:"received",value:this.showRightMenu$.getValue()})}},{key:"togglePageList",value:function(e,t){var n=this;["list","page"].indexOf(t.mode)>=0?this._changeMode(t.mode):this._changeMode(),setTimeout(function(){return n.sendToClient({id:e,call:"togglePageList",type:"received",value:n.pageMode$.getValue()})},10)}},{key:"isShownPageList",value:function(e){this.sendToClient({id:e,call:"isShownPageList",type:"received",value:"list"===this.pageMode$.getValue()})}}]),e}()).\u0275fac=function(e){return new(e||se)(ue.Yb(le.a),ue.Yb(de.a),ue.Yb(ge.a),ue.Yb(fe.a),ue.Yb(be.a),ue.Yb(he.a),ue.Yb(oe.a),ue.Yb(pe.c))},se.\u0275prov=ue.Kb({token:se,factory:se.\u0275fac,providedIn:"root"}),se),ye=((ae=function e(){n(this,e)}).\u0275fac=function(e){return new(e||ae)},ae.\u0275mod=ue.Mb({type:ae}),ae.\u0275inj=ue.Lb({providers:[ve],imports:[[g.d,d.c,f.c,k.b,b.b,y.b,P.d,v.h,m.f,x.o,C.d,T.b,I.a,w.b]]}),ae),me=o("RMCY"),ke=o("44fm"),Pe=o("FKr1");function Te(e,t){1&e&&(ue.Ub(0,"span"),ue.Lc(1,"Project Page"),ue.Tb())}function xe(e,t){1&e&&(ue.Ub(0,"span"),ue.Lc(1,"Result Page"),ue.Tb())}function Ce(e,t){1&e&&(ue.Ub(0,"span"),ue.Lc(1,"Project Page"),ue.Tb())}function Ie(e,t){1&e&&(ue.Ub(0,"span"),ue.Lc(1,"DataFile Page"),ue.Tb())}function we(e,t){1&e&&(ue.Ub(0,"span"),ue.Lc(1,"Static Page"),ue.Tb())}function Fe(e,t){if(1&e&&(ue.Ub(0,"h2"),ue.Lc(1,"Page type: "),ue.Jc(2,Te,2,0,"span",2),ue.Jc(3,xe,2,0,"span",2),ue.Jc(4,Ce,2,0,"span",2),ue.Jc(5,Ie,2,0,"span",2),ue.Jc(6,we,2,0,"span",2),ue.Tb()),2&e){var n=ue.gc();ue.Cb(2),ue.nc("ngIf","indexPages"===n.entryType),ue.Cb(1),ue.nc("ngIf","resultPages"===n.entryType),ue.Cb(1),ue.nc("ngIf","proxyPages"===n.entryType),ue.Cb(1),ue.nc("ngIf","filePages"===n.entryType),ue.Cb(1),ue.nc("ngIf","staticPages"===n.entryType)}}var Se,je=((Se=function(){function e(t,r){n(this,e),this.dialogRef=t,this.data=r,this.authorizedList={"allow-forms":!1,"allow-modals":!1,"allow-popups":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-same-origin":!1,"allow-scripts":!1,"allow-downloads":!1};for(var i=r.authorizedList,a=Object.keys(this.authorizedList),s=0;s<a.length;s++){var c=a[s];this.authorizedList[c]=i.indexOf(c)>=0}this.entryType=r.entryType}return i(e,[{key:"ngOnInit",value:function(){}},{key:"save",value:function(){var e=this,t=Object.keys(this.authorizedList).filter(function(t){return!0===e.authorizedList[t]});this.dialogRef.close(t)}}]),e}()).\u0275fac=function(e){return new(e||Se)(ue.Ob(m.g),ue.Ob(m.a))},Se.\u0275cmp=ue.Ib({type:Se,selectors:[["authorize-sandbox"]],decls:65,vars:13,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-subheader",""],["mat-line","",3,"ngModel","disabled","ngModelChange"],["mat-line","",1,"ml-4"],["mat-line","",1,"ml-4","text-muted"],["mat-line","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-button","",3,"click"]],template:function(e,t){1&e&&(ue.Ub(0,"h1",0),ue.Lc(1,"Authorizing Page sandbox options"),ue.Tb(),ue.Ub(2,"div",1),ue.Jc(3,Fe,7,5,"h2",2),ue.Ub(4,"mat-list"),ue.Ub(5,"h3",3),ue.Lc(6,"The default authorized options"),ue.Tb(),ue.Ub(7,"mat-list-item"),ue.Ub(8,"mat-checkbox",4),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-scripts"]=e}),ue.Lc(9,"Allow Scripts"),ue.Tb(),ue.Ub(10,"span",5),ue.Lc(11,"Page can execute javascripts."),ue.Tb(),ue.Tb(),ue.Ub(12,"mat-list-item"),ue.Ub(13,"mat-checkbox",4),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-modals"]=e}),ue.Lc(14,"Allow Modal"),ue.Tb(),ue.Ub(15,"span",5),ue.Lc(16,"Page can create modal windows."),ue.Tb(),ue.Tb(),ue.Ub(17,"mat-list-item"),ue.Ub(18,"mat-checkbox",4),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-popups"]=e}),ue.Lc(19,"Allow Pop-ups"),ue.Tb(),ue.Ub(20,"span",5),ue.Lc(21,"Page can create pop-up windows or create new tab in the browser."),ue.Tb(),ue.Ub(22,"span",6),ue.Lc(23,"*Note that created pages also follow the same sandbox options."),ue.Tb(),ue.Tb(),ue.Pb(24,"mat-divider"),ue.Ub(25,"mat-list-item"),ue.Ub(26,"mat-checkbox",7),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-downloads"]=e}),ue.Lc(27,"Allow Downlading Files From Sandboxed Pages"),ue.Tb(),ue.Ub(28,"span",5),ue.Lc(29,"Page allows automatically downloading files. If this option checked, browser will still ask you the file downloading locations."),ue.Tb(),ue.Tb(),ue.Ub(30,"h3",3),ue.Lc(31,"The additional options"),ue.Tb(),ue.Ub(32,"mat-list-item"),ue.Ub(33,"mat-checkbox",7),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-orientation-lock"]=e}),ue.Lc(34,"Allow Orientation Lock"),ue.Tb(),ue.Ub(35,"span",5),ue.Lc(36,"Page can lock the screen orientation."),ue.Tb(),ue.Tb(),ue.Ub(37,"mat-list-item"),ue.Ub(38,"mat-checkbox",7),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-pointer-lock"]=e}),ue.Lc(39,"Allow Pointer Lock"),ue.Tb(),ue.Ub(40,"span",5),ue.Lc(41,"Page can use the Pointer Lock API."),ue.Tb(),ue.Tb(),ue.Pb(42,"mat-divider"),ue.Ub(43,"h3",3),ue.Lc(44,"The risk options"),ue.Tb(),ue.Ub(45,"mat-list-item"),ue.Ub(46,"mat-checkbox",7),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-forms"]=e}),ue.Lc(47,"Allow Form Submission"),ue.Tb(),ue.Ub(48,"span",5),ue.Lc(49,"Page can submit form data."),ue.Tb(),ue.Tb(),ue.Ub(50,"mat-list-item"),ue.Ub(51,"mat-checkbox",4),ue.cc("ngModelChange",function(e){return t.authorizedList["allow-same-origin"]=e}),ue.Lc(52,"Allow Same Origin"),ue.Tb(),ue.Ub(53,"span",5),ue.Lc(54,"Page can use cookie, indexedDB form data. Do NOT allow this unless you trust the content."),ue.Tb(),ue.Ub(55,"span",6),ue.Lc(56,"The "),ue.Ub(57,"b"),ue.Lc(58,"same-origin policy"),ue.Tb(),ue.Lc(59,"is a critical security mechanism that restricts how a document or script loaded from one origin can interact with a resource from another origin. It helps isolate potentially malicious documents, reducing possible attack vectors. "),ue.Tb(),ue.Tb(),ue.Tb(),ue.Tb(),ue.Ub(60,"div",8),ue.Ub(61,"button",9),ue.Lc(62,"Cancel"),ue.Tb(),ue.Ub(63,"button",10),ue.cc("click",function(){return t.save()}),ue.Lc(64,"Ok"),ue.Tb(),ue.Tb()),2&e&&(ue.Cb(3),ue.nc("ngIf",!1),ue.Cb(5),ue.nc("ngModel",t.authorizedList["allow-scripts"])("disabled","proxyPages"===t.entryType),ue.Cb(5),ue.nc("ngModel",t.authorizedList["allow-modals"])("disabled","proxyPages"===t.entryType),ue.Cb(5),ue.nc("ngModel",t.authorizedList["allow-popups"])("disabled","proxyPages"===t.entryType),ue.Cb(8),ue.nc("ngModel",t.authorizedList["allow-downloads"]),ue.Cb(7),ue.nc("ngModel",t.authorizedList["allow-orientation-lock"]),ue.Cb(5),ue.nc("ngModel",t.authorizedList["allow-pointer-lock"]),ue.Cb(8),ue.nc("ngModel",t.authorizedList["allow-forms"]),ue.Cb(5),ue.nc("ngModel",t.authorizedList["allow-same-origin"])("disabled","proxyPages"===t.entryType))},directives:[m.h,m.e,d.n,C.a,C.e,C.c,y.a,Pe.h,g.i,g.l,k.a,m.c,f.b,m.d],encapsulation:2}),Se),De=o("zXF6");function Ue(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"button",6),ue.cc("click",function(){ue.Bc(n);var e=ue.gc().index;return ue.gc(2).uploadSettings[e].push([null])}),ue.Lc(1,"Add"),ue.Tb()}}function Re(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"button",6),ue.cc("click",function(){ue.Bc(n);var e=ue.gc().index,t=ue.gc().index;return ue.gc(2).removeFileInput(t,e)}),ue.Lc(1,"Remove"),ue.Tb()}}function Le(e,t){if(1&e&&(ue.Sb(0),ue.Ub(1,"div"),ue.Pb(2,"input",7),ue.Jc(3,Re,2,0,"button",5),ue.Tb(),ue.Rb()),2&e){var n=t.index,r=ue.gc().index,i=ue.gc(2);ue.Cb(1),ue.Db("id",i.eventID+"-"+r+"-"+n),ue.Cb(2),ue.nc("ngIf",0!==n)}}function Ae(e,t){if(1&e&&(ue.Sb(0),ue.Ub(1,"tr"),ue.Ub(2,"td"),ue.Lc(3),ue.Pb(4,"br"),ue.Jc(5,Ue,2,0,"button",5),ue.Tb(),ue.Ub(6,"td"),ue.Jc(7,Le,4,2,"ng-container",4),ue.Tb(),ue.Pb(8,"td"),ue.Tb(),ue.Rb()),2&e){var n=t.$implicit,r=t.index,i=ue.gc(2);ue.Cb(3),ue.Nc(" ",n.displayInfo,""),ue.Cb(2),ue.nc("ngIf",n.multiple),ue.Cb(2),ue.nc("ngForOf",i.uploadSettings[r])}}function Me(e,t){if(1&e&&(ue.Sb(0),ue.Ub(1,"table",3),ue.Ub(2,"thead"),ue.Ub(3,"tr"),ue.Ub(4,"th"),ue.Lc(5,"Description"),ue.Tb(),ue.Ub(6,"th"),ue.Lc(7,"Upload"),ue.Tb(),ue.Ub(8,"th"),ue.Lc(9,"Progress"),ue.Tb(),ue.Tb(),ue.Tb(),ue.Ub(10,"tbody"),ue.Jc(11,Ae,9,3,"ng-container",4),ue.Tb(),ue.Tb(),ue.Rb()),2&e){var n=ue.gc();ue.Cb(11),ue.nc("ngForOf",n.uploadSpec)}}var Oe,$e=((Oe=function(){function e(t,r,i,a,s){n(this,e),this.el=t,this.dialogRef=r,this.uploader=i,this.infoService=a,this.data=s,this.pageInfo=s.page,this.currentProject=s.project,this.eventID=s.eventID,this.uploadSpec=s.uploadSettings}return i(e,[{key:"ngOnInit",value:function(){this.uploadSpec=[{folder:"",keepFileName:!1,name:"just-a-test",desc:"Testing!!",tags:["file","just","for","testing"],displayInfo:"This is a single file field",multiple:!1},{folder:"",keepFileName:!1,name:"Testing-2",desc:"Testing!!",tags:["file","just","for","testing"],displayInfo:"This is a multiple-file field",multiple:!0}],this.eventID="testabcd",this.uploadSettings=this.uploadSpec.map(function(e){return[null]}),console.log(this.uploadElements)}},{key:"removeFileInput",value:function(e,t){$("#"+this.eventID+"-"+e+"-"+t).remove(),this.uploadSettings[e].splice(t,1)}},{key:"ngOnDestroy",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Oe)(ue.Ob(ue.l),ue.Ob(m.g),ue.Ob(De.a),ue.Ob(ge.a),ue.Ob(m.a))},Oe.\u0275cmp=ue.Ib({type:Oe,selectors:[["uploader-ui"]],viewQuery:function(e,t){var n;1&e&&(ue.Qc(x.n,1),ue.Qc(ue.l,1)),2&e&&(ue.xc(n=ue.dc())&&(t.uploaderProgress=n.first),ue.xc(n=ue.dc())&&(t.uploadElements=n))},decls:10,vars:2,consts:[["mat-dialog-title",""],["mat-stroked-button","","mat-dialog-close",""],[4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],["name","fileInput","type","file"]],template:function(e,t){1&e&&(ue.Ub(0,"h3",0),ue.Lc(1,"File Uploader Helper"),ue.Tb(),ue.Ub(2,"mat-dialog-actions"),ue.Ub(3,"button",1),ue.Lc(4,"Close"),ue.Tb(),ue.Tb(),ue.Pb(5,"br"),ue.Pb(6,"br"),ue.Pb(7,"br"),ue.Lc(8),ue.Jc(9,Me,12,1,"ng-container",2)),2&e&&(ue.Cb(8),ue.Nc("\nYou are uploading files for the page: ",t.pageInfo.name,".\n"),ue.Cb(1),ue.nc("ngIf",t.currentProject))},directives:[m.h,m.c,f.b,m.d,d.n,d.m],styles:[".my-drop-zone[_ngcontent-%COMP%]{background-color:#c8dadf;font-size:1.25rem;outline:2px dashed #92b0b3;outline-offset:-10px;padding:60px 20px;position:relative;transition:outline-offset .15s ease-in-out,background-color .15s linear}.nv-file-over[_ngcontent-%COMP%]{background-color:#fff;outline-color:#c8dadf;outline-offset:-20px}"]}),Oe),Be=o("jhN1"),Ve=["client"],ze=["sandboxContainer"];function Je(e,t){if(1&e){var n=ue.Vb();ue.Sb(0),ue.Ub(1,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc().historyBack()}),ue.Pb(2,"i",10),ue.Tb(),ue.Ub(3,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc().historyForward()}),ue.Pb(4,"i",11),ue.Tb(),ue.Ub(5,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc().reloadClient()}),ue.Pb(6,"i",12),ue.Tb(),ue.Ub(7,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc().detectSizeChange()}),ue.Pb(8,"i",13),ue.Tb(),ue.Ub(9,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc().changeMode()}),ue.Pb(10,"i",14),ue.Tb(),ue.Ub(11,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc().authorizeSandbox()}),ue.Pb(12,"i",15),ue.Tb(),ue.Ub(13,"button",9),ue.cc("click",function(){return ue.Bc(n),ue.gc()._toggleFullPage()}),ue.Pb(14,"i",16),ue.Tb(),ue.Rb()}if(2&e){var r=ue.gc();ue.Cb(14),ue.Gb("fa-expand-arrows-alt",!r.isFullPage)("fa-compress-arrows-alt",r.isFullPage)}}function Ne(e,t){if(1&e&&(ue.Ub(0,"a",18),ue.Lc(1),ue.Pb(2,"i",19),ue.Tb()),2&e){var n=ue.gc(2);ue.nc("href",n.src,ue.Ec),ue.Cb(1),ue.Nc("",n.src.changingThisBreaksApplicationSecurity," ")}}function Ee(e,t){if(1&e&&(ue.Sb(0),ue.Jc(1,Ne,3,2,"a",17),ue.Rb()),2&e){var n=ue.gc();ue.Cb(1),ue.nc("ngIf",n.src)}}function Ke(e,t){if(1&e&&(ue.Sb(0),ue.Lc(1),ue.Rb()),2&e){var n=ue.gc();ue.Cb(1),ue.Nc(" ",n.src?n.src.changingThisBreaksApplicationSecurity:"unknown"," ")}}function _e(e,t){if(1&e&&(ue.Sb(0),ue.Pb(1,"ngx-json-viewer",30),ue.Pb(2,"mat-divider"),ue.Rb()),2&e){var n=ue.gc(2).$implicit;ue.Cb(1),ue.nc("json",n)("expanded",!1)}}function qe(e,t){if(1&e&&(ue.Sb(0),ue.Jc(1,_e,3,2,"ng-container",0),ue.Rb()),2&e){var n=t.$implicit,r=ue.gc(4);ue.Cb(1),ue.nc("ngIf","log"===n.key&&r.logFilter[2]||"sent"===n.key&&r.logFilter[0]||"received"===n.key&&r.logFilter[1]||"event"===n.key&&r.logFilter[3]||"error"===n.key&&r.logFilter[4]||"change"===n.key&&r.logFilter[5])}}function Ge(e,t){if(1&e&&(ue.Sb(0),ue.Jc(1,qe,2,1,"ng-container",29),ue.hc(2,"keyvalue"),ue.Rb()),2&e){var n=t.$implicit;ue.Cb(1),ue.nc("ngForOf",ue.ic(2,1,n))}}function He(e,t){if(1&e&&(ue.Ub(0,"div",28),ue.Jc(1,Ge,3,3,"ng-container",29),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(1),ue.nc("ngForOf",n.sandboxAPI.logItems)}}function We(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"mat-expansion-panel",20,21),ue.Ub(2,"mat-expansion-panel-header",22),ue.Ub(3,"mat-panel-title"),ue.Ub(4,"span",23),ue.Lc(5,"Console Logs"),ue.Tb(),ue.Tb(),ue.Tb(),ue.Ub(6,"div",24),ue.Ub(7,"div"),ue.Ub(8,"mat-checkbox",25),ue.cc("ngModelChange",function(e){return ue.Bc(n),ue.gc().logFilter[0]=e}),ue.Lc(9,"Sent"),ue.Tb(),ue.Ub(10,"mat-checkbox",25),ue.cc("ngModelChange",function(e){return ue.Bc(n),ue.gc().logFilter[1]=e}),ue.Lc(11,"Received"),ue.Tb(),ue.Ub(12,"mat-checkbox",25),ue.cc("ngModelChange",function(e){return ue.Bc(n),ue.gc().logFilter[2]=e}),ue.Lc(13,"Logged"),ue.Tb(),ue.Ub(14,"mat-checkbox",25),ue.cc("ngModelChange",function(e){return ue.Bc(n),ue.gc().logFilter[3]=e}),ue.Lc(15,"Events"),ue.Tb(),ue.Ub(16,"mat-checkbox",25),ue.cc("ngModelChange",function(e){return ue.Bc(n),ue.gc().logFilter[4]=e}),ue.Lc(17,"Errors"),ue.Tb(),ue.Ub(18,"mat-checkbox",25),ue.cc("ngModelChange",function(e){return ue.Bc(n),ue.gc().logFilter[5]=e}),ue.Lc(19,"Changes"),ue.Tb(),ue.Tb(),ue.Ub(20,"button",26),ue.cc("click",function(){return ue.Bc(n),ue.gc().sandboxAPI.logItems=[]}),ue.Lc(21,"Clear logs"),ue.Tb(),ue.Tb(),ue.Jc(22,He,2,1,"div",27),ue.Tb()}if(2&e){var r=ue.yc(1),i=ue.gc();ue.nc("hidden",i.isFullPage),ue.Cb(2),ue.nc("collapsedHeight","28px")("expandedHeight","28px"),ue.Cb(6),ue.nc("ngModel",i.logFilter[0]),ue.Cb(2),ue.nc("ngModel",i.logFilter[1]),ue.Cb(2),ue.nc("ngModel",i.logFilter[2]),ue.Cb(2),ue.nc("ngModel",i.logFilter[3]),ue.Cb(2),ue.nc("ngModel",i.logFilter[4]),ue.Cb(2),ue.nc("ngModel",i.logFilter[5]),ue.Cb(4),ue.nc("ngIf",r.expanded)}}function Ye(e,t){1&e&&(ue.Ub(0,"div",34),ue.Ub(1,"h1",35),ue.Lc(2,"Processing ... "),ue.Pb(3,"i",36),ue.Tb(),ue.Tb())}function Qe(e,t){if(1&e&&ue.Pb(0,"img",54),2&e){var n=ue.gc(2).$implicit,r=ue.gc().$implicit,i=ue.gc(3);ue.nc("src",i.validPages.get(r.id+":"+n).thumbnail,ue.Ec)}}function Xe(e,t){1&e&&ue.Pb(0,"i",55)}function Ze(e,t){1&e&&(ue.Sb(0),ue.Lc(1,"Current Page"),ue.Rb())}function et(e,t){if(1&e&&ue.Pb(0,"img",56),2&e){var n=ue.gc(2).$implicit,r=ue.gc().$implicit,i=ue.gc(3);ue.Gb("mt-4",i.activePageKey!==r.id+":"+n),ue.nc("src",i.validPages.get(r.id+":"+n).img,ue.Ec)}}function tt(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"button",9),ue.cc("click",function(){ue.Bc(n);var e=ue.gc(2).$implicit,t=ue.gc().$implicit;return ue.gc(3).changePageKey(t.id+":"+e,t)}),ue.Lc(1,"Select"),ue.Tb()}}function nt(e,t){if(1&e&&(ue.Ub(0,"div",49),ue.Ub(1,"mat-card"),ue.Ub(2,"mat-card-header"),ue.Jc(3,Qe,1,1,"img",50),ue.Jc(4,Xe,1,0,"i",51),ue.Ub(5,"mat-card-title"),ue.Lc(6),ue.Tb(),ue.Ub(7,"mat-card-subtitle"),ue.Jc(8,Ze,2,0,"ng-container",0),ue.Tb(),ue.Tb(),ue.Jc(9,et,1,3,"img",52),ue.Ub(10,"mat-card-content"),ue.Ub(11,"p"),ue.Lc(12),ue.hc(13,"slice"),ue.Tb(),ue.Tb(),ue.Ub(14,"mat-card-actions"),ue.Jc(15,tt,2,0,"button",53),ue.Tb(),ue.Tb(),ue.Tb()),2&e){var n=ue.gc().$implicit,r=ue.gc().$implicit,i=ue.gc(3);ue.Cb(1),ue.Gc("background-color",i.activePageKey===r.id+":"+n?"rgba(255, 255, 0, 0.3)":"transparent"),ue.Cb(2),ue.nc("ngIf",i.validPages.get(r.id+":"+n).thumbnail),ue.Cb(1),ue.nc("ngIf",!i.validPages.get(r.id+":"+n).thumbnail),ue.Cb(2),ue.Mc(i.validPages.get(r.id+":"+n).name),ue.Cb(2),ue.nc("ngIf",i.activePageKey===r.id+":"+n),ue.Cb(1),ue.nc("ngIf",i.validPages.get(r.id+":"+n).img),ue.Cb(3),ue.Mc(ue.kc(13,9,i.validPages.get(r.id+":"+n).desc,0,60)),ue.Cb(3),ue.nc("ngIf",i.activePageKey!==r.id+":"+n)}}function rt(e,t){if(1&e&&(ue.Sb(0),ue.Jc(1,nt,16,13,"div",48),ue.Rb()),2&e){var n=t.$implicit;ue.Cb(1),ue.nc("ngIf",n)}}function it(e,t){if(1&e&&(ue.Ub(0,"div",43),ue.Ub(1,"h3",44),ue.Pb(2,"i",45),ue.Lc(3),ue.Pb(4,"i",46),ue.Lc(5),ue.Tb(),ue.Jc(6,rt,2,1,"ng-container",29),ue.Pb(7,"mat-divider",47),ue.Tb()),2&e){var n=t.$implicit,r=ue.gc(3);ue.Cb(3),ue.Nc(" ",n.fullname," from "),ue.Cb(2),ue.Nc(" ",n.sheetName,""),ue.Cb(1),ue.nc("ngForOf",r.keyOrders[n.id])}}function at(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"div",37),ue.Ub(1,"div",38),ue.Ub(2,"button",39),ue.cc("click",function(){return ue.Bc(n),ue.gc(2).changeMode()}),ue.Pb(3,"i",40),ue.Tb(),ue.Ub(4,"h1"),ue.Lc(5,"Page entries"),ue.Tb(),ue.Tb(),ue.Pb(6,"mat-divider"),ue.Ub(7,"div",41),ue.Jc(8,it,8,3,"div",42),ue.Tb(),ue.Tb()}if(2&e){var r=ue.gc(2);ue.Cb(8),ue.nc("ngForOf",r.currentPackages)}}function st(e,t){if(1&e&&(ue.Ub(0,"div",31),ue.Jc(1,Ye,4,0,"div",32),ue.Jc(2,at,9,1,"div",33),ue.Tb()),2&e){var n=ue.gc();ue.Cb(1),ue.nc("ngIf",n.frameProcessing&&"list"!==n.mode),ue.Cb(1),ue.nc("ngIf","list"===n.mode)}}var ct,ot=((ct=function(){function t(e,r,i,a){n(this,t),this.sanitizer=e,this.dialog=r,this.systemService=i,this.sandboxAPI=a,this.pageChange=new ue.o,this.requestNavigation=new ue.o,this.requestFullPage=new ue.o,this.rightSideMenuStateChange=new ue.o,this.modeChage=new ue.o,this._subs=[],this.subscribers={},this.src=this.securePagePath(null),this.logItems=[],this.frameProcessing=!1,this.logFilter=[!0,!0,!0,!1,!0,!1],this.validPages=new Map,this.activePageKey=null,this.sandboxAuthorizedSet=new Set(["allow-scripts","allow-modals","allow-popups","allow-downloads"])}return i(t,[{key:"sandboxAuthorized",get:function(){return e(this.sandboxAuthorizedSet)}},{key:"ngOnInit",value:function(){var e=this;this.detectSizeChange(),this.sandboxAPI.client$.next(this.client),this.systemService.toggleContentScrollbar(!1),this._subs.push(this.sandboxAPI.isFullPage$.subscribe(function(t){return e.requestFullPage.emit(t)})),this._subs.push(this.sandboxAPI.showRightMenu$.subscribe(function(t){return e.rightSideMenuStateChange.emit(t)})),this._subs.push(this.sandboxAPI.pageMode$.subscribe(function(t){return e.modeChage.emit(t)})),this._subs.push(this.sandboxAPI.requestNavigation$.subscribe(function(t){return e.requestNavigation.emit(t)})),this._subs.push(this.sandboxAPI.refresh$.subscribe(function(){return e.reloadClient()}))}},{key:"ngOnChanges",value:function(e){var t=this,n=!1;for(var r in e)"currentProject"===r?(this.currentProject=e[r].currentValue,this.sandboxAPI.currentProject$.next(this.currentProject),this.currentPackages=this.currentProject.packages,this.sandboxAPI.currentPackages$.next(this.currentPackages),e[r].currentValue&&e[r].previousValue&&e[r].currentValue.id!==e[r].previousValue.id&&(n=!0)):"currentResult"===r?(this.currentResult=e[r].currentValue,this.sandboxAPI.currentResult$.next(this.currentResult),e[r].currentValue&&e[r].previousValue&&e[r].currentValue.id!==e[r].previousValue.id&&(n=!0)):"currentDataFile"===r?(this.currentDataFile=e[r].currentValue,this.sandboxAPI.currentDataFile$.next(this.currentDataFile),e[r].currentValue&&e[r].previousValue&&e[r].currentValue.id!==e[r].previousValue.id&&(n=!0)):"pageKey"===r?(this.activePageKey=e[r].currentValue,this.sandboxAPI.currentPageKey$.next(this.activePageKey),e[r].currentValue!==e[r].previousValue&&(n=!0)):"validPages"===r?this.validPages=e[r].currentValue:"entryType"===r?(this.entryType=e[r].currentValue,this.sandboxAPI.entryType$.next(this.entryType),e[r].currentValue!==e[r].previousValue&&(n=!0)):"currentPackages"===r?(this.currentPackages=e[r].currentValue,this.sandboxAPI.currentPackages$.next(this.currentPackages)):"isFullPage"===r?this.sandboxAPI.isFullPage$.next(e[r].currentValue):"mode"===r?(this.mode="list"===e[r].currentValue?"list":"page",this.sandboxAPI.pageMode$.next(this.mode)):"currentUser"===r&&(this.currentUser=e[r].currentValue,this.sandboxAPI.currentUser$.next(this.currentUser));var i=this.src||{};if("staticPages"===this.entryType||"proxyPages"===this.entryType||this.validPages.has(this.activePageKey)){var a;if("staticPages"===this.entryType)a=this.sanitizer.bypassSecurityTrustResourceUrl("/data/api/dataFile/"+this.currentDataFile.id+"/static");else if("proxyPages"===this.entryType)a=this.sanitizer.bypassSecurityTrustResourceUrl("/result/"+this.currentResult.id+"/requestProxy"),this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms");else{var s=this.activePageKey.split(":")[0];a=this.securePagePath(this.validPages.get(this.activePageKey).path,s)}a&&i.changingThisBreaksApplicationSecurity!==a.changingThisBreaksApplicationSecurity?(console.log("".concat(i.changingThisBreaksApplicationSecurity,"changed to ").concat(a.changingThisBreaksApplicationSecurity)),setTimeout(function(){return t.src=a}),this.logItems=[]):n&&(this.src=this.securePagePath(),"proxyPages"===this.entryType&&(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")),setTimeout(function(){t.src=a,t.currentIndexedDB=void 0})),setTimeout(function(){return t.detectSizeChange()},500)}else n&&(console.log("forceupdate change src2"),"proxyPages"===this.entryType?(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")):(this.sandboxAuthorizedSet.delete("allow-same-origin"),this.sandboxAuthorizedSet.delete("allow-forms")),setTimeout(function(){t.src=null,t.currentIndexedDB=void 0}))}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(function(){return e.detectSizeChange()},1e3)}},{key:"onResize",value:function(){var e=this;clearTimeout(this.onResizeTimer),this.onResizeTimer=setTimeout(function(){return e.detectSizeChange()},500)}},{key:"reloadClient",value:function(e){var t=this,n=e||this.src;"proxyPages"===this.entryType&&(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")),this.src=this.sanitizer.bypassSecurityTrustResourceUrl(null),setTimeout(function(){console.log("content reloaded"),t.src=n,t.currentIndexedDB=void 0,t.onResize()},300)}},{key:"changeMode",value:function(e){var t=this.sandboxAPI.pageMode$.getValue();this.sandboxAPI.pageMode$.next("list"==(e=e||"list"!==t?"list":"page")?"list":"page")}},{key:"historyBack",value:function(){this.sandboxAPI.historyBack()}},{key:"historyForward",value:function(){this.sandboxAPI.historyForward()}},{key:"detectSizeChange",value:function(){if(this.client){this.frameWidth=$(this.sandboxContainer.nativeElement).innerWidth();var e=window.innerHeight,t=this.sandboxAPI.isFullPage$.getValue()?e-30:e-274;this.frameHeight=t}}},{key:"onSrcChanged",value:function(e){}},{key:"securePagePath",value:function(e,t){return e=e?e.replace(/^http[s]:/g,"").replace(/\.\./g,""):null,t&&(e=0===e.indexOf("/")?"/page/api/".concat(t).concat(e):"/page/api/".concat(t,"/").concat(e)),this.sanitizer.bypassSecurityTrustResourceUrl(e)}},{key:"changePageKey",value:function(e,t){console.log(e,this.activePageKey),e!==this.activePageKey&&this.pageChange.emit({page:this.validPages.get(e),package:t}),this.mode="page"}},{key:"_toggleFullPage",value:function(){this.sandboxAPI._toggleFullPage()}},{key:"openUploaderUI",value:function(){this.dialog.open($e,{minWidth:"90vw",minHeight:"90vh",disableClose:!0,data:{project:this.currentProject,page:this.validPages[this.activePageKey]}})}},{key:"notifyDataChange",value:function(e){this.sandboxAPI.sendToClient({type:"change",value:e})}},{key:"onMessagereceived",value:function(e){if(e.data.call&&e.data.id){this.sandboxAPI.logItems.push({sent:e.data});var t=e.data.id,n=e.data.call,r=e.data.value;this.sandboxAPI.isValidAPI(n)?this.sandboxAPI[n](t,r):this.sandboxAPI.sendToClient({id:t,call:n,type:"error",value:"The call ".concat(n," is not part of the API.")})}}},{key:"authorizeSandbox",value:function(){var e=this,t=this.dialog.open(je,{data:{authorizedList:this.sandboxAuthorized,entryType:this.entryType}}).afterClosed().subscribe(function(n){t.unsubscribe(),Array.isArray(n)&&(0===n.length?e.sandboxAuthorizedSet.add("allow-modal"):e.sandboxAuthorizedSet=new Set(n),e.reloadClient())})}},{key:"ngOnDestroy",value:function(){this.systemService.toggleContentScrollbar(!0),clearTimeout(this.timeout),clearTimeout(this.onResizeTimer),this._subs.forEach(function(e){return e.unsubscribe()}),console.log("Sandbox destroyed")}}]),t}()).\u0275fac=function(e){return new(e||ct)(ue.Ob(Be.b),ue.Ob(m.b),ue.Ob(he.a),ue.Ob(ve))},ct.\u0275cmp=ue.Ib({type:ct,selectors:[["bdp-sandbox"]],viewQuery:function(e,t){var n;1&e&&(ue.Qc(Ve,3),ue.Qc(ze,3)),2&e&&(ue.xc(n=ue.dc())&&(t.client=n.first),ue.xc(n=ue.dc())&&(t.sandboxContainer=n.first))},inputs:{currentProject:"currentProject",currentResult:"currentResult",currentDataFile:"currentDataFile",currentUser:"currentUser",currentPackages:"currentPackages",entryType:"entryType",keyOrders:"keyOrders",origin:"origin",pageKey:"pageKey",validPages:"validPages",mode:"mode",isFullPage:"isFullPage"},outputs:{pageChange:"pageChange",requestNavigation:"requestNavigation",requestFullPage:"requestFullPage",rightSideMenuStateChange:"rightSideMenuStateChange",modeChage:"modeChage"},features:[ue.Ab],decls:12,vars:12,consts:[[4,"ngIf"],[1,"px-3",2,"background-color","lightgray","width","100%",3,"hidden"],[1,"fas","fa-greater-than","mx-2"],[3,"hidden",4,"ngIf"],[2,"position","relative","overflow","auto","padding","0px",3,"resize"],["sandboxContainer",""],["frameborder","0",2,"position","relative",3,"width","height","src","message","load"],["client",""],["style","position: absolute; background-color: rgba(255, 255, 255, 0.9); top: 0px; left: 0px; right: 0px; bottom: 0px;",4,"ngIf"],["mat-stroked-button","",3,"click"],[1,"fas","fa-arrow-left"],[1,"fas","fa-arrow-right"],[1,"fas","fa-sync-alt"],[1,"fas","fa-expand"],[1,"fas","fa-th-large"],[1,"fas","fa-unlock"],[1,"fas"],["target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"],[1,"fas","fa-external-link-alt","ml-1"],[3,"hidden"],["expander",""],[2,"background-color","#F0F0F0",3,"collapsedHeight","expandedHeight"],[2,"color","#2d2d2d"],[1,"d-flex","justify-content-between","align-items-center"],[3,"ngModel","ngModelChange"],["mat-button","","color","warn",3,"click"],["style","max-height: 250px; overflow: auto;",4,"ngIf"],[2,"max-height","250px","overflow","auto"],[4,"ngFor","ngForOf"],[2,"font-size","12px","padding","0px",3,"json","expanded"],[2,"position","absolute","background-color","rgba(255, 255, 255, 0.9)","top","0px","left","0px","right","0px","bottom","0px"],["style","position: absolute; top: 30px; left: 50%; transform: translateX(-50%) translateY(-30%);",4,"ngIf"],["class","p-3",4,"ngIf"],[2,"position","absolute","top","30px","left","50%","transform","translateX(-50%) translateY(-30%)"],[1,"display-4","text-center"],[1,"fas","fa-circle-notch","fa-spin"],[1,"p-3"],[1,"d-flex","flex-row"],["mat-stroked-button","",1,"mr-2",3,"click"],[1,"fas","fa-times","fa-fw"],[1,"container-fluid"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12","text-muted"],[1,"fas","fa-cube","fa-lg","mr-2"],[1,"fas","fa-cubes","fa-lg","mr-2"],[1,"col-12","my-2"],["class","col-md-6 col-lg-4 col-xl-3 p-2",4,"ngIf"],[1,"col-md-6","col-lg-4","col-xl-3","p-2"],["mat-card-avatar","",3,"src",4,"ngIf"],["class","fas fa-scroll fa-fw fa-2x","mat-card-avatar","",4,"ngIf"],["mat-card-image","",3,"mt-4","src",4,"ngIf"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-card-avatar","",3,"src"],["mat-card-avatar","",1,"fas","fa-scroll","fa-fw","fa-2x"],["mat-card-image","",3,"src"]],template:function(e,t){1&e&&(ue.Jc(0,Je,15,4,"ng-container",0),ue.Ub(1,"div",1),ue.Ub(2,"small"),ue.Pb(3,"i",2),ue.Jc(4,Ee,2,1,"ng-container",0),ue.Jc(5,Ke,2,1,"ng-container",0),ue.Tb(),ue.Tb(),ue.Jc(6,We,23,10,"mat-expansion-panel",3),ue.Ub(7,"div",4,5),ue.cc("resize",function(){return t.onResize()},!1,ue.Ac),ue.Ub(9,"iframe",6,7),ue.cc("message",function(e){return t.onMessagereceived(e)},!1,ue.Ac)("load",function(e){return t.onSrcChanged(e)}),ue.Tb(),ue.Jc(11,st,3,2,"div",8),ue.Tb()),2&e&&(ue.nc("ngIf",!t.isFullPage),ue.Cb(1),ue.nc("hidden",t.isFullPage),ue.Cb(3),ue.nc("ngIf","staticPages"===t.entryType||"proxyPages"===t.entryType),ue.Cb(1),ue.nc("ngIf","staticPages"!==t.entryType&&"proxyPages"!==t.entryType),ue.Cb(1),ue.nc("ngIf","staticPages"!==t.entryType&&"proxyPages"!==t.entryType),ue.Cb(1),ue.Gc("border",t.isFullPage?"":"thin solid black"),ue.Cb(2),ue.nc("width",t.frameWidth)("height",t.frameHeight)("src",t.src,ue.Dc),ue.Db("sandbox",t.sandboxAuthorized.join(" ")),ue.Cb(2),ue.nc("ngIf",t.frameProcessing||"list"===t.mode))},directives:[d.n,f.b,b.c,b.f,b.g,y.a,g.i,g.l,d.m,w.a,k.a,v.a,v.f,v.j,v.i,v.d,v.b,v.c,v.g],pipes:[d.h,d.v],styles:[".mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0 0 0 16px}.mat-checkbox[_ngcontent-%COMP%]{padding-right:14px}"]}),ct),ut=["sandbox"],lt=function(e){return["/project",e,"info"]};function dt(e,t){if(1&e&&(ue.Ub(0,"a",6),ue.Lc(1),ue.Tb()),2&e){var n=ue.gc(2);ue.nc("routerLink",ue.rc(2,lt,n.currentProject.id)),ue.Cb(1),ue.Nc("Project: ",n.currentProject.name,"")}}function gt(e,t){if(1&e&&(ue.Ub(0,"span"),ue.Lc(1),ue.Tb()),2&e){var n=ue.gc(3);ue.Cb(1),ue.Mc(n.currentPage.name)}}function ft(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Lc(1,"Project Page: "),ue.Jc(2,gt,2,1,"span",10),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(2),ue.nc("ngIf",n.currentPage)}}var bt=function(e){return["/result",e,"info"]};function ht(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Lc(1,"Result: "),ue.Ub(2,"a",6),ue.Ub(3,"u",11),ue.Lc(4),ue.Tb(),ue.Lc(5),ue.Ub(6,"u",11),ue.Lc(7),ue.Tb(),ue.Tb(),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(2),ue.nc("routerLink",ue.rc(4,bt,n.currentResult.id)),ue.Cb(2),ue.Mc(n.currentResult.prefix),ue.Cb(1),ue.Mc(n.currentResult.name||"(no-name)"),ue.Cb(2),ue.Mc(n.currentResult.suffix)}}function pt(e,t){if(1&e&&(ue.Ub(0,"span"),ue.Lc(1),ue.Tb()),2&e){var n=ue.gc(3);ue.Cb(1),ue.Mc(n.currentPage.name)}}function vt(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Lc(1,"Result Page: "),ue.Jc(2,pt,2,1,"span",10),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(2),ue.nc("ngIf",n.currentPage)}}var yt=function(e){return["/result",e,"requestProxy"]};function mt(e,t){if(1&e&&(ue.Ub(0,"span"),ue.Ub(1,"a",12),ue.Lc(2," Proxy "),ue.Pb(3,"i",13),ue.Tb(),ue.Tb()),2&e){var n=ue.gc(3);ue.Cb(1),ue.nc("routerLink",ue.rc(1,yt,n.currentResult.id))}}function kt(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Jc(1,mt,4,3,"span",10),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(1),ue.nc("ngIf",n.currentResult)}}var Pt=function(e){return["/dataFile",e,"info"]};function Tt(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Lc(1,"Data File: "),ue.Ub(2,"a",6),ue.Ub(3,"u",11),ue.Lc(4),ue.Tb(),ue.Lc(5),ue.Ub(6,"u",11),ue.Lc(7),ue.Tb(),ue.Tb(),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(2),ue.nc("routerLink",ue.rc(4,Pt,n.currentDataFile.id)),ue.Cb(2),ue.Mc(n.currentDataFile.prefix),ue.Cb(1),ue.Mc(n.currentDataFile.name||"(no-name)"),ue.Cb(2),ue.Mc(n.currentDataFile.suffix)}}var xt=function(e){return["/data","api","dataFile",e,"static"]};function Ct(e,t){if(1&e&&(ue.Ub(0,"span"),ue.Ub(1,"a",12),ue.Lc(2," Folder content "),ue.Pb(3,"i",13),ue.Tb(),ue.Tb()),2&e){var n=ue.gc(3);ue.Cb(1),ue.nc("routerLink",ue.rc(1,xt,n.currentDataFile.id))}}function It(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Jc(1,Ct,4,3,"span",10),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(1),ue.nc("ngIf",n.currentDataFile)}}function wt(e,t){if(1&e&&(ue.Ub(0,"span"),ue.Lc(1),ue.Tb()),2&e){var n=ue.gc(3);ue.Cb(1),ue.Mc(n.currentPage.name)}}function Ft(e,t){if(1&e&&(ue.Ub(0,"li",9),ue.Lc(1,"File Page: "),ue.Jc(2,wt,2,1,"span",10),ue.Tb()),2&e){var n=ue.gc(2);ue.Cb(2),ue.nc("ngIf",n.currentPage)}}var St=function(){return["/home"]},jt=function(){return["/project/list"]};function Dt(e,t){if(1&e&&(ue.Ub(0,"ol",4),ue.Ub(1,"li",5),ue.Ub(2,"a",6),ue.Lc(3,"Home"),ue.Tb(),ue.Tb(),ue.Ub(4,"li",5),ue.Ub(5,"a",6),ue.Lc(6,"Project List"),ue.Tb(),ue.Tb(),ue.Ub(7,"li",5),ue.Jc(8,dt,2,4,"a",7),ue.Tb(),ue.Jc(9,ft,3,1,"li",8),ue.Jc(10,ht,8,6,"li",8),ue.Jc(11,vt,3,1,"li",8),ue.Jc(12,kt,2,1,"li",8),ue.Jc(13,Tt,8,6,"li",8),ue.Jc(14,It,2,1,"li",8),ue.Jc(15,Ft,3,1,"li",8),ue.Tb()),2&e){var n=ue.gc();ue.Cb(2),ue.nc("routerLink",ue.qc(10,St)),ue.Cb(3),ue.nc("routerLink",ue.qc(11,jt)),ue.Cb(3),ue.nc("ngIf",n.currentProject),ue.Cb(1),ue.nc("ngIf","indexPages"===n.entryType),ue.Cb(1),ue.nc("ngIf",n.currentResult),ue.Cb(1),ue.nc("ngIf","resultPages"===n.entryType),ue.Cb(1),ue.nc("ngIf","proxyPages"===n.entryType),ue.Cb(1),ue.nc("ngIf",n.currentDataFile),ue.Cb(1),ue.nc("ngIf","staticPages"===n.entryType),ue.Cb(1),ue.nc("ngIf","filePages"===n.entryType)}}function Ut(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"bdp-sandbox",14,15),ue.cc("pageChange",function(e){return ue.Bc(n),ue.gc().onPageChange(e)})("requestNavigation",function(e){return ue.Bc(n),ue.gc().navigatePage(e)})("requestFullPage",function(e){return ue.Bc(n),ue.gc().toggleFullPage(e)})("rightSideMenuStateChange",function(e){return ue.Bc(n),ue.gc().toggleRightSideMenu(e)})("modeChage",function(e){return ue.Bc(n),ue.gc().onModeChange(e)}),ue.Tb()}if(2&e){var r=ue.gc();ue.nc("currentProject",r.currentProject)("currentResult",r.currentResult)("currentDataFile",r.currentDataFile)("currentPackages",r.currentPackages)("currentUser",r.currentUser)("isFullPage",r.isFullPage)("keyOrders",r.pageKeyOrders)("validPages",r.validPages)("pageKey",r.currentPageKey)("entryType",r.entryType)("mode",r.mode)}}function Rt(e,t){1&e&&ue.Pb(0,"i",29)}function Lt(e,t){1&e&&ue.Pb(0,"i",30)}function At(e,t){1&e&&(ue.Sb(0),ue.Lc(1,"Full page"),ue.Rb())}function Mt(e,t){1&e&&(ue.Sb(0),ue.Lc(1,"Compress"),ue.Rb())}function Ot(e,t){if(1&e){var n=ue.Vb();ue.Ub(0,"div",16),ue.Ub(1,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.showRightButtonContent=!e.showRightButtonContent}),ue.Jc(2,Rt,1,0,"i",18),ue.Jc(3,Lt,1,0,"i",19),ue.Ub(4,"span",20),ue.Lc(5,"MENU"),ue.Tb(),ue.Ub(6,"span",21),ue.Lc(7,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(8,"br"),ue.Ub(9,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.sandbox&&e.sandbox.historyBack()}),ue.Pb(10,"i",22),ue.Ub(11,"span",23),ue.Lc(12,"Back"),ue.Tb(),ue.Ub(13,"span",21),ue.Lc(14,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(15,"br"),ue.Ub(16,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.sandbox&&e.sandbox.historyForward()}),ue.Pb(17,"i",24),ue.Ub(18,"span",23),ue.Lc(19,"Forward"),ue.Tb(),ue.Ub(20,"span",21),ue.Lc(21,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(22,"br"),ue.Ub(23,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.sandbox&&e.sandbox.detectSizeChange()}),ue.Pb(24,"i",25),ue.Ub(25,"span",23),ue.Lc(26,"Adjust size"),ue.Tb(),ue.Ub(27,"span",21),ue.Lc(28,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(29,"br"),ue.Ub(30,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.sandbox&&e.sandbox.reloadClient()}),ue.Pb(31,"i",26),ue.Ub(32,"span",23),ue.Lc(33,"Refresh"),ue.Tb(),ue.Ub(34,"span",21),ue.Lc(35,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(36,"br"),ue.Ub(37,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.mode="list"===e.mode?"page":"list"}),ue.Pb(38,"i",27),ue.Ub(39,"span",23),ue.Lc(40,"Page list"),ue.Tb(),ue.Ub(41,"span",21),ue.Lc(42,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(43,"br"),ue.Ub(44,"a",17),ue.cc("click",function(){ue.Bc(n);var e=ue.gc();return e.toggleFullPage(!e.isFullPage)}),ue.Pb(45,"i",28),ue.Ub(46,"span",23),ue.Jc(47,At,2,0,"ng-container",10),ue.Jc(48,Mt,2,0,"ng-container",10),ue.Tb(),ue.Ub(49,"span",21),ue.Lc(50,"\u276f"),ue.Tb(),ue.Tb(),ue.Pb(51,"br"),ue.Tb()}if(2&e){var r=ue.gc();ue.nc("@rightButtonState",r.showRightButtonContent?"active":"inactive"),ue.Cb(2),ue.nc("ngIf",r.showRightButtonContent),ue.Cb(1),ue.nc("ngIf",!r.showRightButtonContent),ue.Cb(1),ue.Gb("active",r.showRightButtonContent),ue.Cb(7),ue.Gb("active",r.showRightButtonContent),ue.Cb(7),ue.Gb("active",r.showRightButtonContent),ue.Cb(7),ue.Gb("active",r.showRightButtonContent),ue.Cb(7),ue.Gb("active",r.showRightButtonContent),ue.Cb(5),ue.Gb("active","list"===r.mode),ue.Cb(2),ue.Gb("active",r.showRightButtonContent),ue.Cb(6),ue.Gb("fa-expand-alt",!r.isFullPage)("fa-compress-alt",r.isFullPage),ue.Cb(1),ue.Gb("active",r.showRightButtonContent),ue.Cb(1),ue.nc("ngIf",!r.isFullPage),ue.Cb(1),ue.nc("ngIf",r.isFullPage)}}var $t,Bt,Vt=(($t=function(){function e(t,r,i,a,s,c,o){n(this,e),this.route=t,this.router=r,this.systemService=i,this.infoService=a,this.projectService=s,this.taskService=c,this.accountService=o,this._subs=[]}return i(e,[{key:"ngOnInit",value:function(){var e=this;this.systemService.maintainRightSidebarStatus(!0),this.currentPageKey=null,this.currentPage=null,this.currentPackages=null,this.displayRightSideMenu=!0,this.isFullPage=!1,this.entryType=null,this.mode="page",this._subs.push(this.accountService.currentUser$.subscribe(function(t){return e.currentUser=t})),this._subs.push(this.systemService.sidebarStatus$.subscribe(function(t){e.sandbox&&e.sandbox.detectSizeChange&&(clearTimeout(e.onChildrenResizeTimer),e.onChildrenResizeTimer=setTimeout(function(){e.sandbox.detectSizeChange()},500))})),this._subs.push(this.infoService.incomingDataChange$.subscribe(function(t){var n=t.type,r=t.target,i=t.data;if("DataFile"===r||"Result"===r){if(i.project!==e.currentProject.id)return;var a;"DataFile"===r?a=new j.a(i):"Result"===r&&(a=new S.a(i)),e.sandbox.notifyDataChange({type:n,target:r,data:a.getModel()})}})),this._subs.push(this.infoService.incomingResultOutput$.subscribe(function(t){var n=t.target.split(":");n[0]===e.currentProject.id&&e.sandbox.notifyDataChange({type:t.type,target:"ResultMsg",data:{resultId:n[1],content:t.data}})})),this._subs.push(this.projectService.currentProject$.subscribe(function(t){e.currentProject=t,t&&(e.pages=t&&Array.isArray(t.packages)&&t.packages[0]?t.packages[0].pages:new ke.a({}),"indexPages"===e.entryType&&e.getValidPages())})),this._subs.push(this.projectService.currentResult$.subscribe(function(t){e.thisResultID&&t&&t.id===e.thisResultID?(e.currentProject&&"resultPages"===e.entryType||"proxyPages"===e.entryType)&&(e.currentResult=t,e.getValidPages()):void 0===t&&(e.currentResult=t)})),this._subs.push(this.projectService.currentDataFile$.subscribe(function(t){e.thisDataFileID&&t&&t.id===e.thisDataFileID?!e.currentProject||"filePages"!==e.entryType&&"staticPages"!==e.entryType||(e.currentDataFile=t,e.getValidPages()):void 0===t&&(e.currentDataFile=t)})),this.route.queryParamMap.subscribe(function(t){var n=t.get("project"),r=t.get("result"),i=t.get("datafile"),a=t.get("static"),s=t.get("proxy");if(e.currentPageKey=t.get("pageKey")||null,e.isFullPage="true"===t.get("fullpage"),n)e.entryType="indexPages",e.projectService.clearCurrentDataFile(),e.projectService.clearCurrentResult(),e.projectService.clearCurrentProject(),e.projectService.setCurrentProject(n,!1);else if(r){"true"===s?e.entryType="proxyPages":(e.entryType="resultPages",e.projectService.clearCurrentDataFile()),e.thisResultID=r;var c=e.projectService.loadResultInfo(r).subscribe(function(){return c.unsubscribe()})}else if(i){e.thisDataFileID=i,"true"===a?e.entryType="staticPages":(e.entryType="filePages",e.projectService.clearCurrentResult());var o=e.projectService.loadDataFileInfo(i).subscribe(function(e){o.unsubscribe()})}e.systemService.maintainRightSidebarStatus(!0)})}},{key:"onResize",value:function(e){var t=this;clearTimeout(this.onResizeTimer),this.onResizeTimer=setTimeout(function(){return t.detectSizeChange()},400)}},{key:"detectSizeChange",value:function(){var e=window.innerWidth<1024;this.isFullPage?this.systemService.toggleSidebar(!1,!0):this.systemService.toggleSidebar(!e)}},{key:"getValidPages",value:function(){var e=this,t=new Map;if(this.currentProject&&Array.isArray(this.currentProject.packages)&&this.currentProject.packages[0]&&this.currentProject.packages[0].pages){this.pageKeyOrders={};var n={},r=this.projectService.getRelatedPackages().subscribe(function(i){if(r.unsubscribe(),i.isError)return e.validPages=new Map,void(e.canInitialize=!0);var a=i.success;if(e.currentPackages=a,Array.isArray(a))for(var s=0;s<a.length;s++){var c=a[s];n[c.id]=[],e.pageKeyOrders[c.id]=[];var o=c.pages?c.pages[e.entryType]:[];Array.isArray(o)&&n[c.id].push.apply(n[c.id],o.filter(function(t){var n=!0;switch(e.entryType){case"resultPages":if(0===t.tasks.length)return!0;if(!e.currentResult)return!1;if(t.tasks.indexOf((e.currentResult.task&&e.currentResult.task.key?e.currentResult.task:e.currentResult.taskSnapshot).key)>=0)return!0;n=!1;break;case"filePages":var r=e.currentDataFile;if(!r)return!1;if(0===t.tags.length){if(!t.format)return!0;if(t.format===r.format)return!0}else{var i=t.rule;if("or"===i)return t.tags.filter(function(e){return r.tags.indexOf(e)>=0}).length>0;if("and"===i)return t.tags.filter(function(e){return r.tags.indexOf(e)>=0}).length===t.tags.length;if("all"===i)return t.tags.filter(function(e){return r.tags.indexOf(e)>=0}).length===r.tags.length}n=!1}return n}));for(var u=0;u<n[c.id].length;u++){var l=n[c.id][u];if(l.key){var d=c.id+":"+l.key;null==e.currentPageKey?(e.currentPageKey=d||null,e.currentPage=l):e.currentPageKey===d&&(e.currentPage=l),t.set(d,l),e.pageKeyOrders[c.id].push(l.key)}}}e.validPages=t,e.requestFullPage(e.isFullPage),setTimeout(function(){return e.canInitialize=!0})})}else this.router.navigate(this.currentProject?["/project",this.currentProject.id,"info"]:["/project/list"])}},{key:"onModeChange",value:function(e){this.mode="list"===e?"list":"page"}},{key:"onPageChange",value:function(e){this.canInitialize=!1;var t={project:void 0,result:void 0,datafile:void 0,pageKey:e.package.id+":"+e.page.key,fullpage:this.isFullPage?"true":"false",static:void 0,proxy:void 0};"indexPages"===this.entryType?t.project=this.currentProject.id:"resultPages"===this.entryType?(t.result=this.currentResult.id,t.proxy=!1):"filePages"===this.entryType?t.datafile=this.currentDataFile.id:"staticPages"===this.entryType?(t.datafile=this.currentDataFile.id,t.static=!0):"proxyPages"===this.entryType&&(t.result=this.currentResult.id,t.proxy=!0),this.currentPageKey=e.package.id+":"+e.page.key,this.mode="page",this.router.navigate(["/page"],{queryParams:t})}},{key:"navigatePage",value:function(e){var t=this;if(e){var n={pageKey:e.pageKey,fullpage:this.isFullPage?"true":"false"};n[e.type]=e.itemID,this.canInitialize=!1,this.router.navigate(["/page"],{queryParams:n}),e.pageKey===this.currentPageKey&&(n.datafile===this.thisDataFileID&&"filePages"===this.entryType||n.result===this.thisResultID&&"resultPages"===this.entryType||n.project&&"indexPages"===this.entryType)&&setTimeout(function(){return t.canInitialize=!0},10)}}},{key:"toggleFullPage",value:function(e){var t={pageKey:this.currentPageKey,fullpage:e?"true":"false",project:void 0,result:void 0,datafile:void 0,static:void 0,proxy:void 0};"indexPages"===this.entryType?t.project=this.currentProject.id:"resultPages"===this.entryType?(t.result=this.currentResult.id,t.proxy=!1):"filePages"===this.entryType?t.datafile=this.currentDataFile.id:"staticPages"===this.entryType?(t.datafile=this.currentDataFile.id,t.static=!0):"proxyPages"===this.entryType&&(t.result=this.currentResult.id,t.proxy=!0),this.router.navigate(["/page"],{queryParams:t})}},{key:"requestFullPage",value:function(e){var t=window.innerWidth<1024;this.systemService.toggleNavbar(!e),e?this.systemService.toggleSidebar(!1):t||this.systemService.toggleSidebar(!0)}},{key:"toggleRightSideMenu",value:function(e){var t=this;setTimeout(function(){t.displayRightSideMenu=void 0===e?!t.displayRightSideMenu:!!e})}},{key:"ngOnDestroy",value:function(){this._subs.forEach(function(e){return e.unsubscribe()})}}]),e}()).\u0275fac=function(e){return new(e||$t)(ue.Ob(pe.a),ue.Ob(pe.c),ue.Ob(he.a),ue.Ob(ge.a),ue.Ob(de.a),ue.Ob(fe.a),ue.Ob(be.a))},$t.\u0275cmp=ue.Ib({type:$t,selectors:[["bdp-page"]],viewQuery:function(e,t){var n;1&e&&ue.Qc(ut,1),2&e&&ue.xc(n=ue.dc())&&(t.sandbox=n.first)},decls:4,vars:5,consts:[["class","breadcrumb",4,"ngIf"],[1,"bdp-main-container",3,"resize"],["style","display: block;",3,"currentProject","currentResult","currentDataFile","currentPackages","currentUser","isFullPage","keyOrders","validPages","pageKey","entryType","mode","pageChange","requestNavigation","requestFullPage","rightSideMenuStateChange","modeChage",4,"ngIf"],["class","chi-right-menu",4,"ngIf"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],[3,"routerLink",4,"ngIf"],["class","breadcrumb-item active",4,"ngIf"],[1,"breadcrumb-item","active"],[4,"ngIf"],[1,"text-muted"],["target","_blank",3,"routerLink"],[1,"fas","fa-external-link-alt","fa-fw","ml-2"],[2,"display","block",3,"currentProject","currentResult","currentDataFile","currentPackages","currentUser","isFullPage","keyOrders","validPages","pageKey","entryType","mode","pageChange","requestNavigation","requestFullPage","rightSideMenuStateChange","modeChage"],["sandbox",""],[1,"chi-right-menu"],[1,"chi-rbtn",3,"click"],["class","fa fa-angle-right fa-fw",4,"ngIf"],["class","fa fa-angle-left fa-fw",4,"ngIf"],[1,"chi-rbtn-content","ml-2"],[1,"chi-rbtn-arrow"],["aria-hidden","true",1,"fas","fa-arrow-left","fa-fw"],[1,"chi-rbtn-content"],["aria-hidden","true",1,"fas","fa-arrow-right","fa-fw"],["aria-hidden","true",1,"fas","fa-expand","fa-fw"],["aria-hidden","true",1,"fas","fa-sync-alt","fa-fw"],[1,"fas","fa-th-large","fa-fw"],[1,"fas","fa-fw"],[1,"fa","fa-angle-right","fa-fw"],[1,"fa","fa-angle-left","fa-fw"]],template:function(e,t){1&e&&(ue.Jc(0,Dt,16,12,"ol",0),ue.Ub(1,"div",1),ue.cc("resize",function(e){return t.onResize(e)},!1,ue.Ac),ue.Jc(2,Ut,2,11,"bdp-sandbox",2),ue.Tb(),ue.Jc(3,Ot,52,25,"div",3)),2&e&&(ue.nc("ngIf",!t.isFullPage),ue.Cb(1),ue.Gc("padding",t.isFullPage?"0px":"7px"),ue.Cb(1),ue.nc("ngIf",t.canInitialize&&t.currentProject&&t.currentPackages&&t.currentUser),ue.Cb(1),ue.nc("ngIf",t.displayRightSideMenu))},directives:[d.n,pe.f,ot],styles:[""],data:{animation:[me.a]}}),$t),zt=o("MKys"),Jt=pe.g.forChild([{path:"",component:Vt}]),Nt=[zt.a],Et=((Bt=function e(){n(this,e)}).\u0275fac=function(e){return new(e||Bt)},Bt.\u0275mod=ue.Mb({type:Bt}),Bt.\u0275inj=ue.Lb({providers:[Nt],imports:[[d.c,g.d,h.b,p.g,f.c,b.b,ye,Jt]]}),Bt)}}])}();