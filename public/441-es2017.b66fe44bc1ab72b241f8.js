(self.webpackChunkbdp_client=self.webpackChunkbdp_client||[]).push([[441],{68441:function(e,t,i){"use strict";i.r(t),i.d(t,{PageModule:function(){return zt}});var s=i(38583),r=i(3679),n=i(51095),a=i(90171),o=i(49983),l=i(65939),c=i(93738),u=i(7539),d=i(22238),g=i(1769),h=i(98295),p=i(4885),f=i(32789),y=i(77746),v=i(84251),x=i(41103),m=i(58846),b=i(16304),P=i(64762),T=i(31680),Z=i(48821),k=i(26215),w=i(79765),I=i(93342),A=i(12627),F=i(5304),C=i(25917);const S=(e,t)=>t.some(t=>e instanceof t);let q,j;const _=new WeakMap,D=new WeakMap,U=new WeakMap,M=new WeakMap,R=new WeakMap;let N={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return D.get(e);if("objectStoreNames"===t)return e.objectStoreNames||U.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return z(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function J(e){N=e(N)}function z(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,i)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",n)},r=()=>{t(z(e.result)),s()},n=()=>{i(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",n)});return t.then(t=>{t instanceof IDBCursor&&_.set(t,e)}).catch(()=>{}),R.set(t,e),t}(e);if(M.has(e))return M.get(e);const t=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(j||(j=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(O(this),e),z(_.get(this))}:function(...e){return z(t.apply(O(this),e))}:function(e,...i){const s=t.call(O(this),e,...i);return U.set(s,e.sort?e.sort():[e]),z(s)}:(e instanceof IDBTransaction&&function(e){if(D.has(e))return;const t=new Promise((t,i)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",n),e.removeEventListener("abort",n)},r=()=>{t(),s()},n=()=>{i(e.error),s()};e.addEventListener("complete",r),e.addEventListener("error",n),e.addEventListener("abort",n)});D.set(e,t)}(e),S(e,q||(q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,N):e);var t}(e);return t!==e&&(M.set(e,t),R.set(t,e)),t}const O=e=>R.get(e),Q=["get","getKey","getAll","getAllKeys","count"],B=["put","add","delete","clear"],L=new Map;function V(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(L.get(t))return L.get(t);const i=t.replace(/FromIndex$/,""),s=t!==i,r=B.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!Q.includes(i))return;const n=function(){var e=(0,b.Z)(function*(e,...t){const n=this.transaction(e,r?"readwrite":"readonly");let a=n.store;s&&(a=a.index(t.shift()));const o=a[i](...t);return r&&(yield n.done),o});return function(t){return e.apply(this,arguments)}}();return L.set(t,n),n}function Y(e){this.wrapped=e}function K(e){return new Y(e)}function E(e){var t,i;function s(t,i){try{var n=e[t](i),a=n.value,o=a instanceof Y;Promise.resolve(o?a.wrapped:a).then(function(e){o?s("return"===t?"return":"next",e):r(n.done?"return":"normal",e)},function(e){s("throw",e)})}catch(l){r("throw",l)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?s(t.key,t.arg):i=null}this._invoke=function(e,r){return new Promise(function(n,a){var o={key:e,arg:r,resolve:n,reject:a,next:null};i?i=i.next=o:(t=i=o,s(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}function H(e){return function(){return new E(e.apply(this,arguments))}}J(e=>({get:(t,i,s)=>V(t,i)||e.get(t,i,s),has:(t,i)=>!!V(t,i)||e.has(t,i)})),E.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},E.prototype.next=function(e){return this._invoke("next",e)},E.prototype.throw=function(e){return this._invoke("throw",e)},E.prototype.return=function(e){return this._invoke("return",e)};const G=["continue","continuePrimaryKey","advance"],W={},X=new WeakMap,ee=new WeakMap,te={get(e,t){if(!G.includes(t))return e[t];let i=W[t];return i||(i=W[t]=function(...e){X.set(this,ee.get(this)[t](...e))}),i}};function ie(){return se.apply(this,arguments)}function se(){return(se=H(function*(...e){let t=this;if(t instanceof IDBCursor||(t=yield K(t.openCursor(...e))),!t)return;t=t;const i=new Proxy(t,te);for(ee.set(i,t),R.set(i,O(t));t;)yield i,t=yield K(X.get(i)||t.continue()),X.delete(i)})).apply(this,arguments)}function re(e,t){return t===Symbol.asyncIterator&&S(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&S(e,[IDBIndex,IDBObjectStore])}J(e=>({get:(t,i,s)=>re(t,i)?ie:e.get(t,i,s),has:(t,i)=>re(t,i)||e.has(t,i)}));var ne=i(19918),ae=i(91841),oe=i(37716),le=i(52468),ce=i(354),ue=i(43037),de=i(38864),ge=i(89876),he=i(15128);let pe=(()=>{class e{constructor(e,t,i,s,r,n,a,o){this.dataService=e,this.projectService=t,this.infoService=i,this.taskService=s,this.accountService=r,this.systemService=n,this.http=a,this.router=o,this.client$=new k.X(null),this.currentProject$=new k.X(null),this.currentResult$=new k.X(null),this.currentDataFile$=new k.X(null),this.currentPackages$=new k.X([]),this.currentPackageID="",this.currentUser$=new k.X(null),this.currentIndexedDB$=new k.X(null),this.entryType$=new k.X(null),this.currentPageKey$=new k.X(null),this.requestNavigation$=new w.xQ,this.isFullPage$=new k.X(!1),this.showRightMenu$=new k.X(!0),this.pageMode$=new k.X("page"),this.refresh$=new w.xQ,this.logItems=[],this.currentPageKey$.subscribe(e=>{if(e&&e.split){const t=e.split(":");Array.isArray(t)&&2===t.length&&(this.currentPackageID=t[0])}})}_logItem(e){const t={};t[e.type]=e,this.logItems.push(t)}_sleep(e){return(0,b.Z)(function*(){return new Promise(t=>setTimeout(t,e))})()}sendToClient(e){e.type=e.type||"received",this._logItem(e);const t=this.client$.getValue();if(t)try{t.nativeElement.contentWindow.postMessage(e,"*")}catch(i){try{t.nativeElement.contentWindow.postMessage(JSON.parse(JSON.stringify(e)),"*")}catch(s){console.log(s)}}}_requestIDB(e,t,i,s){return(0,b.Z)(function*(){return t=t||1,console.log(`open database: ${e}`),yield function(e,t,{blocked:i,upgrade:s,blocking:r}={}){const n=indexedDB.open(e,t),a=z(n);return s&&n.addEventListener("upgradeneeded",e=>{s(z(n.result),e.oldVersion,e.newVersion,z(n.transaction))}),i&&n.addEventListener("blocked",()=>i()),r&&a.then(e=>e.addEventListener("versionchange",r)).catch(()=>{}),a}(e,t,{upgrade:e=>{if(!i)return;const t=Object.keys(i);for(const r of t){const t=e.createObjectStore(r,i[r]);if(s&&s[r]){const e=s[r];t.createIndex(e.indexName,e.keyPath,e.objectParameters)}}}})})()}_changeMode(e){const t=this.pageMode$.getValue();void 0===e&&(e="list"===t?"page":"list"),this.pageMode$.next("list"===e?"list":"page")}_toggleFullPage(e){const t=!this.isFullPage$.getValue();this.isFullPage$.next(void 0===e?t:e)}isValidAPI(e){return!(["constructor","_logItem","sendToClient","_sleep","_changeMode","_toggleFullPage"].indexOf(e)>=0)&&0!==e.indexOf("_")&&void 0!==this[e]&&"function"==typeof this[e]}historyBack(){window.history.go(-1)}historyForward(){window.history.go(1)}log(e,t){this.logItems.push({log:JSON.parse(JSON.stringify(t))})}handshake(e,t){this.sendToClient({id:e,call:"handshake"})}createProject(e,t){const i=this.projectService.createProject(t.projectName,t.projectDesc,t.packages,t.isPublic).subscribe(t=>(i.unsubscribe(),t.isError?(this.sendToClient({id:e,call:"createProject",type:"error",value:JSON.stringify(t.errors)}),this.sendToClient({call:"createProject",id:e,value:null})):t.success&&t.success.getModel?this.sendToClient({call:"createProject",id:e,type:"recieved",value:t.success.getModel()}):(this.sendToClient({id:e,call:"createProject",type:"error",value:"Failed to get the newly created project."}),void this.sendToClient({call:"createProject",id:e,value:null}))))}importFilesToProject(e,t){const i=this.projectService.importFilesToProject(t.projectID,t.fileIDs,!!t.copy,!0).subscribe(t=>{i.unsubscribe(),t.isError?(this.sendToClient({id:e,call:"importFilesToProject",type:"error",value:JSON.stringify(t.errors)}),this.sendToClient({id:e,call:"importFilesToProject",value:[]})):this.sendToClient({id:e,call:"importFilesToProject",value:t.success.map(e=>e&&e.getModel?e.getModel():e)})})}getAuthToken(e){const t=this.accountService.getAuthToken().subscribe(i=>(t.unsubscribe(),this.sendToClient(i.isError?{call:"getAuthToken",id:e,value:null}:{call:"getAuthToken",id:e,value:i.success})))}listProjects(e,t){const i=t.type,s=this.projectService["shared"===i?"getSharedProjects":"public"===i?"getPublicProjects":"getProjects"](t.pageIndex,t.pageSize).subscribe(i=>{if(s.unsubscribe(),i.isError)return this.sendToClient({id:e,call:"listProjects",type:"error",value:JSON.stringify(i.errors)}),this.sendToClient({id:e,call:"listProjects",value:{recors:[],totalPage:0,pageIndex:t.pageIndex,totalCount:0,pageSize:t.pageSize}});const r=i.success;this.sendToClient({id:e,call:"listProjects",value:{records:Array.isArray(r.records)?r.records.map(e=>e.getModel()):[],totalPage:r.totalPage,pageIndex:r.pageIndex,totalCount:r.totalCount,pageSize:r.pageSize}})})}listFiles(e){const t=this.currentProject$.getValue();this.sendToClient({call:"listFiles",id:e,value:t&&Array.isArray(t.dataFiles)?t.dataFiles.map(e=>e.getModel()):[]})}listResults(e){const t=this.currentProject$.getValue();this.sendToClient({call:"listResults",id:e,value:t&&Array.isArray(t.results)?t.results.map(e=>e.getModel(t.dataFiles)):[]})}listTasks(e,t){const i=this.taskService.getTasks(t.packageID||this.currentPackageID,t.only).subscribe(t=>{i.unsubscribe(),this.sendToClient({id:e,call:"listTasks",type:"received",value:Array.isArray(t.success)?t.success.map(e=>e.getModel()):[]})})}listPackages(e){const t=this.projectService.getRelatedPackages().subscribe(i=>{t.unsubscribe(),this.sendToClient({id:e,call:"listPackages",type:"received",value:Array.isArray(i.success)?i.success.map(e=>e.getModel()):[]})})}listAllTasks(e){const t=this.currentProject$.getValue();if(!t)return this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."}),void this.sendToClient({id:e,call:"listAllTasks",type:"received",value:[]});const i=t.packages;if(Array.isArray(i)){const t=this.taskService.getTasks(i.map(e=>e.id).join(",")).subscribe(i=>{t.unsubscribe(),this.sendToClient({id:e,call:"listAllTasks",type:"received",value:Array.isArray(i.success)?i.success.map(e=>e.getModel()):[]})})}}getCurrentUserInfo(e){const t=this.currentUser$.getValue();this.sendToClient({id:e,call:"getCurrentUserInfo",type:"received",value:t&&t.getModel?t.getModel():{}})}getCurrentFileInfo(e){const t=this.currentDataFile$.getValue();this.sendToClient({id:e,call:"getCurrentFileInfo",type:"received",value:t?t.getModel():null})}getCurrentResultInfo(e){const t=this.currentResult$.getValue();if(!t)return this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:null});const i=this.currentProject$.getValue();if(!i)return this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."}),void this.sendToClient({id:e,call:"listAllTasks",type:"received",value:null});const s=t.getModel(i.dataFiles);if("workflow"!==t.type)this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:s});else{const r=i.results.map(e=>e.id),n=[],a=t.children;for(let e=0;e<a.length;e++)if(n[e]=[],Array.isArray(a[e]))for(let s=0;s<a[e].length;s++){const o=r.indexOf(a[e][s]);n[e][s]=o>=0&&i.results[o]&&i.results[o].parent===t.id?i.results[o].getModel(i.dataFiles):{}}s.children=n,this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:s})}}getCurrentPackageInfo(e){const t=this.currentPackages$.getValue(),i=this.currentPackageID,s=t.filter(e=>e.id===i);this.sendToClient({id:e,call:"getCurrentPackageInfo",type:"received",value:s.length>0?s[0].getModel():{}})}getCurrentProjectInfo(e){const t=this.currentProject$.getValue();this.sendToClient({id:e,call:"getCurrentProjectInfo",type:"received",value:t?t.getModel():{}})}getProjectInfo(e,t){const i=this.projectService.loadProjectInfo(t.projectID).subscribe(t=>(i.unsubscribe(),t.isError?(this.sendToClient({id:e,call:"getProjectInfo",type:"error",value:JSON.stringify(t.isError)}),this.sendToClient({id:e,call:"getProjectInfo",value:null})):this.sendToClient({id:e,call:"getProjectInfo",value:t.success.getModel()})))}getTaskArguments(e,t){const i=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(s=>{if(i.unsubscribe(),s.isError)return this.sendToClient({id:e,call:"getTaskArguments",type:"error",value:JSON.stringify(s.errors)});const r=t.identifier,n=s.success.filter(e=>e.id===r||e.key===r)[0];if(!n)return this.sendToClient({id:e,call:"getTaskArguments",type:"error",value:`There is no such task with the id/key: ${r}`}),this.sendToClient({id:e,call:"getTaskArguments",type:"received",value:[]});this.sendToClient({id:e,call:"getTaskArguments",type:"received",value:n.arguments.map(e=>e.getModel())})})}getTaskInfo(e,t){const i=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(s=>{if(i.unsubscribe(),s.isError)return this.sendToClient({id:e,call:"getTaskInfo",type:"error",value:JSON.stringify(s.errors)});const r=t.identifier,n=s.success.filter(e=>e.id===r||e.key===r)[0];if(!n)return this.sendToClient({id:e,call:"getTaskInfo",type:"error",value:`There is no such task with the id/key: ${r}`}),this.sendToClient({id:e,call:"getTaskInfo",type:"received",value:{}});this.sendToClient({id:e,call:"getTaskInfo",type:"received",value:n.getModel()})})}getTaskInputGuide(e,t){const i=t.identifier,s=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(t=>{if(s.unsubscribe(),t.isError)return this.sendToClient({id:e,call:"getTaskInputGuide",type:"error",value:JSON.stringify(t.errors)});const r=t.success,n=this.currentProject$.getValue(),a=r.filter(e=>e.id===i||e.key===i)[0];if(!a)return this.sendToClient({id:e,call:"getTaskInputGuide",type:"error",value:`There is no such task with the id/key: ${i}`}),this.sendToClient({id:e,call:"getTaskInputGuide",type:"received",value:[]});const o=this.taskService.taskValidInputs$.subscribe(t=>{o.unsubscribe();const i=a.arguments.map(e=>"outFile"===e.type?null:e.getModel());t.forEach(e=>{const t=e.index;i[t]&&"inFile"===i[t].type&&(i[t].candidates=e.models.map(e=>e.getModel()))});const s=a.arguments.filter(e=>"outFile"===e.type).map(e=>e.getModel());this.sendToClient({id:e,call:"getTaskInputGuide",type:"received",value:{inputs:i,outputs:s}})});n&&this.taskService.getValidInputFile(a.id,n.id)})}executeTask(e,t){const i=t.identifier,s=t.resultInfo,r=t.inputs,n=t.outputs,a=[],o=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe(t=>{o.unsubscribe();const l=t.success;let c=this.currentProject$.getValue();if(!c)return;const u=l.filter(e=>e.id===i||e.key===i)[0];if(!u)return this.sendToClient({id:e,call:"executeTask",type:"error",value:`There is no such task with the id/key: ${i}`}),this.sendToClient({id:e,call:"executeTask",type:"received",value:{}});if(r.length!==u.arguments.length)return this.sendToClient({id:e,call:"executeTask",type:"error",value:"The length of inputs does not match the length of the task arguments."}),this.sendToClient({id:e,call:"executeTask",type:"received",value:{}});if(u.arguments.forEach((e,t)=>{switch(e.type){case"static":r[t]=e.default[0];break;case"value":r[t]=String(null==r[t]?e.default[0]||"":r[t]||"");break;case"list":Array.isArray(r[t])||(r[t]=[r[t]]),r[t]=r[t].filter(t=>e.list.indexOf(t)>=0),e.multiple||(r[t]=[r[t][0]]),0===r[t].filter(e=>null!=e).length&&a.push({index:t,error:"No valid items to select"});break;case"inFile":if(!c)break;const i=c.dataFiles.filter(e=>e.id===r[t])[0];if(i){const s=e.isValidFile(i);s.result||a.push({index:t,error:s.reason})}else e.optional||a.push({index:t,error:"No valid file selected"});break;case"outFile":r[t]=null}}),a.length>0)return this.sendToClient({id:e,call:"executeTask",type:"error",value:a}),this.sendToClient({id:e,call:"executeTask",type:"received",value:null});s.prefix=String(s.prefix||""),s.suffix=String(s.suffix||""),u.arguments.filter(e=>"outFile"===e.type).forEach((e,t)=>{n[t]?(n[t].name=void 0!==n[t].name?String(n[t].name||""):e.name,n[t].desc=void 0!==n[t].desc?String(n[t].desc||""):"",n[t].prefix=void 0!==n[t].prefix?String(n[t].prefix):s.prefix,n[t].suffix=void 0!==n[t].suffix?String(n[t].suffix):s.suffix):n[t]={name:e.name,desc:"",prefix:s.prefix,suffix:s.suffix}}),s.name=s&&void 0!==s.name?String(s.name):`Result from ${u.name}`,s.desc=s&&void 0!==s.desc?String(s.desc):"",s.name=s.name.slice(0,160),s.desc=s.desc.slice(0,500),s.prefix=s.prefix.slice(0,160),s.suffix=s.suffix.slice(0,160);const d=this.projectService.createResult(u.id,{run:!0,projectID:c.id,inputs:r,outputs:n,name:s.name,desc:s.desc,prefix:s.prefix||"",suffix:s.suffix||""}).subscribe(t=>(d.unsubscribe(),t.isError?(t.errors.forEach(t=>this.sendToClient({id:e,call:"executeTask",type:"error",value:t})),this.sendToClient({id:e,call:"executeTask",type:"received",value:{}})):(c=this.currentProject$.getValue(),this.sendToClient({id:e,call:"executeTask",type:"received",value:t.success.getModel(c?c.dataFiles:[])}))))})}updateResultInfo(e,t){const i=this.currentProject$.getValue();if(!i)return this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:"No project to update the Result information."});const s=t.resultID,r=t.newInfo,n=i.results.filter(e=>e.id===s)[0];if(!n)return this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:`Cannot find any Result with this Result ID (${s}) to update its information.`});const a=new T.x({id:s,name:r.name||n.name,prefix:r.prefix||n.prefix||"",suffix:r.suffix||n.suffix||"",desc:r.desc||n.desc}),o=this.projectService.updateResultInfo(a).subscribe(t=>(o.unsubscribe(),t.isError?t.errors.forEach(t=>this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:t})):this.sendToClient({id:e,call:"updateResultInfo",type:"received",value:t.success&&t.success.getModel?t.success.getModel(i.dataFiles):{}})))}stopResult(e,t){const i=this.projectService.stopResult(new T.x({id:t.resultID})).subscribe(t=>{i.unsubscribe();const s=this.currentProject$.getValue();return t.isError?t.errors.forEach(t=>this.sendToClient({id:e,call:"stopResult",type:"error",value:t})):this.sendToClient({id:e,call:"stopResult",type:"received",value:t.success&&t.success.getModel?t.success.getModel(s?s.dataFiles:[]):{}})})}deleteResult(e,t){const i=this.projectService.deleteResult(new T.x({id:t.resultID})).subscribe(t=>{i.unsubscribe();const s=this.currentProject$.getValue();return t.isError?t.errors.forEach(t=>this.sendToClient({id:e,call:"deleteResult",type:"error",value:t})):this.sendToClient({id:e,call:"deleteResult",type:"received",value:t.success&&t.success.getModel?t.success.getModel(s?s.dataFiles:[]):{}})})}getFileBlob(e,t){const i=t.fileID;let s=t.subPath||void 0;const r=this.currentProject$.getValue();if(!r)return void this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."});const n=r.dataFiles.filter(e=>e.id===i)[0];s&&"Folder"!==n.format&&(s=void 0);const a=this.dataService.downloadAsFileBlob(i,s).pipe((0,I.b)(t=>this.sendToClient({id:e,call:"getFileBlob",type:"event",value:t})),(0,A.Z)(),(0,F.K)(t=>(console.log(t),this._logItem({id:e,call:"getFileBlob",type:"log",value:t.toString()}),(0,C.of)({body:void 0})))).subscribe(t=>{a.unsubscribe(),this.sendToClient({id:e,call:"getFileBlob",type:"received",value:t.body})})}getDownloadLink(e,t){const i=t.fileID,s=t.subPath,r=t.authToken,n=this.currentProject$.getValue();if(!n)return void this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."});const a=n.dataFiles.filter(e=>e.id===i)[0];if(!a)return this._logItem({id:e,call:"getDownloadLink",type:"error",value:`This DataFile ID: ${i} is invalid.`}),this.sendToClient({id:e,call:"getDownloadLink",type:"received",value:null});if(r){if("Folder"===a.format&&s){const t=s.split("/").map(encodeURIComponent).join("/");return this.sendToClient({call:"getDownloadLink",id:e,value:`/data/static/${i}/${t}?authToken=${r}`})}return this.sendToClient({call:"getDownloadLink",id:e,value:`/data/api/dataFile/${i}/download?authToken=${r}`})}return this._logItem({id:e,call:"getDownloadLink",type:"error",value:"The authToken is unset. You have to call getAuthToken() to get the authToken."}),this.sendToClient({call:"getDownloadLink",id:e,value:null})}globFilesInFolder(e,t){const i=t.fileID,s=this.currentProject$.getValue(),r=t.globbyExprs;let n=!1;if(!s)return void this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."});if(s.dataFiles.filter(e=>e.id===i&&"Folder"===e.format).length>0||(this._logItem({id:e,call:"globFilesInFolder",type:"error",value:`This DataFile ID: ${i} is not a folder`}),n=!0),Array.isArray(r)||(this._logItem({id:e,call:"globFilesInFolder",type:"error",value:"The globbyExprs is not an array."}),n=!0),n)return this.sendToClient({id:e,call:"globFilesInFolder",type:"received",value:null});const a=this.dataService.globbyFilesInFolder(i,r).subscribe(t=>{a.unsubscribe(),this.sendToClient({id:e,call:"globFilesInFolder",type:"received",value:t.success})})}importFileFromPath(e,t){const i=this.currentProject$.getValue(),s=t.options,r=Array.isArray(s.tags)?s.tags:[];if(!i)return void this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."});const n=this.projectService.importFromPath(t.path,i.id,t.makeSymbolicLink,s.name,s.desc,s.prefix,s.suffix,r,s.folder,s.keepFileName).subscribe(t=>(n.unsubscribe(),t.isError?t.errors.forEach(t=>this.sendToClient({id:e,call:"importFileFromPath",type:"error",value:t})):this.sendToClient({id:e,call:"importFileFromPath",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})))}uploadFiles(e,t,i){const s=this.currentPackages$.getValue(),r=this.currentProject$.getValue(),n=t.options,a=[];if(!r)return void this.sendToClient({id:e,call:"listAllTasks",type:"error",value:"You have not selected a project as the current project."});Array.from(t.files).forEach((t,r)=>{let o,l=String(1+r);switch(l){case"1":l+="st";break;case"2":l+="nd";break;case"3":l+="rd";break;default:l+="th"}if(!(t instanceof File||t instanceof Blob))return this.sendToClient({id:e,call:i||"uploadFiles",type:"error",value:"The "+l+" file has wrong type. Should be File or Blob type."});if(t instanceof File&&(o=s.map(e=>e.checkAllowedFormat(t.name))),!o&&t instanceof Blob&&(o=s.map(e=>e.checkAllowedFormat(n.name+"."+n.format))),o=o.filter(e=>!!e),0===o.length){const t=[].concat.apply([],s.map(e=>e.allowedFormats));return this.sendToClient({id:e,call:i||"uploadFiles",type:"error",value:"The "+l+" file has wrong file extension. The allowed formats are: "+t.join(", ")})}a.push(t)});const o=Array.isArray(n.tags)?n.tags.map(e=>e.toLowerCase&&e.toLowerCase().replace(/[^a-zA-Z0-9\.\-\_]/g,"").trim()):[];let l=n.folderID,c=n.keepFileName;if(1!==r.dataFiles.filter(e=>e.id===l&&"Folder"===e.format).length&&(c=void 0,l=void 0),0===a.length)return this.sendToClient({id:e,call:i||"uploadFiles",type:"error",value:"No File item to upload"});const u=this.dataService.uploadFiles(r.id,a,{name:n.name||"",prefix:n.prefix||"",suffix:n.suffix||"",folder:l||"",keepFileName:c||!0,desc:n.desc||"",format:n.format,tags:o}).pipe((0,I.b)(t=>{this.sendToClient({id:e,call:i||"uploadFiles",type:"event",value:t})}),(0,A.Z)(),(0,F.K)(t=>(this._logItem({id:e,call:i||"uploadFiles",type:"log",value:t.toString()}),(0,C.of)({body:void 0})))).subscribe(t=>{if(u.unsubscribe(),t.body){const s=new ne.j(t.body);s.isError&&(this.infoService.addMessages(s.errors),s.errors.forEach(t=>this.sendToClient({id:e,call:i||"uploadFiles",type:"error",value:t}))),this.sendToClient({id:e,call:i||"uploadFiles",type:"received",value:s.success.map(e=>new Z.A(e).getModel())})}})}uploadFileBlob(e,t){this.uploadFiles(e,{files:[t.fileBlob],options:{name:t.name,prefix:t.prefix,suffix:t.suffix,desc:t.desc,tags:t.tags,folderID:t.folderID,format:t.format||"",keepFileName:!!t.keepFileName}},"uploadFileBlob")}createFolder(e,t){const i=this.currentProject$.getValue();if(!i)return this.sendToClient({id:e,call:"createFolder",type:"error",value:"No project to create the folder."});const s=t.name||"a folder",r=t.desc||"",n=t.prefix||"",a=t.suffix||"",o=Array.isArray(t.tags)?t.tags:[],l=this.projectService.createFolder(i.id,s,r,n,a,o,t.folderId,t.keepFileName).subscribe(t=>(l.unsubscribe(),!t.isError&&this.sendToClient({id:e,call:"createFolder",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})))}updateFileInfo(e,t){const i=this.currentProject$.getValue();if(!i)return this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:"No project to update the DataFile record."});const s=t.fileID,r=t.newInfo,n=i.dataFiles.filter(e=>e.id===s)[0];if(!n)return this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:`Cannot find any DataFile with this file ID (${s}) to update the information.`});if(Array.isArray(r.tags)){r.tags=r.tags.map(e=>"Folder"===e?e:e.toLowerCase().replace(/[^a-zA-Z0-9\.\-\_]/g,"")).filter(e=>!!e);const e=r.tags.indexOf("Folder"),t=n.tags.indexOf("Folder");t>=0&&-1===e?r.tags.unshift("Folder"):-1===t&&e>=0&&r.tags.splice(e,1)}else r.tags=n.tags.slice();const a=new Z.A({id:s,name:r.name||n.name,prefix:r.prefix||n.prefix,suffix:r.suffix||n.suffix,desc:r.desc||n.desc,tags:r.tags}),o=this.projectService.updateDataFileInfo(a).subscribe(t=>(o.unsubscribe(),t.isError?t.errors.forEach(t=>this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:t})):this.sendToClient({id:e,call:"updataFileInfo",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})))}deleteFile(e,t){const i=this.projectService.deleteDataFile(new Z.A({id:t.fileID})).subscribe(t=>(i.unsubscribe(),t.isError?t.errors.forEach(t=>this.sendToClient({id:e,call:"deleteFile",type:"error",value:t})):this.sendToClient({id:e,call:"deleteFile",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})))}_navigatePage(e,t,i,s){if(!e)return;const r=this.currentProject$.getValue();r&&(i=i||"",!(s=s||this.currentPackageID)&&Array.isArray(r.packages)&&r.packages[0]&&r.packages[0].id&&(s=s||r.packages[0].id),i&&s&&(i=s+":"+i),i?this.requestNavigation$.next({itemID:e,type:t,pageKey:i}):"proxyPages"!==t&&"staticPages"!==t||this.requestNavigation$.next({itemID:e,type:t,pageKey:i}))}navigateToProjectList(e,t){t||(t={listType:"myProjects",pageSize:30,pageIndex:0}),this.router.navigate(["/project/list"],{queryParams:{listType:t.listType||"myProjects",pageSize:t.pageSize||30,pageIndex:t.pageIndex||0}})}navigateToProjectPage(e,t){var i;this._navigatePage(null===(i=this.currentProject$.getValue())||void 0===i?void 0:i.id,"indexPages",t.pageKey,t.packageID)}navigateToFilePage(e,t){this._navigatePage(t.fileID,"filePages",t.pageKey,t.packageID)}navigateToResultPage(e,t){this._navigatePage(t.resultID,"resultPages",t.pageKey,t.packageID)}navigateToProxyPage(e,t){this._navigatePage(t.resultID,"proxyPages",t.jobID)}navigateToStaticPage(e,t){this._navigatePage(t.fileID,"staticPages",void 0)}navigateToBdpDataFile(e,t){this.router.navigate(["/dataFile",t.fileID,"info"])}navigateToBdpResult(e,t){this.router.navigate(["/result",t.resultID,"info"])}navigateToBdpProject(e,t){this.router.navigate(["/project",t.projectID,"info"])}listProxyJobs(e,t){const i=this.projectService.getProxyJobsByResultId(t.resultID).subscribe(t=>{i.unsubscribe(),this.sendToClient(t.isError?{id:e,call:"listProxyJobs",type:"received",value:[]}:{id:e,call:"listProxyJobs",type:"received",value:t.success})})}openFileLink(e,t){return window.open("/dataFile/"+t.fileID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openFileLink",type:"received",value:t.fileID})}openResultLink(e,t){return window.open("/result/"+t.resultID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openResultLink",type:"received",value:t.resultID})}openProjectLink(e,t){return window.open("/project/"+t.projectID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openProjectLink",type:"received",value:t.projectID})}openStaticLink(e,t){const i=this.currentProject$.getValue();if(i)if(i.dataFiles.filter(e=>e.status<=2&&"Folder"===e.format&&e.id===t.fileID)[0]){let i=t.subPath||"/";0!==i.indexOf("/")&&(i="/"+i),window.open(`/data/static/${t.fileID}${i}`,"","width=1024,height=768"),this.sendToClient({id:e,call:"openResultLink",type:"received",value:t.fileID})}else this.sendToClient({id:e,call:"openStaticLink",type:"error",value:`The DataFile id is invalid: ${t.fileID}. The file must be a folder.`})}requestHttp(e,t){var i=this;return(0,b.Z)(function*(){if(!t.path.match(/^\//))return i.sendToClient({id:e,call:"requestHttp",type:"error",value:"Invalid path to request server. You are supposed to request paths which begins with '/'."});const s=t.method.toUpperCase(),r=t.httpOptions.queryParams||null,n=t.httpOptions.headers||null;let a=new ae.LE,o=new ae.WM;if(r){const e=Object.keys(r);for(let t=0;t<e.length;t++){const i=e[t];a=a.set(i,r[i])}}if(n){const e=Object.keys(n);for(let t=0;t<e.length;t++){const i=e[t];o=o.set(i,n[i])}}const l=i.http.request(s,t.path,{body:t.httpOptions.requestBody||null,headers:o,observe:t.httpOptions.observe,params:a,withCredentials:!0,reportProgress:!!t.httpOptions.reportProgress,responseType:t.httpOptions.responseType}).pipe((0,I.b)(t=>i.sendToClient({id:e,call:"requestHttp",type:"event",value:t})),(0,A.Z)(),(0,F.K)(t=>(i.sendToClient({id:e,call:"requestHttp",type:"error",value:`${JSON.stringify(t)}`}),(0,C.of)(null)))).subscribe(t=>{l.unsubscribe(),i.sendToClient({id:e,call:"requestHttp",type:"received",value:t})})})()}requestDatabase(e,t){var i=this;return(0,b.Z)(function*(){var s,r,n;const a=i.entryType$.getValue(),o=i.currentPageKey$.getValue(),l=i.currentUser$.getValue();if(!l)return;const c="filePages"===a?null===(s=i.currentDataFile$.getValue())||void 0===s?void 0:s.id:"resultPages"===a?null===(r=i.currentResult$.getValue())||void 0===r?void 0:r.id:null===(n=i.currentProject$.getValue())||void 0===n?void 0:n.id,u=`${l.id}-${a}-${c}-${o}`;try{const s=yield i._requestIDB(u,t.version,t.objectStoreSettings,t.creatingIndexes);i.currentIndexedDB$.next(s),i.sendToClient({id:e,call:"requestDatabase",type:"received",value:"ok"})}catch(d){i.sendToClient({id:e,call:"requestDatabase",type:"error",value:`Failed to create DB: ${u}; \nerrors: ${JSON.parse(JSON.stringify(d))}`})}})()}requestDatabaseRemove(e){var t=this;return(0,b.Z)(function*(){var i,s,r;const n=t.currentIndexedDB$.getValue(),a=t.currentUser$.getValue(),o=t.entryType$.getValue(),l=t.currentPageKey$.getValue();if(!n)return;if(!a)return;const c="filePages"===o?null===(i=t.currentDataFile$.getValue())||void 0===i?void 0:i.id:"resultPages"===o?null===(s=t.currentResult$.getValue())||void 0===s?void 0:s.id:null===(r=t.currentProject$.getValue())||void 0===r?void 0:r.id,u=`${a.id}-${o}-${c}-${l}`;n&&n.close&&(n.close(),yield function(e,{blocked:t}={}){const i=indexedDB.deleteDatabase(e);return t&&i.addEventListener("blocked",()=>t()),z(i).then(()=>{})}(u)),t.sendToClient({id:e,call:"requestDatabaseRemove",type:"received",value:"ok"})})()}setDataStore(){return(0,b.Z)(function*(){})()}dataStoreCount(e,t){var i=this;return(0,b.Z)(function*(){const s=i.currentIndexedDB$.getValue();if(!s)return;const r=yield s.count(t.storeName,t.queryKeyRange);return i.sendToClient({id:e,call:"dataStoreCount",type:"received",value:r})})()}dataStoreAdd(e,t){var i=this;return(0,b.Z)(function*(){const s=i.currentIndexedDB$.getValue();if(!s)return;const r=t.dataItems,n=t.dataKeys||void 0;if(Array.isArray(r))try{const a=s.transaction(t.storeName,"readwrite");r.forEach((e,t)=>n&&n[t]?a.store.add(e,n[t]):a.store.add(e)),yield a.done,i.sendToClient({id:e,call:"dataStoreAdd",type:"received",value:"ok"})}catch(a){i.sendToClient({id:e,call:"dataStoreAdd",type:"error",value:"There are errors when adding data to the objectStore."})}})()}dataStorePut(e,t){var i=this;return(0,b.Z)(function*(){const s=i.currentIndexedDB$.getValue();if(!s)return;const r=t.dataItems,n=t.dataKeys||void 0;if(Array.isArray(r)){const a=s.transaction(t.storeName,"readwrite");return r.forEach((e,t)=>n&&n[t]?a.store.put(e,n[t]):a.store.put(e)),yield a.done,i.sendToClient({id:e,call:"dataStorePut",type:"received",value:"ok"})}})()}dataStoreQuery(e,t){var i=this;return(0,b.Z)(function*(){var s,r;const n=i.currentIndexedDB$.getValue();if(!n)return;const a=n.transaction(t.storeName);if(null!=t.indexName){const n=a.store.index(t.indexName);try{for(var o,l=(0,P.KL)(n.iterate(t.query));!(o=yield l.next()).done;)i.sendToClient({id:e,call:"dataStoreQuery",type:"event",value:o.value.value})}catch(c){s={error:c}}finally{try{o&&!o.done&&(r=l.return)&&(yield r.call(l))}finally{if(s)throw s.error}}}else{let s=yield a.store.openCursor(t.query);for(;s;)i.sendToClient({id:e,call:"dataStoreQuery",type:"event",value:s.value}),s=yield s.continue()}i.sendToClient({id:e,call:"dataStoreQuery",type:"received",value:"ok"})})()}dataStoreGet(e,t){var i=this;return(0,b.Z)(function*(){const s=i.currentIndexedDB$.getValue();if(!s)return;const r=t.indexName,n=t.storeName,a=t.key;let o;o=null==r?null==a?yield s.getAll(n):yield s.get(n,a):null==a?yield s.getAllFromIndex(n,r):yield s.getFromIndex(n,r,a),i.sendToClient({id:e,call:"dataStoreGet",type:"received",value:o})})()}dataStoreGetAllKey(){return(0,b.Z)(function*(){})()}dataStoreClear(e,t){var i=this;return(0,b.Z)(function*(){const s=i.currentIndexedDB$.getValue();if(s)try{s.clear(t.storeName),i.sendToClient({id:e,call:"dataStoreClear",type:"received",value:"ok"})}catch(r){i.sendToClient({id:e,call:"dataStoreClear",type:"error",value:`${JSON.parse(JSON.stringify(r))}`})}})()}refreshPage(e){this.refresh$.next(!0),this.sendToClient({id:e,call:"refreshPage",type:"received",value:"ok"})}toggleFullPage(e,t){this._toggleFullPage(t.isFullPage),setTimeout(()=>this.sendToClient({id:e,call:"toggleFullPage",type:"received",value:t.isFullPage}),200)}isFullPage(e){this.sendToClient({id:e,call:"isFullPage",type:"received",value:this.isFullPage$.getValue()})}toggleRightSideMenu(e,t){this.showRightMenu$.next(!!t.isShown),setTimeout(()=>this.sendToClient({id:e,call:"toggleRightSideMenu",type:"received",value:t.isShown}),200)}isShownRightSideMemu(e){this.sendToClient({id:e,call:"isShownRightSideMemu",type:"received",value:this.showRightMenu$.getValue()})}togglePageList(e,t){["list","page"].indexOf(t.mode||"")>=0?this._changeMode(t.mode):this._changeMode(),setTimeout(()=>this.sendToClient({id:e,call:"togglePageList",type:"received",value:this.pageMode$.getValue()}),10)}isShownPageList(e){this.sendToClient({id:e,call:"isShownPageList",type:"received",value:"list"===this.pageMode$.getValue()})}}return e.\u0275fac=function(t){return new(t||e)(oe.LFG(le.D),oe.LFG(ce.Y),oe.LFG(ue.C),oe.LFG(de.M),oe.LFG(ge.B),oe.LFG(he.o),oe.LFG(ae.eN),oe.LFG(m.F0))},e.\u0275prov=oe.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),fe=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=oe.oAB({type:e}),e.\u0275inj=oe.cJS({providers:[pe],imports:[[r.u5,m.Bz,s.ez,n.ot,g.t,a.To,u.p9,h.lN,c.QW,d.Is,f.p0,y.ie,p.Cq,v.v,x.s]]}),e})();var ye=i(39418),ve=i(8803),xe=i(63163),me=i(72458);function be(e,t){1&e&&(oe.TgZ(0,"span"),oe._uU(1,"Project Page"),oe.qZA())}function Pe(e,t){1&e&&(oe.TgZ(0,"span"),oe._uU(1,"Result Page"),oe.qZA())}function Te(e,t){1&e&&(oe.TgZ(0,"span"),oe._uU(1,"Project Page"),oe.qZA())}function Ze(e,t){1&e&&(oe.TgZ(0,"span"),oe._uU(1,"DataFile Page"),oe.qZA())}function ke(e,t){1&e&&(oe.TgZ(0,"span"),oe._uU(1,"Static Page"),oe.qZA())}function we(e,t){if(1&e&&(oe.TgZ(0,"h2"),oe._uU(1,"Page type: "),oe.YNc(2,be,2,0,"span",2),oe.YNc(3,Pe,2,0,"span",2),oe.YNc(4,Te,2,0,"span",2),oe.YNc(5,Ze,2,0,"span",2),oe.YNc(6,ke,2,0,"span",2),oe.qZA()),2&e){const e=oe.oxw();oe.xp6(2),oe.Q6J("ngIf","indexPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf","resultPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf","proxyPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf","filePages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf","staticPages"===e.entryType)}}let Ie=(()=>{class e{constructor(e,t){this.dialogRef=e,this.data=t,this.authorizedList={"allow-forms":!1,"allow-modals":!1,"allow-popups":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-same-origin":!1,"allow-scripts":!1,"allow-downloads":!1},this.entryType=t.entryType;const i=t.authorizedList,s=Object.keys(this.authorizedList);for(let r=0;r<s.length;r++){const e=s[r],t=i.indexOf(e)>=0;switch(e){case"allow-forms":this.authorizedList["allow-forms"]=t;break;case"allow-modals":this.authorizedList["allow-modals"]=t;break;case"allow-popups":this.authorizedList["allow-popups"]=t;break;case"allow-orientation-lock":this.authorizedList["allow-orientation-lock"]=t;break;case"allowed-pointer-lock":this.authorizedList["allow-pointer-lock"]=t;break;case"allow-downloads":this.authorizedList["allow-downloads"]=t;break;case"allow-scripts":this.authorizedList["allow-scripts"]=t;break;case"allow-same-origin":this.authorizedList["allow-same-origin"]=t}}}ngOnInit(){}save(){const e=Object.keys(this.authorizedList).filter(e=>!0===this.authorizedList[e]);this.dialogRef.close(e)}}return e.\u0275fac=function(t){return new(t||e)(oe.Y36(d.so),oe.Y36(d.WI))},e.\u0275cmp=oe.Xpm({type:e,selectors:[["authorize-sandbox"]],decls:65,vars:13,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-subheader",""],["mat-line","",3,"ngModel","disabled","ngModelChange"],["mat-line","",1,"ms-4"],["mat-line","",1,"ms-4","text-muted"],["mat-line","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-button","",3,"click"]],template:function(e,t){1&e&&(oe.TgZ(0,"h1",0),oe._uU(1,"Authorizing Page sandbox options"),oe.qZA(),oe.TgZ(2,"div",1),oe.YNc(3,we,7,5,"h2",2),oe.TgZ(4,"mat-list"),oe.TgZ(5,"h3",3),oe._uU(6,"The default authorized options"),oe.qZA(),oe.TgZ(7,"mat-list-item"),oe.TgZ(8,"mat-checkbox",4),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-scripts"]=e}),oe._uU(9,"Allow Scripts"),oe.qZA(),oe.TgZ(10,"span",5),oe._uU(11,"Page can execute javascripts."),oe.qZA(),oe.qZA(),oe.TgZ(12,"mat-list-item"),oe.TgZ(13,"mat-checkbox",4),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-modals"]=e}),oe._uU(14,"Allow Modal"),oe.qZA(),oe.TgZ(15,"span",5),oe._uU(16,"Page can create modal windows."),oe.qZA(),oe.qZA(),oe.TgZ(17,"mat-list-item"),oe.TgZ(18,"mat-checkbox",4),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-popups"]=e}),oe._uU(19,"Allow Pop-ups"),oe.qZA(),oe.TgZ(20,"span",5),oe._uU(21,"Page can create pop-up windows or create new tab in the browser."),oe.qZA(),oe.TgZ(22,"span",6),oe._uU(23,"*Note that created pages also follow the same sandbox options."),oe.qZA(),oe.qZA(),oe._UZ(24,"mat-divider"),oe.TgZ(25,"mat-list-item"),oe.TgZ(26,"mat-checkbox",7),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-downloads"]=e}),oe._uU(27,"Allow Downlading Files From Sandboxed Pages"),oe.qZA(),oe.TgZ(28,"span",5),oe._uU(29,"Page allows automatically downloading files. If this option checked, browser will still ask you the file downloading locations."),oe.qZA(),oe.qZA(),oe.TgZ(30,"h3",3),oe._uU(31,"The additional options"),oe.qZA(),oe.TgZ(32,"mat-list-item"),oe.TgZ(33,"mat-checkbox",7),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-orientation-lock"]=e}),oe._uU(34,"Allow Orientation Lock"),oe.qZA(),oe.TgZ(35,"span",5),oe._uU(36,"Page can lock the screen orientation."),oe.qZA(),oe.qZA(),oe.TgZ(37,"mat-list-item"),oe.TgZ(38,"mat-checkbox",7),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-pointer-lock"]=e}),oe._uU(39,"Allow Pointer Lock"),oe.qZA(),oe.TgZ(40,"span",5),oe._uU(41,"Page can use the Pointer Lock API."),oe.qZA(),oe.qZA(),oe._UZ(42,"mat-divider"),oe.TgZ(43,"h3",3),oe._uU(44,"The risk options"),oe.qZA(),oe.TgZ(45,"mat-list-item"),oe.TgZ(46,"mat-checkbox",7),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-forms"]=e}),oe._uU(47,"Allow Form Submission"),oe.qZA(),oe.TgZ(48,"span",5),oe._uU(49,"Page can submit form data."),oe.qZA(),oe.qZA(),oe.TgZ(50,"mat-list-item"),oe.TgZ(51,"mat-checkbox",4),oe.NdJ("ngModelChange",function(e){return t.authorizedList["allow-same-origin"]=e}),oe._uU(52,"Allow Same Origin"),oe.qZA(),oe.TgZ(53,"span",5),oe._uU(54,"Page can use cookie, indexedDB form data. Do NOT allow this unless you trust the content."),oe.qZA(),oe.TgZ(55,"span",6),oe._uU(56,"The "),oe.TgZ(57,"b"),oe._uU(58,"same-origin policy"),oe.qZA(),oe._uU(59,"is a critical security mechanism that restricts how a document or script loaded from one origin can interact with a resource from another origin. It helps isolate potentially malicious documents, reducing possible attack vectors. "),oe.qZA(),oe.qZA(),oe.qZA(),oe.qZA(),oe.TgZ(60,"div",8),oe.TgZ(61,"button",9),oe._uU(62,"Cancel"),oe.qZA(),oe.TgZ(63,"button",10),oe.NdJ("click",function(){return t.save()}),oe._uU(64,"Ok"),oe.qZA(),oe.qZA()),2&e&&(oe.xp6(3),oe.Q6J("ngIf",!1),oe.xp6(5),oe.Q6J("ngModel",t.authorizedList["allow-scripts"])("disabled","proxyPages"===t.entryType),oe.xp6(5),oe.Q6J("ngModel",t.authorizedList["allow-modals"])("disabled","proxyPages"===t.entryType),oe.xp6(5),oe.Q6J("ngModel",t.authorizedList["allow-popups"])("disabled","proxyPages"===t.entryType),oe.xp6(8),oe.Q6J("ngModel",t.authorizedList["allow-downloads"]),oe.xp6(7),oe.Q6J("ngModel",t.authorizedList["allow-orientation-lock"]),oe.xp6(5),oe.Q6J("ngModel",t.authorizedList["allow-pointer-lock"]),oe.xp6(8),oe.Q6J("ngModel",t.authorizedList["allow-forms"]),oe.xp6(5),oe.Q6J("ngModel",t.authorizedList["allow-same-origin"])("disabled","proxyPages"===t.entryType))},directives:[d.uh,d.xY,s.O5,y.i$,y.gs,y.Tg,u.oG,me.X2,r.JJ,r.On,g.d,d.H8,n.lW,d.ZT],encapsulation:2}),e})();var Ae=i(8956);function Fe(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"button",6),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw().index;return oe.oxw(2).uploadSettings[t].push([null])}),oe._uU(1,"Add"),oe.qZA()}}function Ce(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"button",6),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw().index,i=oe.oxw().index;return oe.oxw(2).removeFileInput(i,t)}),oe._uU(1,"Remove"),oe.qZA()}}function Se(e,t){if(1&e&&(oe.ynx(0),oe.TgZ(1,"div"),oe._UZ(2,"input",7),oe.YNc(3,Ce,2,0,"button",5),oe.qZA(),oe.BQk()),2&e){const e=t.index,i=oe.oxw().index,s=oe.oxw(2);oe.xp6(1),oe.uIk("id",s.eventID+"-"+i+"-"+e),oe.xp6(2),oe.Q6J("ngIf",0!==e)}}function qe(e,t){if(1&e&&(oe.ynx(0),oe.TgZ(1,"tr"),oe.TgZ(2,"td"),oe._uU(3),oe._UZ(4,"br"),oe.YNc(5,Fe,2,0,"button",5),oe.qZA(),oe.TgZ(6,"td"),oe.YNc(7,Se,4,2,"ng-container",4),oe.qZA(),oe._UZ(8,"td"),oe.qZA(),oe.BQk()),2&e){const e=t.$implicit,i=t.index,s=oe.oxw(2);oe.xp6(3),oe.hij(" ",e.displayInfo,""),oe.xp6(2),oe.Q6J("ngIf",e.multiple),oe.xp6(2),oe.Q6J("ngForOf",s.uploadSettings[i])}}function je(e,t){if(1&e&&(oe.ynx(0),oe.TgZ(1,"table",3),oe.TgZ(2,"thead"),oe.TgZ(3,"tr"),oe.TgZ(4,"th"),oe._uU(5,"Description"),oe.qZA(),oe.TgZ(6,"th"),oe._uU(7,"Upload"),oe.qZA(),oe.TgZ(8,"th"),oe._uU(9,"Progress"),oe.qZA(),oe.qZA(),oe.qZA(),oe.TgZ(10,"tbody"),oe.YNc(11,qe,9,3,"ng-container",4),oe.qZA(),oe.qZA(),oe.BQk()),2&e){const e=oe.oxw();oe.xp6(11),oe.Q6J("ngForOf",e.uploadSpec)}}let _e=(()=>{class e{constructor(e,t,i,s,r){this.el=e,this.dialogRef=t,this.uploader=i,this.infoService=s,this.data=r,this.multiple=!1,this.uploadSettings=[],this.uploadingObjects=[],this.pageInfo=r.page,this.currentProject=r.project,this.eventID=r.eventID,this.uploadSpec=r.uploadSettings}ngOnInit(){this.uploadSpec=[{folder:"",keepFileName:!1,name:"just-a-test",desc:"Testing!!",tags:["file","just","for","testing"],displayInfo:"This is a single file field",multiple:!1},{folder:"",keepFileName:!1,name:"Testing-2",desc:"Testing!!",tags:["file","just","for","testing"],displayInfo:"This is a multiple-file field",multiple:!0}],this.eventID="testabcd",this.uploadSettings=this.uploadSpec.map(e=>[null])}removeFileInput(e,t){$("#"+this.eventID+"-"+e+"-"+t).remove(),this.uploadSettings[e].splice(t,1)}ngOnDestroy(){}}return e.\u0275fac=function(t){return new(t||e)(oe.Y36(oe.SBq),oe.Y36(d.so),oe.Y36(Ae.F),oe.Y36(ue.C),oe.Y36(d.WI))},e.\u0275cmp=oe.Xpm({type:e,selectors:[["uploader-ui"]],viewQuery:function(e,t){if(1&e&&(oe.Gf(f.BZ,5),oe.Gf(oe.SBq,5)),2&e){let e;oe.iGM(e=oe.CRH())&&(t.uploaderProgress=e.first),oe.iGM(e=oe.CRH())&&(t.uploadElements=e)}},decls:10,vars:2,consts:[["mat-dialog-title",""],["mat-stroked-button","","mat-dialog-close",""],[4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],["name","fileInput","type","file"]],template:function(e,t){1&e&&(oe.TgZ(0,"h3",0),oe._uU(1,"File Uploader Helper"),oe.qZA(),oe.TgZ(2,"mat-dialog-actions"),oe.TgZ(3,"button",1),oe._uU(4,"Close"),oe.qZA(),oe.qZA(),oe._UZ(5,"br"),oe._UZ(6,"br"),oe._UZ(7,"br"),oe._uU(8),oe.YNc(9,je,12,1,"ng-container",2)),2&e&&(oe.xp6(8),oe.hij("\nYou are uploading files for the page: ",t.pageInfo.name,".\n"),oe.xp6(1),oe.Q6J("ngIf",t.currentProject))},directives:[d.uh,d.H8,n.lW,d.ZT,s.O5,s.sg],styles:[".my-drop-zone[_ngcontent-%COMP%]{font-size:1.25rem;background-color:#c8dadf;position:relative;padding:60px 20px;outline:2px dashed #92b0b3;outline-offset:-10px;transition:outline-offset .15s ease-in-out,background-color .15s linear}.nv-file-over[_ngcontent-%COMP%]{outline-offset:-20px;outline-color:#c8dadf;background-color:#fff}"]}),e})();var De=i(39075);const Ue=["client"],Me=["sandboxContainer"];function Re(e,t){if(1&e){const e=oe.EpF();oe.ynx(0),oe.TgZ(1,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw().historyBack()}),oe._UZ(2,"i",17),oe.qZA(),oe.TgZ(3,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw().historyForward()}),oe._UZ(4,"i",18),oe.qZA(),oe.TgZ(5,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw().reloadClient()}),oe._UZ(6,"i",19),oe.qZA(),oe.TgZ(7,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw().detectSizeChange()}),oe._UZ(8,"i",20),oe.qZA(),oe.TgZ(9,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw().changeMode()}),oe._UZ(10,"i",21),oe.qZA(),oe.TgZ(11,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw().authorizeSandbox()}),oe._UZ(12,"i",22),oe.qZA(),oe.TgZ(13,"button",16),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw()._toggleFullPage()}),oe._UZ(14,"i",23),oe.qZA(),oe.BQk()}if(2&e){const e=oe.oxw();oe.xp6(14),oe.ekj("fa-expand-arrows-alt",!e.isFullPage)("fa-compress-arrows-alt",e.isFullPage)}}function $e(e,t){if(1&e&&(oe.ynx(0),oe._uU(1),oe.BQk()),2&e){const e=oe.oxw();oe.xp6(1),oe.hij(" ",e.srcString," ")}}function Ne(e,t){if(1&e&&(oe.ynx(0),oe._uU(1),oe.BQk()),2&e){const e=oe.oxw();oe.xp6(1),oe.hij(" ",e.srcString," ")}}function Je(e,t){if(1&e&&(oe.ynx(0),oe._UZ(1,"ngx-json-viewer",26),oe._UZ(2,"mat-divider"),oe.BQk()),2&e){const e=oe.oxw(2).$implicit;oe.xp6(1),oe.Q6J("json",e)("expanded",!1)}}function ze(e,t){if(1&e&&(oe.ynx(0),oe.YNc(1,Je,3,2,"ng-container",0),oe.BQk()),2&e){const e=t.$implicit,i=oe.oxw(3);oe.xp6(1),oe.Q6J("ngIf","log"===e.key&&i.logFilter[2]||"sent"===e.key&&i.logFilter[0]||"received"===e.key&&i.logFilter[1]||"event"===e.key&&i.logFilter[3]||"error"===e.key&&i.logFilter[4]||"change"===e.key&&i.logFilter[5])}}function Oe(e,t){if(1&e&&(oe.ynx(0),oe.YNc(1,ze,2,1,"ng-container",25),oe.ALo(2,"keyvalue"),oe.BQk()),2&e){const e=t.$implicit;oe.xp6(1),oe.Q6J("ngForOf",oe.lcZ(2,1,e))}}function Qe(e,t){if(1&e&&(oe.TgZ(0,"div",24),oe.YNc(1,Oe,3,3,"ng-container",25),oe.qZA()),2&e){const e=oe.oxw();oe.xp6(1),oe.Q6J("ngForOf",e.sandboxAPI.logItems)}}function Be(e,t){1&e&&(oe.TgZ(0,"div",30),oe.TgZ(1,"h1",31),oe._uU(2,"Processing ... "),oe._UZ(3,"i",32),oe.qZA(),oe.qZA())}function Le(e,t){if(1&e&&oe._UZ(0,"img",52),2&e){const e=oe.oxw(2).$implicit,t=oe.oxw().$implicit,i=oe.oxw(4);oe.Q6J("src",i.validPages.get(t.id+":"+e).thumbnail,oe.LSH)}}function Ve(e,t){1&e&&oe._UZ(0,"i",53)}function Ye(e,t){1&e&&(oe.ynx(0),oe._uU(1,"Current Page"),oe.BQk())}function Ke(e,t){if(1&e&&oe._UZ(0,"img",54),2&e){const e=oe.oxw(2).$implicit,t=oe.oxw().$implicit,i=oe.oxw(4);oe.ekj("mt-4",i.activePageKey!==t.id+":"+e),oe.Q6J("src",i.validPages.get(t.id+":"+e).img,oe.LSH)}}function Ee(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"button",16),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw(2).$implicit,i=oe.oxw().$implicit;return oe.oxw(4).changePageKey(i.id+":"+t,i)}),oe._uU(1,"Select"),oe.qZA()}}function He(e,t){if(1&e&&(oe.TgZ(0,"div",47),oe.TgZ(1,"mat-card"),oe.TgZ(2,"mat-card-header"),oe.YNc(3,Le,1,1,"img",48),oe.YNc(4,Ve,1,0,"i",49),oe.TgZ(5,"mat-card-title"),oe._uU(6),oe.qZA(),oe.TgZ(7,"mat-card-subtitle"),oe.YNc(8,Ye,2,0,"ng-container",0),oe.qZA(),oe.qZA(),oe.YNc(9,Ke,1,3,"img",50),oe.TgZ(10,"mat-card-content"),oe.TgZ(11,"p"),oe._uU(12),oe.ALo(13,"slice"),oe.qZA(),oe.qZA(),oe.TgZ(14,"mat-card-actions"),oe.YNc(15,Ee,2,0,"button",51),oe.qZA(),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw().$implicit,t=oe.oxw().$implicit,i=oe.oxw(4);oe.xp6(1),oe.Udp("background-color",i.activePageKey===t.id+":"+e?"rgba(255, 255, 0, 0.3)":"transparent"),oe.xp6(2),oe.Q6J("ngIf",i.validPages.get(t.id+":"+e).thumbnail),oe.xp6(1),oe.Q6J("ngIf",!i.validPages.get(t.id+":"+e).thumbnail),oe.xp6(2),oe.Oqu(i.validPages.get(t.id+":"+e).name),oe.xp6(2),oe.Q6J("ngIf",i.activePageKey===t.id+":"+e),oe.xp6(1),oe.Q6J("ngIf",i.validPages.get(t.id+":"+e).img),oe.xp6(3),oe.Oqu(oe.Dn7(13,9,i.validPages.get(t.id+":"+e).desc,0,60)),oe.xp6(3),oe.Q6J("ngIf",i.activePageKey!==t.id+":"+e)}}function Ge(e,t){if(1&e&&(oe.ynx(0),oe.YNc(1,He,16,13,"div",46),oe.BQk()),2&e){const e=t.$implicit;oe.xp6(1),oe.Q6J("ngIf",e)}}function We(e,t){if(1&e&&(oe.TgZ(0,"div",41),oe.TgZ(1,"h3",42),oe._UZ(2,"i",43),oe._uU(3),oe._UZ(4,"i",44),oe._uU(5),oe.qZA(),oe.YNc(6,Ge,2,1,"ng-container",25),oe._UZ(7,"mat-divider",45),oe.qZA()),2&e){const e=t.$implicit,i=oe.oxw(4);oe.xp6(3),oe.hij(" ",e.fullname," from "),oe.xp6(2),oe.hij(" ",e.sheetName,""),oe.xp6(1),oe.Q6J("ngForOf",i.keyOrders[e.id])}}function Xe(e,t){if(1&e&&(oe.TgZ(0,"div",39),oe.YNc(1,We,8,3,"div",40),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(1),oe.Q6J("ngForOf",e.currentPackages)}}function et(e,t){1&e&&(oe.ynx(0),oe._uU(1,"Current Page"),oe.BQk())}function tt(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"button",16),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw(2).$implicit;return oe.oxw(4).changeProxyJob(t)}),oe._uU(1,"Select"),oe.qZA()}}function it(e,t){if(1&e&&(oe.TgZ(0,"div",58),oe.TgZ(1,"mat-card"),oe.TgZ(2,"mat-card-header"),oe._UZ(3,"i",53),oe.TgZ(4,"mat-card-title"),oe._uU(5),oe.qZA(),oe.TgZ(6,"mat-card-subtitle"),oe.YNc(7,et,2,0,"ng-container",0),oe.qZA(),oe.qZA(),oe.TgZ(8,"mat-card-content"),oe.TgZ(9,"h4"),oe._uU(10,"Proxy details"),oe.qZA(),oe.TgZ(11,"div",59),oe._uU(12),oe._UZ(13,"br"),oe._uU(14),oe._UZ(15,"br"),oe._uU(16),oe._UZ(17,"br"),oe._uU(18),oe._UZ(19,"br"),oe._uU(20),oe._UZ(21,"br"),oe.qZA(),oe.qZA(),oe.TgZ(22,"mat-card-actions"),oe.YNc(23,tt,2,0,"button",51),oe.qZA(),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw(),t=e.$implicit,i=e.index,s=oe.oxw(4);oe.xp6(1),oe.Udp("background-color",s.activePageKey===s.currentResult.id+"/"+t||s.activePageKey===s.currentResult.id&&0===i?"rgba(255, 255, 0, 0.3)":"transparent"),oe.xp6(4),oe.Oqu(t),oe.xp6(2),oe.Q6J("ngIf",s.activePageKey===s.currentResult.id+"/"+t||s.activePageKey===s.currentResult.id&&0===i),oe.xp6(5),oe.hij(" protocol: ",s.validPages.get(s.currentResult.id+":"+t).protocol,""),oe.xp6(2),oe.hij(" ip: ",s.validPages.get(s.currentResult.id+":"+t).ip,""),oe.xp6(2),oe.hij(" port: ",s.validPages.get(s.currentResult.id+":"+t).port,""),oe.xp6(2),oe.hij(" pathRewrite: ",s.validPages.get(s.currentResult.id+":"+t).pathRewrite,""),oe.xp6(2),oe.hij(" entry path: ",s.validPages.get(s.currentResult.id+":"+t).entryPath,""),oe.xp6(3),oe.Q6J("ngIf",!(s.activePageKey===s.currentResult.id+"/"+t||s.activePageKey===s.currentResult.id&&0===i))}}function st(e,t){if(1&e&&(oe.ynx(0),oe.YNc(1,it,24,10,"div",57),oe.BQk()),2&e){const e=t.$implicit;oe.xp6(1),oe.Q6J("ngIf",e)}}const rt=function(e){return["/result",e,"info"]};function nt(e,t){if(1&e&&(oe.TgZ(0,"div",55),oe.TgZ(1,"div",41),oe.TgZ(2,"h2",42),oe._uU(3," Proxy pages in the result '"),oe.TgZ(4,"b"),oe.TgZ(5,"a",56),oe.TgZ(6,"u"),oe._uU(7),oe.qZA(),oe._uU(8),oe.TgZ(9,"u"),oe._uU(10),oe.qZA(),oe.qZA(),oe.qZA(),oe._uU(11,"' "),oe.qZA(),oe.YNc(12,st,2,1,"ng-container",25),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(5),oe.Q6J("routerLink",oe.VKq(5,rt,e.currentResult.id)),oe.xp6(2),oe.Oqu(e.currentResult.prefix),oe.xp6(1),oe.Oqu(e.currentResult.name),oe.xp6(2),oe.Oqu(e.currentResult.suffix),oe.xp6(2),oe.Q6J("ngForOf",e.keyOrders[e.currentResult.id])}}function at(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"div",33),oe.TgZ(1,"div",34),oe.TgZ(2,"button",35),oe.NdJ("click",function(){return oe.CHM(e),oe.oxw(2).changeMode()}),oe._UZ(3,"i",36),oe.qZA(),oe.TgZ(4,"h1"),oe._uU(5,"Page entries"),oe.qZA(),oe.qZA(),oe._UZ(6,"mat-divider"),oe.YNc(7,Xe,2,1,"div",37),oe.YNc(8,nt,13,7,"div",38),oe.qZA()}if(2&e){const e=oe.oxw(2);oe.xp6(7),oe.Q6J("ngIf","staticPages"!==e.entryType&&"proxyPages"!==e.entryType),oe.xp6(1),oe.Q6J("ngIf","proxyPages"===e.entryType&&e.currentResult)}}function ot(e,t){if(1&e&&(oe.TgZ(0,"div",27),oe.YNc(1,Be,4,0,"div",28),oe.YNc(2,at,9,2,"div",29),oe.qZA()),2&e){const e=oe.oxw();oe.xp6(1),oe.Q6J("ngIf",e.frameProcessing&&"list"!==e.mode),oe.xp6(1),oe.Q6J("ngIf","list"===e.mode)}}let lt=(()=>{class e{constructor(e,t,i,s){this.sanitizer=e,this.dialog=t,this.systemService=i,this.sandboxAPI=s,this.client=null,this.sandboxContainer=null,this.currentProject=null,this.currentResult=null,this.currentDataFile=null,this.currentUser=null,this.currentPackages=[],this.entryType=null,this.keyOrders={},this.pageKey=null,this.validPages=new Map,this.mode="page",this.pageChange=new oe.vpe,this.requestNavigation=new oe.vpe,this.requestFullPage=new oe.vpe,this.rightSideMenuStateChange=new oe.vpe,this.modeChage=new oe.vpe,this.isFullPage=!1,this.sandboxAuthorizedSet=new Set(["allow-scripts","allow-modals","allow-popups","allow-downloads"]),this.src=this.sanitizer.bypassSecurityTrustResourceUrl(""),this.srcString=null,this.frameWidth=1024,this.frameHeight=768,this.logItems=[],this.frameProcessing=!1,this.logFilter=[!0,!0,!0,!1,!0,!1],this.activePageKey=null,this._subs=[]}get sandboxAuthorized(){return[...this.sandboxAuthorizedSet]}ngOnInit(){this.detectSizeChange(),this.client&&this.sandboxAPI.client$.next(this.client),this.systemService.toggleContentScrollbar(!1),this._subs.push(this.sandboxAPI.isFullPage$.subscribe(e=>this.requestFullPage.emit(e))),this._subs.push(this.sandboxAPI.showRightMenu$.subscribe(e=>this.rightSideMenuStateChange.emit(e))),this._subs.push(this.sandboxAPI.pageMode$.subscribe(e=>this.modeChage.emit(e))),this._subs.push(this.sandboxAPI.requestNavigation$.subscribe(e=>this.requestNavigation.emit(e))),this._subs.push(this.sandboxAPI.refresh$.subscribe(()=>this.reloadClient()))}ngOnChanges(e){let t=!1;for(const s in e)if("currentProject"===s){if(this.currentProject=e[s].currentValue,!this.currentProject)continue;this.sandboxAPI.currentProject$.next(this.currentProject),this.currentPackages=this.currentProject.packages,this.sandboxAPI.currentPackages$.next(this.currentPackages),e[s].currentValue&&e[s].previousValue&&e[s].currentValue.id!==e[s].previousValue.id&&(t=!0)}else if("currentResult"===s){if(this.currentResult=e[s].currentValue,!this.currentResult)continue;this.sandboxAPI.currentResult$.next(this.currentResult),e[s].currentValue&&e[s].previousValue&&e[s].currentValue.id!==e[s].previousValue.id&&(t=!0)}else if("currentDataFile"===s){if(this.currentDataFile=e[s].currentValue,!this.currentDataFile)continue;this.sandboxAPI.currentDataFile$.next(this.currentDataFile),e[s].currentValue&&e[s].previousValue&&e[s].currentValue.id!==e[s].previousValue.id&&(t=!0)}else"pageKey"===s?(this.activePageKey=e[s].currentValue,this.sandboxAPI.currentPageKey$.next(this.activePageKey),e[s].currentValue!==e[s].previousValue&&(t=!0)):"validPages"===s?this.validPages=e[s].currentValue:"entryType"===s?(this.entryType=e[s].currentValue,this.sandboxAPI.entryType$.next(this.entryType),e[s].currentValue!==e[s].previousValue&&(t=!0)):"currentPackages"===s?(this.currentPackages=e[s].currentValue,this.sandboxAPI.currentPackages$.next(this.currentPackages)):"isFullPage"===s?this.sandboxAPI.isFullPage$.next(e[s].currentValue):"mode"===s?(this.mode="list"===e[s].currentValue?"list":"page",this.sandboxAPI.pageMode$.next(this.mode)):"currentUser"===s&&(this.currentUser=e[s].currentValue,this.sandboxAPI.currentUser$.next(this.currentUser));const i=this.srcString||"";if("indexPages"===this.entryType&&(this.sandboxAPI.currentDataFile$.next(null),this.sandboxAPI.currentResult$.next(null)),"staticPages"===this.entryType||"proxyPages"===this.entryType||this.validPages.has(this.activePageKey||"")){let e=null;if("staticPages"===this.entryType&&this.currentDataFile)e=`/data/api/dataFile/${this.currentDataFile.id}/static`;else if("proxyPages"===this.entryType&&this.currentResult)e=`/result/${this.currentResult.id}`+(this.pageKey?`/${this.pageKey}`:"")+"/requestProxy",this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms");else if(this.activePageKey){const t=this.activePageKey.split(":")[0];e=`/page/api/${t}/${this.validPages.get(this.activePageKey).path}`}if(e&&e!==i){if(i.match(/^\/result\/.*?\/proxy\//)&&e.match(/^\/result\/.*\/requestProxy/))return;setTimeout(()=>{e&&(this.src=this.sanitizer.bypassSecurityTrustResourceUrl(e),this.srcString=e)}),this.logItems=[]}else t&&(this.src=this.securePagePath(""),this.srcString="","proxyPages"===this.entryType&&(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")),setTimeout(()=>{e&&(this.src=this.sanitizer.bypassSecurityTrustResourceUrl(e),this.srcString=e,this.currentIndexedDB=void 0)}));setTimeout(()=>this.detectSizeChange(),500)}else t&&("proxyPages"===this.entryType?(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")):(this.sandboxAuthorizedSet.delete("allow-same-origin"),this.sandboxAuthorizedSet.delete("allow-forms")),setTimeout(()=>{this.src=this.securePagePath(""),this.srcString="",this.currentIndexedDB=void 0}))}ngAfterViewInit(){setTimeout(()=>this.detectSizeChange(),1e3)}onResize(){clearTimeout(this.onResizeTimer),this.onResizeTimer=setTimeout(()=>this.detectSizeChange(),500)}reloadClient(e){const t=e||this.src,i=this.srcString;"proxyPages"===this.entryType&&(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")),this.src=this.securePagePath(""),this.srcString="",setTimeout(()=>{this.src=t,this.srcString=i,this.currentIndexedDB=void 0,this.onResize()},10)}changeMode(e){const t=this.sandboxAPI.pageMode$.getValue();this.sandboxAPI.pageMode$.next("list"==(e=e||"list"!==t?"list":"page")?"list":"page")}historyBack(){this.sandboxAPI.historyBack()}historyForward(){this.sandboxAPI.historyForward()}detectSizeChange(){if(!this.sandboxContainer)return;if(!this.client)return;this.frameWidth=$(this.sandboxContainer.nativeElement).innerWidth();const e=window.innerHeight,t=this.sandboxAPI.isFullPage$.getValue()?e-30:e-274;this.frameHeight=t}onSrcChanged(e){if(this.client)try{const e=this.client.nativeElement.contentWindow.location.pathname;if("blank"===e)return;this.srcString=e;const t=e.match(/^\/result\/(.*?)\/proxy\//);t&&(this.activePageKey=t[1])}catch(t){}}securePagePath(e,t){return e=e?e.replace(/^http[s]:/g,"").replace(/\.\./g,""):"",t&&(e=0===e.indexOf("/")?`/page/api/${t}${e}`:`/page/api/${t}/${e}`),this.sanitizer.bypassSecurityTrustResourceUrl(e)}changePageKey(e,t){e!==this.activePageKey&&this.pageChange.emit({page:this.validPages.get(e),package:t}),this.mode="page"}changeProxyJob(e){this.currentResult&&this.requestNavigation.next({itemID:this.currentResult.id,type:"proxyPages",pageKey:e})}_toggleFullPage(){this.sandboxAPI._toggleFullPage()}openUploaderUI(){this.dialog.open(_e,{minWidth:"90vw",minHeight:"90vh",disableClose:!0,data:{project:this.currentProject,page:this.activePageKey?this.validPages.get(this.activePageKey):void 0}})}notifyDataChange(e){this.sandboxAPI.sendToClient({id:"",call:"notifyDataChange",type:"change",value:e})}onMessagereceived(e){if(!e.data.call||!e.data.id)return;this.sandboxAPI.logItems.push({sent:e.data});const t=e.data.id,i=e.data.call,s=e.data.value;this.sandboxAPI.isValidAPI(i)?this.sandboxAPI[i](t,s):this.sandboxAPI.sendToClient({id:t,call:i,type:"error",value:`The call ${i} is not part of the API.`})}authorizeSandbox(){const e=this.dialog.open(Ie,{data:{authorizedList:this.sandboxAuthorized,entryType:this.entryType}}).afterClosed().subscribe(t=>{e.unsubscribe(),Array.isArray(t)&&(0===t.length?this.sandboxAuthorizedSet.add("allow-modal"):this.sandboxAuthorizedSet=new Set(t),this.reloadClient())})}ngOnDestroy(){this.systemService.toggleContentScrollbar(!0),clearTimeout(this.timeout),clearTimeout(this.onResizeTimer),this._subs.forEach(e=>e.unsubscribe())}}return e.\u0275fac=function(t){return new(t||e)(oe.Y36(De.H7),oe.Y36(d.uw),oe.Y36(he.o),oe.Y36(pe))},e.\u0275cmp=oe.Xpm({type:e,selectors:[["bdp-sandbox"]],viewQuery:function(e,t){if(1&e&&(oe.Gf(Ue,7),oe.Gf(Me,7)),2&e){let e;oe.iGM(e=oe.CRH())&&(t.client=e.first),oe.iGM(e=oe.CRH())&&(t.sandboxContainer=e.first)}},inputs:{currentProject:"currentProject",currentResult:"currentResult",currentDataFile:"currentDataFile",currentUser:"currentUser",currentPackages:"currentPackages",entryType:"entryType",keyOrders:"keyOrders",origin:"origin",pageKey:"pageKey",validPages:"validPages",mode:"mode",isFullPage:"isFullPage"},outputs:{pageChange:"pageChange",requestNavigation:"requestNavigation",requestFullPage:"requestFullPage",rightSideMenuStateChange:"rightSideMenuStateChange",modeChage:"modeChage"},features:[oe.TTD],decls:34,vars:21,consts:[[4,"ngIf"],[1,"px-3",2,"background-color","lightgray","width","100%",3,"hidden"],[1,"fas","fa-greater-than","mx-2"],[3,"hidden"],["expander",""],[2,"background-color","#F0F0F0",3,"collapsedHeight","expandedHeight"],[2,"color","#2d2d2d"],[1,"d-flex","justify-content-between","align-items-center"],[3,"ngModel","ngModelChange"],["mat-button","","color","warn",3,"click"],["style","max-height: 250px; overflow: auto;",4,"ngIf"],[2,"position","relative","overflow","auto","padding","0px",3,"resize"],["sandboxContainer",""],["frameborder","0",2,"position","relative",3,"width","height","src","message","load"],["client",""],["style","position: absolute; background-color: rgba(255, 255, 255, 0.9); top: 0px; left: 0px; right: 0px; bottom: 0px;",4,"ngIf"],["mat-stroked-button","",3,"click"],[1,"fas","fa-arrow-left"],[1,"fas","fa-arrow-right"],[1,"fas","fa-sync-alt"],[1,"fas","fa-expand"],[1,"fas","fa-th-large"],[1,"fas","fa-unlock"],[1,"fas"],[2,"max-height","250px","overflow","auto"],[4,"ngFor","ngForOf"],[2,"font-size","12px","padding","0px",3,"json","expanded"],[2,"position","absolute","background-color","rgba(255, 255, 255, 0.9)","top","0px","left","0px","right","0px","bottom","0px"],["style","position: absolute; top: 30px; left: 50%; transform: translateX(-50%) translateY(-30%);",4,"ngIf"],["class","p-3",4,"ngIf"],[2,"position","absolute","top","30px","left","50%","transform","translateX(-50%) translateY(-30%)"],[1,"display-4","text-center"],[1,"fas","fa-circle-notch","fa-spin"],[1,"p-3"],[1,"d-flex","flex-row"],["mat-stroked-button","",1,"me-2",3,"click"],[1,"fas","fa-times","fa-fw"],["class","container-fluid",4,"ngIf"],["class","contianer-fluid",4,"ngIf"],[1,"container-fluid"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12","text-muted"],[1,"fas","fa-cube","fa-lg","me-2"],[1,"fas","fa-cubes","fa-lg","me-2"],[1,"col-12","my-2"],["class","col-md-6 col-lg-4 col-xl-3 p-2",4,"ngIf"],[1,"col-md-6","col-lg-4","col-xl-3","p-2"],["mat-card-avatar","",3,"src",4,"ngIf"],["class","fas fa-scroll fa-fw fa-2x","mat-card-avatar","",4,"ngIf"],["mat-card-image","",3,"mt-4","src",4,"ngIf"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-card-avatar","",3,"src"],["mat-card-avatar","",1,"fas","fa-scroll","fa-fw","fa-2x"],["mat-card-image","",3,"src"],[1,"contianer-fluid"],[3,"routerLink"],["class","col-md-6 col-lg-4 p-2",4,"ngIf"],[1,"col-md-6","col-lg-4","p-2"],[1,"px-4"]],template:function(e,t){if(1&e&&(oe.YNc(0,Re,15,4,"ng-container",0),oe.TgZ(1,"div",1),oe.TgZ(2,"small"),oe._UZ(3,"i",2),oe.YNc(4,$e,2,1,"ng-container",0),oe.YNc(5,Ne,2,1,"ng-container",0),oe.qZA(),oe.qZA(),oe.TgZ(6,"mat-expansion-panel",3,4),oe.TgZ(8,"mat-expansion-panel-header",5),oe.TgZ(9,"mat-panel-title"),oe.TgZ(10,"span",6),oe._uU(11,"Console Logs"),oe.qZA(),oe.qZA(),oe.qZA(),oe.TgZ(12,"div",7),oe.TgZ(13,"div"),oe.TgZ(14,"mat-checkbox",8),oe.NdJ("ngModelChange",function(e){return t.logFilter[0]=e}),oe._uU(15,"Sent"),oe.qZA(),oe.TgZ(16,"mat-checkbox",8),oe.NdJ("ngModelChange",function(e){return t.logFilter[1]=e}),oe._uU(17,"Received"),oe.qZA(),oe.TgZ(18,"mat-checkbox",8),oe.NdJ("ngModelChange",function(e){return t.logFilter[2]=e}),oe._uU(19,"Logged"),oe.qZA(),oe.TgZ(20,"mat-checkbox",8),oe.NdJ("ngModelChange",function(e){return t.logFilter[3]=e}),oe._uU(21,"Events"),oe.qZA(),oe.TgZ(22,"mat-checkbox",8),oe.NdJ("ngModelChange",function(e){return t.logFilter[4]=e}),oe._uU(23,"Errors"),oe.qZA(),oe.TgZ(24,"mat-checkbox",8),oe.NdJ("ngModelChange",function(e){return t.logFilter[5]=e}),oe._uU(25,"Changes"),oe.qZA(),oe.qZA(),oe.TgZ(26,"button",9),oe.NdJ("click",function(){return t.sandboxAPI.logItems=[]}),oe._uU(27,"Clear logs"),oe.qZA(),oe.qZA(),oe.YNc(28,Qe,2,1,"div",10),oe.qZA(),oe.TgZ(29,"div",11,12),oe.NdJ("resize",function(){return t.onResize()},!1,oe.Jf7),oe.TgZ(31,"iframe",13,14),oe.NdJ("message",function(e){return t.onMessagereceived(e)},!1,oe.Jf7)("load",function(e){return t.onSrcChanged(e)}),oe.qZA(),oe.YNc(33,ot,3,2,"div",15),oe.qZA()),2&e){const e=oe.MAs(7);oe.Q6J("ngIf",!t.isFullPage),oe.xp6(1),oe.Q6J("hidden",t.isFullPage),oe.xp6(3),oe.Q6J("ngIf","staticPages"===t.entryType||"proxyPages"===t.entryType),oe.xp6(1),oe.Q6J("ngIf","staticPages"!==t.entryType&&"proxyPages"!==t.entryType),oe.xp6(1),oe.Q6J("hidden",t.isFullPage),oe.xp6(2),oe.Q6J("collapsedHeight","28px")("expandedHeight","28px"),oe.xp6(6),oe.Q6J("ngModel",t.logFilter[0]),oe.xp6(2),oe.Q6J("ngModel",t.logFilter[1]),oe.xp6(2),oe.Q6J("ngModel",t.logFilter[2]),oe.xp6(2),oe.Q6J("ngModel",t.logFilter[3]),oe.xp6(2),oe.Q6J("ngModel",t.logFilter[4]),oe.xp6(2),oe.Q6J("ngModel",t.logFilter[5]),oe.xp6(4),oe.Q6J("ngIf",e.expanded),oe.xp6(1),oe.Udp("border",t.isFullPage?"":"thin solid black"),oe.xp6(2),oe.Q6J("width",t.frameWidth)("height",t.frameHeight)("src",t.src,oe.uOi),oe.uIk("sandbox",t.sandboxAuthorized.join(" ")),oe.xp6(2),oe.Q6J("ngIf",t.frameProcessing||"list"===t.mode)}},directives:[s.O5,a.ib,a.yz,a.yK,u.oG,r.JJ,r.On,n.lW,s.sg,x.Y,g.d,c.a8,c.dk,c.n5,c.$j,c.dn,c.hq,c.kc,c.G2,m.yS],pipes:[s.Nd,s.OU],styles:[".mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0 0 0 16px}.mat-checkbox[_ngcontent-%COMP%]{padding-right:14px}"]}),e})();const ct=["sandbox"],ut=function(e){return["/project",e,"info"]};function dt(e,t){if(1&e&&(oe.TgZ(0,"a",6),oe._uU(1),oe.qZA()),2&e){const e=oe.oxw(2);oe.Q6J("routerLink",oe.VKq(2,ut,e.currentProject.id)),oe.xp6(1),oe.hij("Project: ",e.currentProject.name,"")}}function gt(e,t){if(1&e&&(oe.TgZ(0,"span"),oe._uU(1),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(1),oe.Oqu(e.currentPage.name)}}function ht(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe._uU(1,"Project Page: "),oe.YNc(2,gt,2,1,"span",10),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(2),oe.Q6J("ngIf",e.currentPage)}}const pt=function(e){return["/result",e,"info"]};function ft(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe._uU(1,"Result: "),oe.TgZ(2,"a",6),oe.TgZ(3,"u",11),oe._uU(4),oe.qZA(),oe._uU(5),oe.TgZ(6,"u",11),oe._uU(7),oe.qZA(),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(2),oe.Q6J("routerLink",oe.VKq(4,pt,e.currentResult.id)),oe.xp6(2),oe.Oqu(e.currentResult.prefix),oe.xp6(1),oe.Oqu(e.currentResult.name||"(no-name)"),oe.xp6(2),oe.Oqu(e.currentResult.suffix)}}function yt(e,t){if(1&e&&(oe.TgZ(0,"span"),oe._uU(1),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(1),oe.Oqu(e.currentPage.name)}}function vt(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe._uU(1,"Result Page: "),oe.YNc(2,yt,2,1,"span",10),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(2),oe.Q6J("ngIf",e.currentPage)}}const xt=function(e){return["/result",e,"requestProxy"]};function mt(e,t){if(1&e&&(oe.TgZ(0,"span"),oe.TgZ(1,"a",12),oe._uU(2," Proxy "),oe._UZ(3,"i",13),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(1),oe.Q6J("routerLink",oe.VKq(1,xt,e.currentResult.id))}}function bt(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe.YNc(1,mt,4,3,"span",10),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(1),oe.Q6J("ngIf",e.currentResult)}}const Pt=function(e){return["/dataFile",e,"info"]};function Tt(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe._uU(1,"Data File: "),oe.TgZ(2,"a",6),oe.TgZ(3,"u",11),oe._uU(4),oe.qZA(),oe._uU(5),oe.TgZ(6,"u",11),oe._uU(7),oe.qZA(),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(2),oe.Q6J("routerLink",oe.VKq(4,Pt,e.currentDataFile.id)),oe.xp6(2),oe.Oqu(e.currentDataFile.prefix),oe.xp6(1),oe.Oqu(e.currentDataFile.name||"(no-name)"),oe.xp6(2),oe.Oqu(e.currentDataFile.suffix)}}const Zt=function(e){return["/data","api","dataFile",e,"static"]};function kt(e,t){if(1&e&&(oe.TgZ(0,"span"),oe.TgZ(1,"a",12),oe._uU(2," Folder content "),oe._UZ(3,"i",13),oe.qZA(),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(1),oe.Q6J("routerLink",oe.VKq(1,Zt,e.currentDataFile.id))}}function wt(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe.YNc(1,kt,4,3,"span",10),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(1),oe.Q6J("ngIf",e.currentDataFile)}}function It(e,t){if(1&e&&(oe.TgZ(0,"span"),oe._uU(1),oe.qZA()),2&e){const e=oe.oxw(3);oe.xp6(1),oe.Oqu(e.currentPage.name)}}function At(e,t){if(1&e&&(oe.TgZ(0,"li",9),oe._uU(1,"File Page: "),oe.YNc(2,It,2,1,"span",10),oe.qZA()),2&e){const e=oe.oxw(2);oe.xp6(2),oe.Q6J("ngIf",e.currentPage)}}const Ft=function(){return["/home"]},Ct=function(){return["/project/list"]};function St(e,t){if(1&e&&(oe.TgZ(0,"ol",4),oe.TgZ(1,"li",5),oe.TgZ(2,"a",6),oe._uU(3,"Home"),oe.qZA(),oe.qZA(),oe.TgZ(4,"li",5),oe.TgZ(5,"a",6),oe._uU(6,"Project List"),oe.qZA(),oe.qZA(),oe.TgZ(7,"li",5),oe.YNc(8,dt,2,4,"a",7),oe.qZA(),oe.YNc(9,ht,3,1,"li",8),oe.YNc(10,ft,8,6,"li",8),oe.YNc(11,vt,3,1,"li",8),oe.YNc(12,bt,2,1,"li",8),oe.YNc(13,Tt,8,6,"li",8),oe.YNc(14,wt,2,1,"li",8),oe.YNc(15,At,3,1,"li",8),oe.qZA()),2&e){const e=oe.oxw();oe.xp6(2),oe.Q6J("routerLink",oe.DdM(10,Ft)),oe.xp6(3),oe.Q6J("routerLink",oe.DdM(11,Ct)),oe.xp6(3),oe.Q6J("ngIf",e.currentProject),oe.xp6(1),oe.Q6J("ngIf","indexPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf",e.currentResult),oe.xp6(1),oe.Q6J("ngIf","resultPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf","proxyPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf",e.currentDataFile),oe.xp6(1),oe.Q6J("ngIf","staticPages"===e.entryType),oe.xp6(1),oe.Q6J("ngIf","filePages"===e.entryType)}}function qt(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"bdp-sandbox",14,15),oe.NdJ("pageChange",function(t){return oe.CHM(e),oe.oxw().onPageChange(t)})("requestNavigation",function(t){return oe.CHM(e),oe.oxw().navigatePage(t)})("requestFullPage",function(t){return oe.CHM(e),oe.oxw().toggleFullPage(t)})("rightSideMenuStateChange",function(t){return oe.CHM(e),oe.oxw().toggleRightSideMenu(t)})("modeChage",function(t){return oe.CHM(e),oe.oxw().onModeChange(t)}),oe.qZA()}if(2&e){const e=oe.oxw();oe.Q6J("currentProject",e.currentProject)("currentResult",e.currentResult)("currentDataFile",e.currentDataFile)("currentPackages",e.currentPackages)("currentUser",e.currentUser)("isFullPage",e.isFullPage)("keyOrders",e.pageKeyOrders)("validPages",e.validPages)("pageKey",e.currentPageKey)("entryType",e.entryType)("mode",e.mode)}}function jt(e,t){1&e&&oe._UZ(0,"i",29)}function _t(e,t){1&e&&oe._UZ(0,"i",30)}function Dt(e,t){1&e&&(oe.ynx(0),oe._uU(1,"Full page"),oe.BQk())}function Ut(e,t){1&e&&(oe.ynx(0),oe._uU(1,"Compress"),oe.BQk())}function Mt(e,t){if(1&e){const e=oe.EpF();oe.TgZ(0,"div",16),oe.TgZ(1,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.showRightButtonContent=!t.showRightButtonContent}),oe.YNc(2,jt,1,0,"i",18),oe.YNc(3,_t,1,0,"i",19),oe.TgZ(4,"span",20),oe._uU(5,"MENU"),oe.qZA(),oe.TgZ(6,"span",21),oe._uU(7,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(8,"br"),oe.TgZ(9,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.sandbox&&t.sandbox.historyBack()}),oe._UZ(10,"i",22),oe.TgZ(11,"span",23),oe._uU(12,"Back"),oe.qZA(),oe.TgZ(13,"span",21),oe._uU(14,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(15,"br"),oe.TgZ(16,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.sandbox&&t.sandbox.historyForward()}),oe._UZ(17,"i",24),oe.TgZ(18,"span",23),oe._uU(19,"Forward"),oe.qZA(),oe.TgZ(20,"span",21),oe._uU(21,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(22,"br"),oe.TgZ(23,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.sandbox&&t.sandbox.detectSizeChange()}),oe._UZ(24,"i",25),oe.TgZ(25,"span",23),oe._uU(26,"Adjust size"),oe.qZA(),oe.TgZ(27,"span",21),oe._uU(28,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(29,"br"),oe.TgZ(30,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.sandbox&&t.sandbox.reloadClient()}),oe._UZ(31,"i",26),oe.TgZ(32,"span",23),oe._uU(33,"Refresh"),oe.qZA(),oe.TgZ(34,"span",21),oe._uU(35,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(36,"br"),oe.TgZ(37,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.mode="list"===t.mode?"page":"list"}),oe._UZ(38,"i",27),oe.TgZ(39,"span",23),oe._uU(40,"Page list"),oe.qZA(),oe.TgZ(41,"span",21),oe._uU(42,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(43,"br"),oe.TgZ(44,"a",17),oe.NdJ("click",function(){oe.CHM(e);const t=oe.oxw();return t.toggleFullPage(!t.isFullPage)}),oe._UZ(45,"i",28),oe.TgZ(46,"span",23),oe.YNc(47,Dt,2,0,"ng-container",10),oe.YNc(48,Ut,2,0,"ng-container",10),oe.qZA(),oe.TgZ(49,"span",21),oe._uU(50,"\u276f"),oe.qZA(),oe.qZA(),oe._UZ(51,"br"),oe.qZA()}if(2&e){const e=oe.oxw();oe.Q6J("@rightButtonState",e.showRightButtonContent?"active":"inactive"),oe.xp6(2),oe.Q6J("ngIf",e.showRightButtonContent),oe.xp6(1),oe.Q6J("ngIf",!e.showRightButtonContent),oe.xp6(1),oe.ekj("active",e.showRightButtonContent),oe.xp6(7),oe.ekj("active",e.showRightButtonContent),oe.xp6(7),oe.ekj("active",e.showRightButtonContent),oe.xp6(7),oe.ekj("active",e.showRightButtonContent),oe.xp6(7),oe.ekj("active",e.showRightButtonContent),oe.xp6(5),oe.ekj("active","list"===e.mode),oe.xp6(2),oe.ekj("active",e.showRightButtonContent),oe.xp6(6),oe.ekj("fa-expand-alt",!e.isFullPage)("fa-compress-alt",e.isFullPage),oe.xp6(1),oe.ekj("active",e.showRightButtonContent),oe.xp6(1),oe.Q6J("ngIf",!e.isFullPage),oe.xp6(1),oe.Q6J("ngIf",e.isFullPage)}}let Rt=(()=>{class e{constructor(e,t,i,s,r,n,a){this.route=e,this.router=t,this.systemService=i,this.infoService=s,this.projectService=r,this.taskService=n,this.accountService=a,this.showRightButtonContent=!1,this.currentResult=null,this.currentDataFile=null,this.currentPage=null,this.currentPageKey=null,this.pageKeyOrders={},this.validPages=new Map,this.isFullPage=!1,this.canInitialize=!1,this.displayRightSideMenu=!0,this.entryType=null,this.mode="page",this._subs=[]}ngOnInit(){this.systemService.maintainRightSidebarStatus(!0),this._subs.push(this.accountService.currentUser$.subscribe(e=>this.currentUser=e)),this._subs.push(this.systemService.sidebarStatus$.subscribe(e=>{this.sandbox&&this.sandbox.detectSizeChange&&(clearTimeout(this.onChildrenResizeTimer),this.onChildrenResizeTimer=setTimeout(()=>this.sandbox&&this.sandbox.detectSizeChange(),500))})),this._subs.push(this.infoService.incomingDataChange$.subscribe(e=>{const t=e.type,i=e.target,s=e.data;if("DataFile"===i||"Result"===i){if(!this.currentProject)return;if(s.project!==this.currentProject.id)return;let e;"DataFile"===i?e=new Z.A(s):"Result"===i&&(e=new T.x(s)),this.sandbox&&e&&this.sandbox.notifyDataChange({type:t,target:i,data:e.getModel()})}})),this._subs.push(this.infoService.incomingResultOutput$.subscribe(e=>{if(!this.currentProject)return;if(!this.sandbox)return;const t=e.target.split(":");t[0]===this.currentProject.id&&this.sandbox.notifyDataChange({type:e.type,target:"ResultMsg",data:{resultId:t[1],content:e.data}})})),this._subs.push(this.projectService.currentProject$.subscribe(e=>{this.currentProject=e,e&&(this.pages=e&&Array.isArray(e.packages)&&e.packages[0]?e.packages[0].pages:new xe.iY({}),"indexPages"===this.entryType&&this.getValidPages())})),this._subs.push(this.projectService.currentResult$.subscribe(e=>{this.thisResultID&&e&&e.id===this.thisResultID?(this.currentProject&&"resultPages"===this.entryType||"proxyPages"===this.entryType)&&(this.currentResult=e,this.getValidPages()):void 0===e&&(this.currentResult=e)})),this._subs.push(this.projectService.currentDataFile$.subscribe(e=>{this.thisDataFileID&&e&&e.id===this.thisDataFileID?!this.currentProject||"filePages"!==this.entryType&&"staticPages"!==this.entryType||(this.currentDataFile=e,this.getValidPages()):void 0===e&&(this.currentDataFile=e)})),this.route.queryParamMap.subscribe(e=>{const t=e.get("project"),i=e.get("result"),s=e.get("datafile"),r=e.get("static"),n=e.get("proxy");if(this.currentPageKey=e.get("pageKey")||null,this.isFullPage="true"===e.get("fullpage"),t)this.entryType="indexPages",this.projectService.clearCurrentDataFile(),this.projectService.clearCurrentResult(),this.projectService.clearCurrentProject(),this.projectService.setCurrentProject(t,!1);else if(i){"true"===n?this.entryType="proxyPages":(this.entryType="resultPages",this.projectService.clearCurrentDataFile()),this.thisResultID=i;const e=this.projectService.loadResultInfo(i).subscribe(()=>e.unsubscribe())}else if(s){this.thisDataFileID=s,"true"===r?this.entryType="staticPages":(this.entryType="filePages",this.projectService.clearCurrentResult());const e=this.projectService.loadDataFileInfo(s).subscribe(t=>{e.unsubscribe()})}this.systemService.maintainRightSidebarStatus(!0)})}onResize(e){clearTimeout(this.onResizeTimer),this.onResizeTimer=setTimeout(()=>this.detectSizeChange(),400)}detectSizeChange(){const e=window.innerWidth<1024;this.isFullPage?this.systemService.toggleSidebar(!1,!0):this.systemService.toggleSidebar(!e)}getProxyPags(){const e=new Map;if(!this.currentProject)return;if("proxyPages"!==this.entryType)return;if(!this.currentResult)return;const t=this.currentResult.id,i=this.projectService.getProxyJobsByResultId(t).subscribe(s=>{if(i.unsubscribe(),s.isError)return this.validPages=e,this.requestFullPage(this.isFullPage),void setTimeout(()=>this.canInitialize=!0,10);const r=s.success;this.pageKeyOrders={[t]:[]};for(let i=0;i<r.length;i++){const s=r[i],n=`${t}:${s.jobId}`;this.pageKeyOrders[t].push(s.jobId),e.set(`${n}`,s.proxy)}this.validPages=e,this.requestFullPage(this.isFullPage),setTimeout(()=>this.canInitialize=!0,10)})}getValidPages(){const e=new Map;if(!(this.currentProject&&Array.isArray(this.currentProject.packages)&&this.currentProject.packages[0]&&this.currentProject.packages[0].pages))return void this.router.navigate(this.currentProject?["/project",this.currentProject.id,"info"]:["/project/list"]);let t={};const i=this.projectService.getRelatedPackages().subscribe(s=>{if(i.unsubscribe(),s.isError)return this.validPages=new Map,void(this.canInitialize=!0);if(!this.entryType)return;const r=s.success.map(e=>new ve.G(e));if(this.currentPackages=r,this.pageKeyOrders={},Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];t[s.id]=[],this.pageKeyOrders[s.id]=[];const n=s.pages.getPagesByType(this.entryType);Array.isArray(n)&&t[s.id].push.apply(t[s.id],n.filter(e=>{let t=!0;switch(this.entryType){case"resultPages":if(0===e.tasks.length)return!0;if(!this.currentResult)return!1;if(e.tasks.indexOf((this.currentResult.task&&this.currentResult.task.key?this.currentResult.task:this.currentResult.taskSnapshot).key)>=0)return!0;t=!1;break;case"filePages":const i=e,s=this.currentDataFile;if(!s)return!1;if(0===i.tags.length){if(!i.format)return!0;if(i.format===s.format)return!0}else{const e=i.rule;if("or"===e)return i.tags.filter(e=>s.tags.indexOf(e)>=0).length>0;if("and"===e)return i.tags.filter(e=>s.tags.indexOf(e)>=0).length===i.tags.length;if("all"===e)return i.tags.filter(e=>s.tags.indexOf(e)>=0).length===s.tags.length}t=!1}return t}));for(let i=0;i<t[s.id].length;i++){const r=t[s.id][i];if(!r.key)continue;const n=s.id+":"+r.key;null==this.currentPageKey?(this.currentPageKey=n||null,this.currentPage=r):this.currentPageKey===n&&(this.currentPage=r),e.set(n,r),this.pageKeyOrders[s.id].push(r.key)}}"proxyPages"!==this.entryType?(this.validPages=e,this.requestFullPage(this.isFullPage),setTimeout(()=>this.canInitialize=!0)):this.getProxyPags()})}onModeChange(e){this.mode="list"===e?"list":"page"}onPageChange(e){this.canInitialize=!1;const t={project:void 0,result:void 0,datafile:void 0,pageKey:e.package.id+":"+e.page.key,fullpage:!!this.isFullPage,static:void 0,proxy:void 0};if("indexPages"===this.entryType){if(!this.currentProject)return;t.project=this.currentProject.id}else if("resultPages"===this.entryType){if(!this.currentResult)return;t.result=this.currentResult.id,t.proxy=!1}else if("filePages"===this.entryType){if(!this.currentDataFile)return;t.datafile=this.currentDataFile.id}else if("staticPages"===this.entryType){if(!this.currentDataFile)return;t.datafile=this.currentDataFile.id,t.static=!0}else if("proxyPages"===this.entryType){if(!this.currentResult)return;t.result=this.currentResult.id,e.pageKey&&(t.pageKey=e.pageKey),t.proxy=!0}this.currentPageKey=e.package.id+":"+e.page.key,this.mode="page",this.router.navigate(["/page"],{queryParams:t})}navigatePage(e){if(!e)return;if(["indexPages","resultPages","filePages","proxyPages","staticPages"].indexOf(e.type)<0)return;const t={project:"indexPages"===e.type?e.itemID:void 0,result:"resultPages"===e.type||"proxyPages"===e.type?e.itemID:void 0,datafile:"filePages"===e.type||"staticPages"===e.type?e.itemID:void 0,pageKey:e.pageKey||void 0,fullpage:!!this.isFullPage,static:"staticPages"===e.type||void 0,proxy:"proxyPages"===e.type||void 0};this.canInitialize=!1,this.router.navigate(["/page"],{queryParams:t}),(e.pageKey===this.currentPageKey&&(t.datafile===this.thisDataFileID&&"filePages"===e.type||t.result===this.thisResultID&&"resultPages"===e.type||t.project&&"indexPages"===e.type)||t.datafile===this.thisDataFileID&&"staticPages"===e.type||t.result===this.thisResultID&&"proxyPages"===e.type)&&setTimeout(()=>this.canInitialize=!0,10),this.mode="page"}toggleFullPage(e){var t,i,s;const r={project:"indexPages"===this.entryType?null===(t=this.currentProject)||void 0===t?void 0:t.id:void 0,result:"resultPages"===this.entryType||"proxyPages"===this.entryType?null===(i=this.currentResult)||void 0===i?void 0:i.id:void 0,datafile:"filePages"===this.entryType||"staticPages"===this.entryType?null===(s=this.currentDataFile)||void 0===s?void 0:s.id:void 0,pageKey:this.currentPageKey||void 0,fullpage:!!e,static:"staticPages"===this.entryType||void 0,proxy:"proxyPages"===this.entryType||void 0};this.router.navigate(["/page"],{queryParams:r})}requestFullPage(e){const t=window.innerWidth<1024;this.systemService.toggleNavbar(!e),e?this.systemService.toggleSidebar(!1):t||this.systemService.toggleSidebar(!0)}toggleRightSideMenu(e){setTimeout(()=>{this.displayRightSideMenu=void 0===e?!this.displayRightSideMenu:!!e})}ngOnDestroy(){this._subs.forEach(e=>e.unsubscribe())}}return e.\u0275fac=function(t){return new(t||e)(oe.Y36(m.gz),oe.Y36(m.F0),oe.Y36(he.o),oe.Y36(ue.C),oe.Y36(ce.Y),oe.Y36(de.M),oe.Y36(ge.B))},e.\u0275cmp=oe.Xpm({type:e,selectors:[["bdp-page"]],viewQuery:function(e,t){if(1&e&&oe.Gf(ct,5),2&e){let e;oe.iGM(e=oe.CRH())&&(t.sandbox=e.first)}},decls:4,vars:5,consts:[["class","breadcrumb",4,"ngIf"],[1,"bdp-main-container",3,"resize"],["style","display: block;",3,"currentProject","currentResult","currentDataFile","currentPackages","currentUser","isFullPage","keyOrders","validPages","pageKey","entryType","mode","pageChange","requestNavigation","requestFullPage","rightSideMenuStateChange","modeChage",4,"ngIf"],["class","chi-right-menu",4,"ngIf"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],[3,"routerLink",4,"ngIf"],["class","breadcrumb-item active",4,"ngIf"],[1,"breadcrumb-item","active"],[4,"ngIf"],[1,"text-muted"],["target","_blank",3,"routerLink"],[1,"fas","fa-external-link-alt","fa-fw","ms-2"],[2,"display","block",3,"currentProject","currentResult","currentDataFile","currentPackages","currentUser","isFullPage","keyOrders","validPages","pageKey","entryType","mode","pageChange","requestNavigation","requestFullPage","rightSideMenuStateChange","modeChage"],["sandbox",""],[1,"chi-right-menu"],[1,"chi-rbtn",3,"click"],["class","fa fa-angle-right fa-fw",4,"ngIf"],["class","fa fa-angle-left fa-fw",4,"ngIf"],[1,"chi-rbtn-content","ms-2"],[1,"chi-rbtn-arrow"],["aria-hidden","true",1,"fas","fa-arrow-left","fa-fw"],[1,"chi-rbtn-content"],["aria-hidden","true",1,"fas","fa-arrow-right","fa-fw"],["aria-hidden","true",1,"fas","fa-expand","fa-fw"],["aria-hidden","true",1,"fas","fa-sync-alt","fa-fw"],[1,"fas","fa-th-large","fa-fw"],[1,"fas","fa-fw"],[1,"fa","fa-angle-right","fa-fw"],[1,"fa","fa-angle-left","fa-fw"]],template:function(e,t){1&e&&(oe.YNc(0,St,16,12,"ol",0),oe.TgZ(1,"div",1),oe.NdJ("resize",function(e){return t.onResize(e)},!1,oe.Jf7),oe.YNc(2,qt,2,11,"bdp-sandbox",2),oe.qZA(),oe.YNc(3,Mt,52,25,"div",3)),2&e&&(oe.Q6J("ngIf",!t.isFullPage),oe.xp6(1),oe.Udp("padding",t.isFullPage?"0px":"7px"),oe.xp6(1),oe.Q6J("ngIf",t.canInitialize&&t.currentProject&&t.currentPackages&&t.currentUser),oe.xp6(1),oe.Q6J("ngIf",t.displayRightSideMenu))},directives:[s.O5,m.yS,lt],styles:[""],data:{animation:[ye.M]}}),e})();var $t=i(78968);const Nt=m.Bz.forChild([{path:"",component:Rt}]),Jt=[$t.P];let zt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=oe.oAB({type:e}),e.\u0275inj=oe.cJS({providers:[Jt],imports:[[s.ez,r.u5,o.c,l.Nh,n.ot,a.To,fe,Nt]]}),e})()}}]);